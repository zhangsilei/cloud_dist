{"version":3,"file":"js/609.9932bc70.js","mappings":"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","sources":["webpack://cloud_dist/./node_modules/@vicons/ionicons5/es/CameraOutline.js","webpack://cloud_dist/./src/views/pc/ResourceManage.vue","webpack://cloud_dist/./src/views/pc/ResourceManage.vue?4cef"],"sourcesContent":["import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M350.54 148.68l-26.62-42.06C318.31 100.08 310.62 96 302 96h-92c-8.62 0-16.31 4.08-21.92 10.62l-26.62 42.06C155.85 155.23 148.62 160 140 160H80a32 32 0 0 0-32 32v192a32 32 0 0 0 32 32h352a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32h-59c-8.65 0-16.85-4.77-22.46-11.32z',\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'circle',\n  {\n    cx: '256',\n    cy: '272',\n    r: '80',\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-miterlimit': '10',\n    'stroke-width': '32'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32',\n    d: 'M124 158v-22h-24v22'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_5 = [_hoisted_2, _hoisted_3, _hoisted_4]\nexport default defineComponent({\n  name: 'CameraOutline',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_5)\n  }\n})\n","<template>\r\n  <div class=\"resource-manage-container\">\r\n    <categorie-tree class=\"categorie-tree-wrap\" />\r\n\r\n    <div class=\"resource-wrap\">\r\n      <n-space class=\"filter\">\r\n        <n-form-item label-placement=\"left\" label=\"关键字\">\r\n          <n-input v-model:value=\"resource.query.key\" clearable></n-input>\r\n        </n-form-item>\r\n        <n-form-item label-placement=\"left\">\r\n          <n-button type=\"primary\" @click=\"query\"> 查询 </n-button>\r\n        </n-form-item>\r\n        <n-form-item label-placement=\"left\">\r\n          <n-button @click=\"reset\"> 重置 </n-button>\r\n        </n-form-item>\r\n      </n-space>\r\n\r\n      <n-space v-if=\"isVideo || isPhoto\" class=\"action\">\r\n        <n-button type=\"primary\" @click=\"onClickUpload\">\r\n          {{ resource.title }}\r\n        </n-button>\r\n      </n-space>\r\n\r\n      <div class=\"content\">\r\n        <n-empty\r\n          v-if=\"!resource.dataList.length\"\r\n          description=\"暂无数据\"\r\n          style=\"margin-top: 100px; flex: 1\"\r\n        ></n-empty>\r\n        <n-grid v-else :x-gap=\"8\" :y-gap=\"8\" :cols=\"8\" style=\"margin-top: 10px\">\r\n          <n-grid-item v-for=\"(item, index) in resource.dataList\" :key=\"index\">\r\n            <video-card\r\n              :id=\"item.id\"\r\n              :file-name=\"item.name\"\r\n              :like-num=\"item.like_num\"\r\n              :authority=\"true\"\r\n              :poster=\"parseUrlToPath(item.picture_url)\"\r\n              @on-edit=\"editRes(item)\"\r\n              @on-detail=\"detailResource(item)\"\r\n              @on-delete=\"deleteRes(item)\"\r\n            ></video-card>\r\n          </n-grid-item>\r\n        </n-grid>\r\n        <n-pagination\r\n          style=\"justify-content: flex-end\"\r\n          v-model:page=\"resource.query.page_num\"\r\n          :item-count=\"resource.total\"\r\n          :on-update:page=\"changePage\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <popup-window\r\n      v-model=\"resource.isShow\"\r\n      :title=\"resource.title\"\r\n      @on-confirm=\"onResourceConfirm\"\r\n    >\r\n      <n-form\r\n        ref=\"resourceRef\"\r\n        :model=\"resource.formData\"\r\n        :rules=\"resource.rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"所在分区\">\r\n          <span v-for=\"(item, index) in breadcrumbCategory\">\r\n            {{ item }}\r\n            <span v-if=\"index !== breadcrumbCategory.length - 1\">/</span>\r\n          </span>\r\n        </n-form-item>\r\n        <n-form-item label=\"名称\" path=\"name\">\r\n          <n-input v-model:value=\"resource.formData.name\" />\r\n        </n-form-item>\r\n        <n-form-item v-if=\"isVideo\" label=\"视频\" path=\"video_url\">\r\n          <n-upload directory-dnd @change=\"onUpload\">\r\n            <n-upload-dragger>\r\n              <div style=\"margin-bottom: 12px\">\r\n                <n-icon size=\"48\" :depth=\"3\">\r\n                  <CameraOutline />\r\n                </n-icon>\r\n              </div>\r\n              <n-text style=\"font-size: 14px\"> 添加视频 </n-text>\r\n              <!-- <n-p depth=\"3\" style=\"margin: 8px 0 0 0\">\r\n                （图片大小不超过100M）\r\n              </n-p> -->\r\n            </n-upload-dragger>\r\n          </n-upload>\r\n        </n-form-item>\r\n        <n-form-item v-if=\"isPhoto\" label=\"图片\" path=\"picture_url\">\r\n          <n-upload directory-dnd @change=\"onUpload\">\r\n            <n-upload-dragger>\r\n              <div style=\"margin-bottom: 12px\">\r\n                <n-icon size=\"48\" :depth=\"3\">\r\n                  <add />\r\n                </n-icon>\r\n              </div>\r\n              <n-text style=\"font-size: 16px\"> 上传图片 </n-text>\r\n              <!-- <n-p depth=\"3\" style=\"margin: 8px 0 0 0\">\r\n                （图片大小不超过1M）\r\n              </n-p> -->\r\n            </n-upload-dragger>\r\n          </n-upload>\r\n        </n-form-item>\r\n        <n-form-item label=\"描述\" path=\"description\">\r\n          <n-input v-model:value=\"resource.formData.description\" />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window>\r\n\r\n    <popup-window\r\n      v-model=\"detail.isShow\"\r\n      title=\"详细信息\"\r\n      :isShowFooter=\"false\"\r\n    >\r\n      <div style=\"display: flex\">\r\n        <div>\r\n          <img\r\n            style=\"width: 250px; margin-right: 15px\"\r\n            :src=\"detail.picture_url\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <n-form-item label-placement=\"left\" label=\"名称\">\r\n            <div>{{ detail.name }}</div>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"位置\">\r\n            <span v-for=\"(item, index) in breadcrumbCategory\">\r\n              {{ item }}\r\n              <span v-if=\"index !== breadcrumbCategory.length - 1\">/</span>\r\n            </span>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"上传时间\">\r\n            <div>{{ detail.created_time }}</div>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"最后修改\">\r\n            <div>{{ detail.updated_time }}</div>\r\n          </n-form-item>\r\n        </div>\r\n      </div>\r\n    </popup-window>\r\n\r\n    <!-- <n-spin :show=\"loading\">\r\n      <n-space v-if=\"dataList.length\" vertical size=\"large\">\r\n        <div class=\"filter\">\r\n          <n-input round placeholder=\"关键字\">\r\n            <template #prefix>\r\n              <n-icon :component=\"IosSearch\" />\r\n            </template>\r\n          </n-input>\r\n          <n-button\r\n            type=\"primary\"\r\n            attr-type=\"button\"\r\n            style=\"margin: 0 10px\"\r\n            @click=\"queryResource\"\r\n          >\r\n            查询\r\n          </n-button>\r\n          <n-button attr-type=\"button\" @click=\"reset\"> 重置 </n-button>\r\n        </div>\r\n\r\n        <div class=\"action\">\r\n          <n-button\r\n            type=\"primary\"\r\n            attr-type=\"button\"\r\n            @click=\"isShowUpload = true\"\r\n          >\r\n            上传视频\r\n          </n-button>\r\n        </div>\r\n\r\n        <div class=\"content\">\r\n          <n-grid :x-gap=\"8\" :y-gap=\"8\" :cols=\"8\">\r\n            <n-grid-item v-for=\"(item, index) in state.dataList\" :key=\"index\">\r\n              <video-card\r\n                :file-name=\"item.fileName\"\r\n                :like-num=\"item.likeNum\"\r\n                :authority=\"item.authority\"\r\n              ></video-card>\r\n            </n-grid-item>\r\n          </n-grid>\r\n        </div>\r\n      </n-space>\r\n      <n-empty v-else class=\"empty-data\" description=\"暂无分区数据\">\r\n        <template #extra>\r\n          <n-button size=\"small\" @click=\"addCategorie\">新建分区</n-button>\r\n        </template>\r\n      </n-empty>\r\n    </n-spin> -->\r\n\r\n    <!-- <popup-window\r\n      v-model=\"isShowCategorieAlert\"\r\n      title=\"创建分区\"\r\n      @on-confirm=\"addCategorie\"\r\n    >\r\n      <n-form\r\n        ref=\"categorieFormRef\"\r\n        :model=\"categorieFormData\"\r\n        :rules=\"rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"分区名称\" path=\"name\">\r\n          <n-input\r\n            v-model:value=\"categorieFormData.name\"\r\n            placeholder=\"请输入\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"分区描述\" path=\"description\">\r\n          <n-input\r\n            v-model:value=\"categorieFormData.description\"\r\n            placeholder=\"请输入\"\r\n          />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window> -->\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  createDiscreteApi,\r\n  NBreadcrumb,\r\n  NBreadcrumbItem,\r\n  NIcon,\r\n  NInput,\r\n  NTag,\r\n  NSpace,\r\n  NGrid,\r\n  NGridItem,\r\n  NButton,\r\n  NForm,\r\n  NFormItem,\r\n  NSpin,\r\n  NEmpty,\r\n  NUpload,\r\n  NUploadDragger,\r\n  NText,\r\n  NP,\r\n  NPagination,\r\n  NImage,\r\n  useDialog,\r\n} from 'naive-ui';\r\nimport { ref, reactive, onMounted, watch, computed } from 'vue';\r\nimport { CameraOutline, Add } from '@vicons/ionicons5';\r\nimport { Photo } from '@vicons/tabler';\r\nimport DirCard from '@/components/pc/DirCard';\r\nimport VideoCard from '@/components/pc/VideoCard';\r\nimport PopupWindow from '@/components/pc/PopupWindow';\r\nimport CategorieTree from '@/components/pc/CategorieTree';\r\nimport { getCategorieList } from '@/api/categories';\r\nimport { postVideo, postPicture } from '@/api/file';\r\nimport {\r\n  onlyAllowNumber,\r\n  RESOURCE_TYPE_VIDEO,\r\n  RESOURCE_TYPE_PICTURE,\r\n  parseUrlToPath,\r\n  getBreadcrumbCategory,\r\n  resourceSortEnum,\r\n  resourceTypeEnum,\r\n  formatDate,\r\n} from '@/common/global';\r\nimport {\r\n  getResourceList,\r\n  createResource,\r\n  getResourceDetail,\r\n  deleteResource,\r\n  updateResource,\r\n} from '@/api/resource';\r\nimport { useStore } from 'vuex';\r\nimport moment from 'moment';\r\n\r\nconst store = useStore();\r\nconst { message, dialog } = createDiscreteApi(['message', 'dialog']);\r\n\r\n// 筛选查询\r\nfunction query() {\r\n  renderResources();\r\n}\r\n\r\nfunction reset() {\r\n  resource.query.key = null;\r\n}\r\n\r\n// 上传按钮\r\nconst isVideo = computed(\r\n  () => resource.query.resource_type === resourceTypeEnum.VIDEOS\r\n);\r\nconst isPhoto = computed(\r\n  () => resource.query.resource_type === resourceTypeEnum.PHOTOS\r\n);\r\n\r\nfunction onClickUpload() {\r\n  resource.isShow = true;\r\n}\r\n\r\n// 上传资源\r\nconst uplodFile = ref(null);\r\nconst resourceRef = ref(null);\r\nconst resource = reactive({\r\n  loading: false,\r\n  isShow: false,\r\n  title: null,\r\n  dataList: [],\r\n  total: 0,\r\n  query: {\r\n    page_num: 1,\r\n    page_size: 10,\r\n    category_id: null,\r\n    key: null,\r\n    order_by: resourceSortEnum.DEFAULT,\r\n    resource_type: null,\r\n    // order_type: '',\r\n  },\r\n  resource_id: null,\r\n  formData: ref({\r\n    category_id: null,\r\n    resource_type: null,\r\n    name: null,\r\n    description: null,\r\n    picture_url: null,\r\n    video_url: null,\r\n  }),\r\n  rules: {\r\n    name: {\r\n      required: true,\r\n      trigger: ['blur', 'input'],\r\n      message: '请输入名称',\r\n    },\r\n    video_url: {\r\n      required: true,\r\n      trigger: ['blur', 'change'],\r\n      message: '请上传资源',\r\n    },\r\n  },\r\n});\r\n\r\nfunction onUpload({ file }) {\r\n  uplodFile.value = file;\r\n  file.status = 'uploading';\r\n  file.percentage = 0;\r\n  const timer = setInterval(() => {\r\n    if (uplodFile.value.status === 'finished') {\r\n      clearInterval(timer);\r\n      return;\r\n    }\r\n    uplodFile.value.percentage += Math.random() * 30;\r\n  }, 1000);\r\n  if (isVideo.value) {\r\n    postVideo(file).then(({ picture_url, video_url }) => {\r\n      resource.formData.picture_url = picture_url;\r\n      resource.formData.video_url = video_url;\r\n      uplodFile.value.percentage = 100;\r\n      setTimeout(() => {\r\n        uplodFile.value.status = 'finished';\r\n      }, 0);\r\n    });\r\n  }\r\n  if (isPhoto.value) {\r\n    postPicture(file).then(({ url }) => {\r\n      resource.formData.picture_url = url;\r\n      resource.formData.video_url = '';\r\n      uplodFile.value.percentage = 100;\r\n      setTimeout(() => {\r\n        uplodFile.value.status = 'finished';\r\n      }, 0);\r\n    });\r\n  }\r\n}\r\n\r\nfunction onResourceConfirm() {\r\n  resourceRef.value\r\n    ?.validate(async (errors) => {\r\n      if (!errors) {\r\n        if (!resource.resource_id) {\r\n          await createResource(resource.formData);\r\n        } else {\r\n          await updateResource(resource.resource_id, resource.formData);\r\n        }\r\n        resource.isShow = false;\r\n        message.success('操作成功！');\r\n        renderResources();\r\n      }\r\n    })\r\n    .catch();\r\n}\r\n\r\n// 资源列表\r\nasync function renderResources() {\r\n  resource.loading = true;\r\n  const res = await getResourceList(resource.query);\r\n  resource.dataList = res.resources || [];\r\n  resource.total = res.total;\r\n  resource.loading = false;\r\n}\r\n\r\nfunction changePage(page) {\r\n  resource.query.page_num = page;\r\n  renderResources();\r\n}\r\n\r\nconst selectedCategory = ref(null);\r\nconst breadcrumbCategory = ref([]);\r\n\r\nwatch(store.state, (val) => {\r\n  const dirType = val.selectedCategory.dirType;\r\n  const id = dirType\r\n    ? val.selectedCategory.category_id\r\n    : val.selectedCategory.id;\r\n  const typeMap = {\r\n    [resourceTypeEnum.VIDEOS]: '上传视频',\r\n    [resourceTypeEnum.PHOTOS]: '上传图片',\r\n  };\r\n\r\n  selectedCategory.value = id;\r\n  breadcrumbCategory.value = getBreadcrumbCategory(val.allCategories, id);\r\n\r\n  resource.title = typeMap[dirType];\r\n  resource.formData.category_id = id;\r\n  resource.formData.resource_type = dirType;\r\n  resource.query.category_id = id;\r\n  resource.query.resource_type = dirType;\r\n\r\n  if (dirType !== undefined) {\r\n    renderResources();\r\n  } else {\r\n    resource.dataList = [];\r\n  }\r\n});\r\n\r\n// 资源详情\r\nconst detail = reactive({\r\n  isShow: false,\r\n  picture_url: '',\r\n  name: '',\r\n  created_time: '',\r\n  updated_time: '',\r\n  breadcrumbCategory: [],\r\n});\r\n\r\nfunction editRes(item) {\r\n  resource.resource_id = item.id;\r\n  resource.formData.category_id = item.category_id;\r\n  resource.formData.name = item.name;\r\n  resource.formData.description = item.description;\r\n  resource.formData.picture_url = item.picture_url;\r\n  resource.formData.video_url = item.video_url;\r\n  resource.formData.resource_type = item.resource_type;\r\n  resource.isShow = true;\r\n}\r\nasync function detailResource(item) {\r\n  const res = await getResourceDetail(item.id);\r\n  detail.picture_url = parseUrlToPath(res.picture_url);\r\n  detail.name = res.name;\r\n  detail.created_time = formatDate(res.created_time);\r\n  detail.updated_time = formatDate(res.updated_time);\r\n  detail.breadcrumbCategory = getBreadcrumbCategory(\r\n    store.state.allCategories,\r\n    store.state.selectedCategory\r\n  );\r\n  detail.isShow = true;\r\n}\r\nfunction deleteRes(item) {\r\n  dialog.warning({\r\n    content: '确认删除资源？',\r\n    positiveText: '确定',\r\n    negativeText: '取消',\r\n    onPositiveClick: async () => {\r\n      await deleteResource(item.id);\r\n      message.success('操作成功！');\r\n      renderResources();\r\n    },\r\n    onNegativeClick: () => {},\r\n  });\r\n}\r\nwatch(\r\n  () => resource.isShow,\r\n  (val) => {\r\n    if (!val) {\r\n      for (const key in resource.formData) {\r\n        if (Object.hasOwnProperty.call(resource.formData, key)) {\r\n          resource.formData[key] = null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n);\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.resource-manage-container {\r\n  display: flex;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 10px;\r\n  background: #fff;\r\n  box-sizing: border-box;\r\n  .categorie-tree-wrap {\r\n    min-width: 200px;\r\n    border-right: 1px solid #eee;\r\n  }\r\n  .resource-wrap {\r\n    padding-left: 20px;\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n\r\n  .empty-data {\r\n    margin-top: 50%;\r\n    transform: translateY(-50%);\r\n  }\r\n  .filter {\r\n    // display: flex;\r\n    // justify-content: flex-start;\r\n    // align-items: center;\r\n  }\r\n\r\n  .action {\r\n  }\r\n  .content {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./ResourceManage.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ResourceManage.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ResourceManage.vue?vue&type=style&index=0&id=79c1e6fc&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-79c1e6fc\"]])\n\nexport default __exports__"],"names":["_hoisted_1","xmlns","viewBox","_hoisted_2","_createElementVNode","d","fill","stroke","_hoisted_3","cx","cy","r","_hoisted_4","_hoisted_5","defineComponent","name","render","_ctx","_cache","_openBlock","_createElementBlock","store","useStore","message","dialog","createDiscreteApi","query","renderResources","reset","resource","key","isVideo","computed","resource_type","resourceTypeEnum","isPhoto","onClickUpload","isShow","uplodFile","ref","resourceRef","reactive","loading","title","dataList","total","page_num","page_size","category_id","order_by","resourceSortEnum","resource_id","formData","description","picture_url","video_url","rules","required","trigger","onUpload","file","value","status","percentage","timer","setInterval","Math","random","clearInterval","postVideo","then","setTimeout","postPicture","url","onResourceConfirm","validate","async","errors","updateResource","createResource","success","catch","res","getResourceList","resources","changePage","page","selectedCategory","breadcrumbCategory","watch","state","val","dirType","id","typeMap","getBreadcrumbCategory","allCategories","undefined","detail","created_time","updated_time","editRes","item","detailResource","getResourceDetail","parseUrlToPath","formatDate","deleteRes","warning","content","positiveText","negativeText","onPositiveClick","deleteResource","onNegativeClick","Object","hasOwnProperty","call","__exports__"],"sourceRoot":""}