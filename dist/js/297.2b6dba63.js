"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[297],{56470:function(e,t,l){l.r(t),l.d(t,{default:function(){return R}});var a=l(73396),r=l(44870),n=l(87139),i=l(24120),u=l(5941),o=l(92097),s=l(33008),d=l(55393),c=l(86973),m=l(9518),p=l(85210),_=l(26429),f=l(83273),g=l(96616),w=l(89807),y=l(74786),v=l(60212);const S={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},U=(0,a._)("path",{d:"M350.54 148.68l-26.62-42.06C318.31 100.08 310.62 96 302 96h-92c-8.62 0-16.31 4.08-21.92 10.62l-26.62 42.06C155.85 155.23 148.62 160 140 160H80a32 32 0 0 0-32 32v192a32 32 0 0 0 32 32h352a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32h-59c-8.65 0-16.85-4.77-22.46-11.32z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),h=(0,a._)("circle",{cx:"256",cy:"272",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),k=(0,a._)("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M124 158v-22h-24v22"},null,-1),D=[U,h,k];var Z=(0,a.aZ)({name:"CameraOutline",render:function(e,t){return(0,a.wg)(),(0,a.iD)("svg",S,D)}}),W=l(17033),b=(l(18244),l(37623)),C=l(43612),q=l(54753),P=(l(59063),l(30627)),x=l(10796),O=l(59684),j=l(20065);l(36797);const z={class:"resource-manage-container"},H={class:"resource-wrap"},E={class:"content"},T={key:0},V={style:{"margin-bottom":"12px"}},I={style:{"margin-bottom":"12px"}},L={style:{display:"flex"}},K=["src"],M={key:0};var Y={__name:"ResourceManage",setup(e){const t=(0,j.oR)(),{message:l,dialog:S}=(0,i.M)(["message","dialog"]);function U(){B()}function h(){R.query.key=null}const k=(0,a.Fl)((()=>R.query.resource_type===x.XE.VIDEOS)),D=(0,a.Fl)((()=>R.query.resource_type===x.XE.PHOTOS));function Y(){R.isShow=!0}const F=(0,r.iH)(null),X=(0,r.iH)(null),R=(0,r.qj)({loading:!1,isShow:!1,title:null,dataList:[],total:0,query:{page_num:1,page_size:10,category_id:null,key:null,order_by:x.qf.DEFAULT,resource_type:null},resource_id:null,formData:(0,r.iH)({category_id:null,resource_type:null,name:null,description:null,picture_url:null,video_url:null}),rules:{name:{required:!0,trigger:["blur","input"],message:"请输入名称"},video_url:{required:!0,trigger:["blur","change"],message:"请上传资源"}}});function A({file:e}){F.value=e,e.status="uploading",e.percentage=0;const t=setInterval((()=>{"finished"!==F.value.status?F.value.percentage+=30*Math.random():clearInterval(t)}),1e3);k.value&&(0,P.A)(e).then((({picture_url:e,video_url:t})=>{R.formData.picture_url=e,R.formData.video_url=t,F.value.percentage=100,setTimeout((()=>{F.value.status="finished"}),0)})),D.value&&(0,P.g)(e).then((({url:e})=>{R.formData.picture_url=e,R.formData.video_url="",F.value.percentage=100,setTimeout((()=>{F.value.status="finished"}),0)}))}function N(){X.value?.validate((async e=>{e||(R.resource_id?await(0,O.id)(R.resource_id,R.formData):await(0,O.SN)(R.formData),R.isShow=!1,l.success("操作成功！"),B())})).catch()}async function B(){R.loading=!0;const e=await(0,O.rT)(R.query);R.dataList=e.resources||[],R.total=e.total,R.loading=!1}function G(e){R.query.page_num=e,B()}const J=(0,r.iH)(null),Q=(0,r.iH)([]);(0,a.YP)(t.state,(e=>{const t=e.selectedCategory.dirType,l=t?e.selectedCategory.category_id:e.selectedCategory.id,a={[x.XE.VIDEOS]:"上传视频",[x.XE.PHOTOS]:"上传图片"};J.value=l,Q.value=(0,x.vo)(e.allCategories,l),R.title=a[t],R.formData.category_id=l,R.formData.resource_type=t,R.query.category_id=l,R.query.resource_type=t,void 0!==t?B():R.dataList=[]}));const $=(0,r.qj)({isShow:!1,picture_url:"",name:"",created_time:"",updated_time:"",breadcrumbCategory:[]});function ee(e){R.resource_id=e.id,R.formData.category_id=e.category_id,R.formData.name=e.name,R.formData.description=e.description,R.formData.picture_url=e.picture_url,R.formData.video_url=e.video_url,R.formData.resource_type=e.resource_type,R.isShow=!0}async function te(e){const l=await(0,O.DI)(e.id);$.picture_url=(0,x.Kn)(l.picture_url),$.name=l.name,$.created_time=(0,x.p6)(l.created_time),$.updated_time=(0,x.p6)(l.updated_time),$.breadcrumbCategory=(0,x.vo)(t.state.allCategories,t.state.selectedCategory),$.isShow=!0}function le(e){S.warning({content:"确认删除资源？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await(0,O.fg)(e.id),l.success("操作成功！"),B()},onNegativeClick:()=>{}})}return(0,a.YP)((()=>R.isShow),(e=>{if(!e)for(const t in R.formData)Object.hasOwnProperty.call(R.formData,t)&&(R.formData[t]=null)})),(e,t)=>((0,a.wg)(),(0,a.iD)("div",z,[(0,a.Wm)((0,r.SU)(q.Z),{class:"categorie-tree-wrap"}),(0,a._)("div",H,[(0,a.Wm)((0,r.SU)(u.Z),{class:"filter"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(o.ZP),{"label-placement":"left",label:"关键字"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(s.Z),{value:R.query.key,"onUpdate:value":t[0]||(t[0]=e=>R.query.key=e),clearable:""},null,8,["value"])])),_:1}),(0,a.Wm)((0,r.SU)(o.ZP),{"label-placement":"left"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(d.ZP),{type:"primary",onClick:U},{default:(0,a.w5)((()=>[(0,a.Uk)(" 查询 ")])),_:1})])),_:1}),(0,a.Wm)((0,r.SU)(o.ZP),{"label-placement":"left"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(d.ZP),{onClick:h},{default:(0,a.w5)((()=>[(0,a.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1}),(0,r.SU)(k)||(0,r.SU)(D)?((0,a.wg)(),(0,a.j4)((0,r.SU)(u.Z),{key:0,class:"action"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(d.ZP),{type:"primary",onClick:Y},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(R.title),1)])),_:1})])),_:1})):(0,a.kq)("",!0),(0,a._)("div",E,[R.dataList.length?((0,a.wg)(),(0,a.j4)((0,r.SU)(m.Z),{key:1,"x-gap":8,"y-gap":8,cols:8,style:{"margin-top":"10px"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(R.dataList,((e,t)=>((0,a.wg)(),(0,a.j4)((0,r.SU)(p.ZP),{key:t},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(b.Z),{id:e.id,"file-name":e.name,"like-num":e.like_num,authority:!0,poster:(0,r.SU)(x.Kn)(e.picture_url),onOnEdit:t=>ee(e),onOnDetail:t=>te(e),onOnDelete:t=>le(e)},null,8,["id","file-name","like-num","poster","onOnEdit","onOnDetail","onOnDelete"])])),_:2},1024)))),128))])),_:1})):((0,a.wg)(),(0,a.j4)((0,r.SU)(c.Z),{key:0,description:"暂无数据",style:{"margin-top":"100px",flex:"1"}})),(0,a.Wm)((0,r.SU)(_.Z),{style:{"justify-content":"flex-end"},page:R.query.page_num,"onUpdate:page":t[1]||(t[1]=e=>R.query.page_num=e),"item-count":R.total,"on-update:page":G},null,8,["page","item-count"])])]),(0,a.Wm)((0,r.SU)(C.Z),{modelValue:R.isShow,"onUpdate:modelValue":t[4]||(t[4]=e=>R.isShow=e),title:R.title,onOnConfirm:N},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(f.Z),{ref_key:"resourceRef",ref:X,model:R.formData,rules:R.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(o.ZP),{label:"所在分区"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Q.value,((e,t)=>((0,a.wg)(),(0,a.iD)("span",null,[(0,a.Uk)((0,n.zw)(e)+" ",1),t!==Q.value.length-1?((0,a.wg)(),(0,a.iD)("span",T,"/")):(0,a.kq)("",!0)])))),256))])),_:1}),(0,a.Wm)((0,r.SU)(o.ZP),{label:"名称",path:"name"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(s.Z),{value:R.formData.name,"onUpdate:value":t[2]||(t[2]=e=>R.formData.name=e)},null,8,["value"])])),_:1}),(0,r.SU)(k)?((0,a.wg)(),(0,a.j4)((0,r.SU)(o.ZP),{key:0,label:"视频",path:"video_url"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(g.Z),{"directory-dnd":"",onChange:A},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(w.Z),null,{default:(0,a.w5)((()=>[(0,a._)("div",V,[(0,a.Wm)((0,r.SU)(y.g),{size:"48",depth:3},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(Z))])),_:1})]),(0,a.Wm)((0,r.SU)(v.Z),{style:{"font-size":"14px"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" 添加视频 ")])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0),(0,r.SU)(D)?((0,a.wg)(),(0,a.j4)((0,r.SU)(o.ZP),{key:1,label:"图片",path:"picture_url"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(g.Z),{"directory-dnd":"",onChange:A},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(w.Z),null,{default:(0,a.w5)((()=>[(0,a._)("div",I,[(0,a.Wm)((0,r.SU)(y.g),{size:"48",depth:3},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(W.Z))])),_:1})]),(0,a.Wm)((0,r.SU)(v.Z),{style:{"font-size":"16px"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" 上传图片 ")])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0),(0,a.Wm)((0,r.SU)(o.ZP),{label:"描述",path:"description"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,r.SU)(s.Z),{value:R.formData.description,"onUpdate:value":t[3]||(t[3]=e=>R.formData.description=e)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,a.Wm)((0,r.SU)(C.Z),{modelValue:$.isShow,"onUpdate:modelValue":t[5]||(t[5]=e=>$.isShow=e),title:"详细信息",isShowFooter:!1},{default:(0,a.w5)((()=>[(0,a._)("div",L,[(0,a._)("div",null,[(0,a._)("img",{style:{width:"250px","margin-right":"15px"},src:$.picture_url},null,8,K)]),(0,a._)("div",null,[(0,a.Wm)((0,r.SU)(o.ZP),{"label-placement":"left",label:"名称"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,n.zw)($.name),1)])),_:1}),(0,a.Wm)((0,r.SU)(o.ZP),{"label-placement":"left",label:"位置"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Q.value,((e,t)=>((0,a.wg)(),(0,a.iD)("span",null,[(0,a.Uk)((0,n.zw)(e)+" ",1),t!==Q.value.length-1?((0,a.wg)(),(0,a.iD)("span",M,"/")):(0,a.kq)("",!0)])))),256))])),_:1}),(0,a.Wm)((0,r.SU)(o.ZP),{"label-placement":"left",label:"上传时间"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,n.zw)($.created_time),1)])),_:1}),(0,a.Wm)((0,r.SU)(o.ZP),{"label-placement":"left",label:"最后修改"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,n.zw)($.updated_time),1)])),_:1})])])])),_:1},8,["modelValue"])]))}},F=l(40089);const X=(0,F.Z)(Y,[["__scopeId","data-v-dc4afce8"]]);var R=X}}]);
//# sourceMappingURL=297.2b6dba63.js.map