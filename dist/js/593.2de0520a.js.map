{"version":3,"file":"js/593.2de0520a.js","mappings":"oNAEO,SAASA,EAAsBC,GACpC,OAAOC,EAAAA,EAAAA,GAAQ,CACbC,IAAK,oBACLC,OAAQ,MACRH,UAEJ,CAEO,SAASI,EAAqBC,GACnC,OAAOJ,EAAAA,EAAAA,GAAQ,CACbC,IAAK,oBACLC,OAAQ,OACRE,QAEJ,CAEO,SAASC,EAAkBC,GAChC,OAAON,EAAAA,EAAAA,GAAQ,CACbC,IAAM,qBAAoBK,IAC1BJ,OAAQ,OAEZ,C,4ZCgGA,MAAM,QAAEK,IAAYC,EAAAA,EAAAA,GAAkB,CAAC,YAEjCC,GAAY,EACZC,GAAc,EACdC,EAAgB,CACpB,CACEC,MAAO,MACPC,MAAOJ,GAET,CACEG,MAAO,MACPC,MAAOH,IAGLI,EAAuB,CAC3B,CACEF,MAAO,MACPC,MAAO,QAET,CACED,MAAO,MACPC,MAAO,QAET,CACED,MAAO,MACPC,MAAO,QAET,CACED,MAAO,MACPC,MAAO,SAET,CACED,MAAO,KACPC,MAAO,SAET,CACED,MAAO,KACPC,MAAO,SAET,CACED,MAAO,KACPC,MAAO,SAET,CACED,MAAO,KACPC,MAAO,WAGLE,EAAU,CACd,CACEC,MAAO,KACPC,IAAK,sBAEP,CACED,MAAO,MACPC,IAAK,uBACLC,OAAOC,GACL,OAAOC,EAAAA,EAAAA,GACLC,EAAAA,GACA,CACE,sBAAuBF,EAAIG,gBAAgBhB,KAC3CiB,GAAIJ,EAAIG,gBAAgBhB,KACxBkB,UACEC,EAAYN,EAAIG,gBAAgBhB,MAChCC,EAAQmB,QAAQ,QAClB,GAEFP,EAAIG,gBAAgBhB,KAExB,GAEF,CACEU,MAAO,OACPC,IAAK,iBAEP,CACED,MAAO,MACPC,IAAK,iCACLC,OAAOC,GACL,OAAOC,EAAAA,EAAAA,GACL,OACA,KACAD,EAAIG,gBAAgBK,eAAiB,MAAc,IAEvD,GAEF,CACEX,MAAO,KACPC,IAAK,SACLC,OAAOC,GACL,OAAOC,EAAAA,EAAAA,GACL,OACA,CACEQ,MAAO,CACLC,MAAOV,EAAIG,gBAAgBQ,QAAU,MAAQ,UAGjDX,EAAIG,gBAAgBQ,QAAU,MAAQ,MAE1C,GAEF,CACEd,MAAO,OACPC,IAAK,eACLC,OAAOC,GACL,OAAOC,EAAAA,EAAAA,GACL,OACA,KACAW,IAA0C,IAAnCZ,EAAIG,gBAAgBU,cAAqBC,OAC9C,wBACG,KAET,GAEF,CACEjB,MAAO,OACPC,IAAK,UACLC,OAAOC,GACL,OAAOC,EAAAA,EAAAA,GAAE,OAAQ,KAAMD,EAAIG,gBAAgBQ,SAAW,KACxD,GAEF,CACEd,MAAO,OACPC,IAAK,WACLC,OAAOC,GACL,OAAOC,EAAAA,EAAAA,GACL,OACA,KACAD,EAAIG,gBAAgBY,SAChBH,IAAsC,IAA/BZ,EAAIG,gBAAgBY,UAAiBD,OAC1C,uBAEF,KAER,IAIJ,IAAIE,EAAY,KACZC,GAAUC,EAAAA,EAAAA,KAAI,GACdC,GAA2BD,EAAAA,EAAAA,IAAI,MAEnCE,IAEA,MAAMd,EAAeF,IACdY,GACHK,EAAcjB,GAEhBY,EAAUM,GAAG,WAAYC,IACvBC,QAAQC,IAAI,aACZF,EAAEG,iBACFL,EAAcjB,EAAG,IAEnBY,EAAUM,GAAG,SAAUC,IACrBC,QAAQC,IAAI,YAAY,GACxB,EAGEJ,EAAiBjB,IACrBY,GAAaA,EAAUW,UACvBX,EAAY,KACZA,EAAY,IAAIY,IAAJ,CAAe,IAAGxB,IAAK,EAGrCyB,eAAeT,IACb,MAAMU,QAAYC,EAAAA,EAAAA,MAClBZ,EAAyBzB,MAAQoC,EAAIE,OAAS,GAC9Cf,EAAQvB,OAAQ,CAClB,CAEA,MAAMuC,EAAQ,KACZC,EAAiBxC,MAAMyC,SAAW,EAClCC,GAAsB,EAElBC,EAAQ,KACZH,EAAiBxC,MAAM4C,YAAc,KACrCJ,EAAiBxC,MAAM6C,UAAY,KACnCL,EAAiBxC,MAAMI,IAAM,IAAI,EAG7B0C,GAAgBtB,EAAAA,EAAAA,IAAI,MACpBuB,GAAaC,EAAAA,EAAAA,IAAS,CAC1BC,QAAQ,EACR9C,MAAO,QACP+C,UAAU1B,EAAAA,EAAAA,IAAI,CACZoB,YAAa,KACb9B,eAAgB,KAChBqC,sBAAuB,OAEzBC,MAAO,CACLR,YAAa,CACXS,UAAU,EACVC,QAAS,CAAC,OAAQ,UAClB5D,QAAS,QACT6D,KAAM,UAERzC,eAAgB,CACduC,UAAU,EACVC,QAAS,CAAC,OAAQ,UAClB5D,QAAS,SACT6D,KAAM,UAERJ,sBAAuB,CACrBE,UAAU,EACVC,QAAS,CAAC,OAAQ,SAClB5D,QAAS,YAKf,SAAS8D,IACPV,EAAc9C,OACVyD,UAAStB,UACJuB,UACGpE,EAAAA,EAAAA,IAAqB,IACtByD,EAAWG,SACdC,sBAAuBQ,SACrBZ,EAAWG,SAASC,yBAGxBJ,EAAWE,QAAS,EACpBvD,EAAQmB,QAAQ,SAChB6B,IACF,IAEDkB,OACL,EAEAC,EAAAA,EAAAA,KACE,IAAMd,EAAWE,SAChBa,IACC,IAAKA,EACH,IAAK,MAAM1D,KAAO2C,EAAWG,SACvBa,OAAOC,eAAeC,KAAKlB,EAAWG,SAAU9C,KAClD2C,EAAWG,SAAS9C,GAAO,KAGjC,IAIJ,MAAMoC,GAAmBhB,EAAAA,EAAAA,IAAI,CAC3BiB,SAAU,EACVyB,UAAW,GACXtB,YAAa,KACbC,UAAW,KACXzC,IAAK,OAED+D,GAAQ3C,EAAAA,EAAAA,IAAI,GAEZ4C,GAAW5C,EAAAA,EAAAA,IAAI,IAErBW,eAAeO,IACb,MAAMN,QAAYnD,EAAAA,EAAAA,IAAsBuD,EAAiBxC,OACzDoE,EAASpE,MAAQoC,EAAIiC,kBAAoB,GACzCF,EAAMnE,MAAQoC,EAAI+B,KACpB,CAEA,SAASG,EAAWC,GAClB/B,EAAiBxC,MAAMyC,SAAW8B,EAClC7B,GACF,C,OAEAA,I,ulGCxXA,MAAM8B,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://cloud_dist/./src/api/activation.js","webpack://cloud_dist/./src/views/pc/ActivationManage.vue","webpack://cloud_dist/./src/views/pc/ActivationManage.vue?6632"],"sourcesContent":["import request from '@/common/request';\r\n\r\nexport function getActivationCodeList(params) {\r\n  return request({\r\n    url: '/activation-codes',\r\n    method: 'get',\r\n    params,\r\n  });\r\n}\r\n\r\nexport function createActivationCode(data) {\r\n  return request({\r\n    url: '/activation-codes',\r\n    method: 'post',\r\n    data,\r\n  });\r\n}\r\n\r\nexport function useActivationCode(code) {\r\n  return request({\r\n    url: `/activation-codes/${code}`,\r\n    method: 'put',\r\n  });\r\n}\r\n","<template>\r\n  <div class=\"activation-code-manage-container\">\r\n    <n-space class=\"filter\">\r\n      <n-form-item label-placement=\"left\" label=\"激活分区\">\r\n        <n-select\r\n          v-model:value=\"activationParams.category_id\"\r\n          label-field=\"name\"\r\n          value-field=\"id\"\r\n          :options=\"categoryListWithOneLevel\"\r\n          style=\"width: 150px\"\r\n          clearable\r\n        />\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\" label=\"状态\">\r\n        <n-select\r\n          v-model:value=\"activationParams.activated\"\r\n          :options=\"statusOptions\"\r\n          style=\"width: 150px\"\r\n          clearable\r\n        />\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\" label=\"关键字\">\r\n        <n-input\r\n          v-model:value=\"activationParams.key\"\r\n          placeholder=\"激活码\"\r\n          clearable\r\n        ></n-input>\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\">\r\n        <n-button type=\"primary\" @click=\"query\"> 查询 </n-button>\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\">\r\n        <n-button @click=\"reset\"> 重置 </n-button>\r\n      </n-form-item>\r\n    </n-space>\r\n\r\n    <n-space class=\"action\">\r\n      <n-button type=\"primary\" @click=\"activation.isShow = true\">\r\n        新增激活码\r\n      </n-button>\r\n    </n-space>\r\n\r\n    <div style=\"display: flex; flex-direction: column\">\r\n      <n-data-table\r\n        :loading=\"loading\"\r\n        :columns=\"columns\"\r\n        :data=\"dataList\"\r\n        :bordered=\"false\"\r\n        :on-update:page=\"(page) => (activationParams.page_num = page)\"\r\n        :on-update:page-size=\"(size) => (activationParams.page_size = size)\"\r\n      />\r\n      <n-pagination\r\n        v-model:page=\"activationParams.page_num\"\r\n        :item-count=\"total\"\r\n        :on-update:page=\"changePage\"\r\n        style=\"align-self: flex-end; margin-top: 10px\"\r\n      />\r\n    </div>\r\n\r\n    <popup-window\r\n      v-model=\"activation.isShow\"\r\n      :title=\"activation.title\"\r\n      @on-confirm=\"onActivationConfirm\"\r\n    >\r\n      <n-form\r\n        ref=\"activationRef\"\r\n        :model=\"activation.formData\"\r\n        :rules=\"activation.rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"激活分区\" path=\"category_id\">\r\n          <n-select\r\n            v-model:value=\"activation.formData.category_id\"\r\n            label-field=\"name\"\r\n            value-field=\"id\"\r\n            :options=\"categoryListWithOneLevel\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"有效期\" path=\"valid_duration\">\r\n          <n-select\r\n            v-model:value=\"activation.formData.valid_duration\"\r\n            :options=\"validDurationOptions\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"数量\" path=\"activation_code_count\">\r\n          <n-input v-model:value=\"activation.formData.activation_code_count\" />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  createDiscreteApi,\r\n  NSelect,\r\n  NFormItem,\r\n  NBreadcrumbItem,\r\n  NIcon,\r\n  NInput,\r\n  NForm,\r\n  NTag,\r\n  NSpace,\r\n  NGrid,\r\n  NGridItem,\r\n  NButton,\r\n  NInputNumber,\r\n  NDataTable,\r\n  NPagination,\r\n} from 'naive-ui';\r\nimport { ref, h, reactive, watch, onMounted } from 'vue';\r\nimport PopupWindow from '@/components/pc/PopupWindow';\r\nimport { getCategorieList } from '@/api/categories';\r\nimport { createActivationCode, getActivationCodeList } from '@/api/activation';\r\nimport moment from 'moment';\r\nimport Clipboard from 'clipboard';\r\n\r\nconst { message } = createDiscreteApi(['message']);\r\n\r\nconst TYPE_USED = true;\r\nconst TYPE_UNUSED = false;\r\nconst statusOptions = [\r\n  {\r\n    label: '已使用',\r\n    value: TYPE_USED,\r\n  },\r\n  {\r\n    label: '未使用',\r\n    value: TYPE_UNUSED,\r\n  },\r\n];\r\nconst validDurationOptions = [\r\n  {\r\n    label: '1个月',\r\n    value: 3600 * 24 * 30,\r\n  },\r\n  {\r\n    label: '2个月',\r\n    value: 3600 * 24 * 30 * 2,\r\n  },\r\n  {\r\n    label: '3个月',\r\n    value: 3600 * 24 * 30 * 3,\r\n  },\r\n  {\r\n    label: '6个月',\r\n    value: 3600 * 24 * 30 * 6,\r\n  },\r\n  {\r\n    label: '1年',\r\n    value: 3600 * 24 * 365,\r\n  },\r\n  {\r\n    label: '2年',\r\n    value: 3600 * 24 * 365 * 2,\r\n  },\r\n  {\r\n    label: '3年',\r\n    value: 3600 * 24 * 365 * 3,\r\n  },\r\n  {\r\n    label: '4年',\r\n    value: 3600 * 24 * 365 * 4,\r\n  },\r\n];\r\nconst columns = [\r\n  {\r\n    title: '编号',\r\n    key: 'activation_code.id',\r\n  },\r\n  {\r\n    title: '激活码',\r\n    key: 'activation_code.code',\r\n    render(row) {\r\n      return h(\r\n        NButton,\r\n        {\r\n          'data-clipboard-text': row.activation_code.code,\r\n          id: row.activation_code.code,\r\n          onClick() {\r\n            copyContact(row.activation_code.code);\r\n            message.success('复制成功！');\r\n          },\r\n        },\r\n        row.activation_code.code\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '激活分区',\r\n    key: 'category.name',\r\n  },\r\n  {\r\n    title: '有效期',\r\n    key: 'activation_code.valid_duration',\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        null,\r\n        row.activation_code.valid_duration / (3600 * 24) + '天'\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '状态',\r\n    key: 'status',\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        {\r\n          style: {\r\n            color: row.activation_code.user_id ? 'red' : 'green',\r\n          },\r\n        },\r\n        row.activation_code.user_id ? '已使用' : '未使用'\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '创建时间',\r\n    key: 'created_time',\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        null,\r\n        moment(row.activation_code.created_time * 1000).format(\r\n          'YYYY-MM-DD HH:mm:ss'\r\n        ) || '--'\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '用户ID',\r\n    key: 'user_id',\r\n    render(row) {\r\n      return h('span', null, row.activation_code.user_id || '--');\r\n    },\r\n  },\r\n  {\r\n    title: '使用时间',\r\n    key: 'use_time',\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        null,\r\n        row.activation_code.use_time\r\n          ? moment(row.activation_code.use_time * 1000).format(\r\n              'YYYY-MM-DD HH:mm:ss'\r\n            )\r\n          : '--'\r\n      );\r\n    },\r\n  },\r\n];\r\n\r\nlet clipboard = null;\r\nlet loading = ref(true);\r\nlet categoryListWithOneLevel = ref(null);\r\n\r\ngetCategoryListWithOneLevel();\r\n\r\nconst copyContact = (id) => {\r\n  if (!clipboard) {\r\n    initClipboard(id);\r\n  }\r\n  clipboard.on('success', (e) => {\r\n    console.log('copy succ');\r\n    e.clearSelection();\r\n    initClipboard(id);\r\n  });\r\n  clipboard.on('error', (e) => {\r\n    console.log('copy fail');\r\n  });\r\n};\r\n\r\nconst initClipboard = (id) => {\r\n  clipboard && clipboard.destroy();\r\n  clipboard = null;\r\n  clipboard = new Clipboard(`#${id}`);\r\n};\r\n\r\nasync function getCategoryListWithOneLevel() {\r\n  const res = await getCategorieList();\r\n  categoryListWithOneLevel.value = res.items || [];\r\n  loading.value = false;\r\n}\r\n\r\nconst query = () => {\r\n  activationParams.value.page_num = 1;\r\n  renderActivationList();\r\n};\r\nconst reset = () => {\r\n  activationParams.value.category_id = null;\r\n  activationParams.value.activated = null;\r\n  activationParams.value.key = null;\r\n};\r\n\r\nconst activationRef = ref(null);\r\nconst activation = reactive({\r\n  isShow: false,\r\n  title: '创建激活码',\r\n  formData: ref({\r\n    category_id: null,\r\n    valid_duration: null,\r\n    activation_code_count: null,\r\n  }),\r\n  rules: {\r\n    category_id: {\r\n      required: true,\r\n      trigger: ['blur', 'change'],\r\n      message: '请选择分区',\r\n      type: 'number',\r\n    },\r\n    valid_duration: {\r\n      required: true,\r\n      trigger: ['blur', 'change'],\r\n      message: '请选择有效期',\r\n      type: 'number',\r\n    },\r\n    activation_code_count: {\r\n      required: true,\r\n      trigger: ['blur', 'input'],\r\n      message: '请输入数量',\r\n    },\r\n  },\r\n});\r\n\r\nfunction onActivationConfirm() {\r\n  activationRef.value\r\n    ?.validate(async (errors) => {\r\n      if (!errors) {\r\n        await createActivationCode({\r\n          ...activation.formData,\r\n          activation_code_count: parseInt(\r\n            activation.formData.activation_code_count\r\n          ),\r\n        });\r\n        activation.isShow = false;\r\n        message.success('操作成功！');\r\n        renderActivationList();\r\n      }\r\n    })\r\n    .catch();\r\n}\r\n\r\nwatch(\r\n  () => activation.isShow,\r\n  (val) => {\r\n    if (!val) {\r\n      for (const key in activation.formData) {\r\n        if (Object.hasOwnProperty.call(activation.formData, key)) {\r\n          activation.formData[key] = null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n);\r\n\r\nconst activationParams = ref({\r\n  page_num: 1,\r\n  page_size: 10,\r\n  category_id: null,\r\n  activated: null,\r\n  key: null,\r\n});\r\nconst total = ref(0);\r\n\r\nconst dataList = ref([]);\r\n\r\nasync function renderActivationList() {\r\n  const res = await getActivationCodeList(activationParams.value);\r\n  dataList.value = res.activation_codes || [];\r\n  total.value = res.total;\r\n}\r\n\r\nfunction changePage(page) {\r\n  activationParams.value.page_num = page;\r\n  renderActivationList();\r\n}\r\n\r\nrenderActivationList();\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.activation-code-manage-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 10px;\r\n  background: #fff;\r\n  box-sizing: border-box;\r\n  .action {\r\n    margin-bottom: 15px;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./ActivationManage.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActivationManage.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ActivationManage.vue?vue&type=style&index=0&id=144481b7&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-144481b7\"]])\n\nexport default __exports__"],"names":["getActivationCodeList","params","request","url","method","createActivationCode","data","useActivationCode","code","message","createDiscreteApi","TYPE_USED","TYPE_UNUSED","statusOptions","label","value","validDurationOptions","columns","title","key","render","row","h","NButton","activation_code","id","onClick","copyContact","success","valid_duration","style","color","user_id","moment","created_time","format","use_time","clipboard","loading","ref","categoryListWithOneLevel","getCategoryListWithOneLevel","initClipboard","on","e","console","log","clearSelection","destroy","Clipboard","async","res","getCategorieList","items","query","activationParams","page_num","renderActivationList","reset","category_id","activated","activationRef","activation","reactive","isShow","formData","activation_code_count","rules","required","trigger","type","onActivationConfirm","validate","errors","parseInt","catch","watch","val","Object","hasOwnProperty","call","page_size","total","dataList","activation_codes","changePage","page","__exports__"],"sourceRoot":""}