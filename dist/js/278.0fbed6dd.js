"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[278],{70278:function(e,s,t){t.r(s),t.d(s,{default:function(){return T}});t(57658);var r=t(73396),a=t(87139),n=t(44870),u=t(75869),i=t(74786),c=t(28040),o=t(19785),l=t(22483),d=t(59684),m=t(10796),_=t(137),p=t.n(_),y=t(45140),g=t(20065);const v={class:"res-detail-container"},h={class:"header"},w={class:"title"},f={class:"name"},N={class:"content"},C=["id"],R=["id","src"];var I={__name:"ResourceDetail",setup(e){const s=(0,l.yj)(),t=(0,l.tv)(),_=(0,g.oR)(),I=(0,n.qj)({dataList:[],resCurrentNum:0,resTotalNums:0,resName:"",currentRes:(0,n.iH)(null)}),q=(0,n.iH)(1);function L(){const e=[m.U5.FAVORITE,m.U5.MY_FAVORITE].includes(_.state.selectedCategory.id);try{e?k():T()}catch(s){}}async function T(){const e=await(0,d.rT)({...s.query,page_num:q.value}),t=e.resources||[];if(I.dataList.push(...t),q.value<s.query.page_num)return q.value++,void T();I.resTotalNums=e.total,I.dataList.find(((e,t)=>{e.id==s.query.currentId&&(I.resCurrentNum=t+1,I.resName=e.name,I.currentRes=e)}))}async function k(){const e=await(0,y.P$)({page_num:q.value,page_size:s.query.page_size,resource_type:s.query.resource_type,favorite_type:_.state.selectedCategory.id}),t=(e.likes||[]).map((e=>({...e.resource,has_permissions:e.has_permissions})));if(I.dataList.push(...t),q.value<s.query.page_num)return q.value++,void k();I.resTotalNums=e.total,I.dataList.find(((e,t)=>{e.id==s.query.currentId&&(I.resCurrentNum=t+1,I.resName=e.name,I.currentRes=e)}))}function S(){if(p().isSupported()){const e=new(p()),s=document.querySelector("#"+("video"+I.currentRes.id));e.loadSource((0,m.Kn)(I.currentRes.video_url)),e.attachMedia(s),s.play()}else console.warn("当前浏览器不支持Hls.js")}try{L()}catch(V){}(0,r.YP)((()=>_.state.selectedCategory),(e=>{L()})),(0,r.YP)((()=>I.currentRes),(e=>{"VIDEO"===e.resource_type&&(0,r.Y3)((()=>{S()}))}));const U=[o.W_],D=e=>{e.slideTo(I.resCurrentNum-1),console.log(e)},z=e=>{console.log("slide change"),E(e.realIndex).then((()=>{I.resCurrentNum=e.realIndex+1,I.currentRes=I.dataList[e.realIndex],I.resName=I.dataList[e.realIndex].name}))};async function E(e){const s=[m.U5.FAVORITE,m.U5.MY_FAVORITE].includes(_.state.selectedCategory.id);return new Promise((t=>{e===I.dataList.length-1&&I.dataList.length<I.resTotalNums?(q.value++,s?k().then((()=>t())):T().then((()=>t()))):t()}))}function O(){t.push({path:"/resource"})}return(e,s)=>((0,r.wg)(),(0,r.iD)("div",v,[(0,r._)("div",h,[(0,r._)("div",w,[(0,r._)("div",f,(0,a.zw)(I.resName),1),(0,r._)("div",null,(0,a.zw)(I.resCurrentNum)+"/"+(0,a.zw)(I.resTotalNums)+"个文件",1)]),(0,r.Wm)((0,n.SU)(i.g),{class:"close-btn",size:"20",onClick:O},{default:(0,r.w5)((()=>[(0,r.Wm)((0,n.SU)(u.Z),{class:"close-icon"})])),_:1})]),(0,r._)("div",N,[I.currentRes?((0,r.wg)(),(0,r.j4)((0,n.SU)(c.tq),{key:0,navigation:!0,modules:U,class:"res-swiper",onSwiper:D,onSlideChange:z},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(I.dataList,(e=>((0,r.wg)(),(0,r.j4)((0,n.SU)(c.o5),{class:"res-item"},{default:(0,r.w5)((()=>["VIDEO"===e.resource_type?((0,r.wg)(),(0,r.iD)("video",{key:0,id:"video"+e.id,class:"res",muted:"",controls:"",controlsList:"nodownload"},null,8,C)):((0,r.wg)(),(0,r.iD)("img",{key:1,id:"picture"+e.id,src:(0,n.SU)(m.Kn)(e.picture_url),style:{"":"100%","max-height":"100%"}},null,8,R))])),_:2},1024)))),256))])),_:1})):(0,r.kq)("",!0)])]))}},q=t(40089);const L=(0,q.Z)(I,[["__scopeId","data-v-40876be1"]]);var T=L}}]);
//# sourceMappingURL=278.0fbed6dd.js.map