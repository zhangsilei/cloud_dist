"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[722],{24115:function(e,a,t){t.r(a),t.d(a,{default:function(){return T}});t(57658);var l=t(73396),u=t(44870),r=t(87139),i=t(24120),n=t(5941),o=t(92097),s=t(33008),c=t(55393),d=t(86973),m=t(9518),p=t(85210),_=t(26429),f=t(83273),g=t(96616),y=t(50631),w=(t(18244),t(26405)),S=t(43612),v=t(44831),U=(t(59063),t(30627)),k=t(10796),h=t(59684),D=t(20065),Z=(t(36797),t(22483));const b={class:"resource-manage-container"},W={class:"resource-wrap"},q={class:"content"},P={key:0},C={style:{display:"flex"}},O=["src"],j={key:0};var x={__name:"ResourceManage",setup(e){const a=(0,Z.tv)(),t=(0,D.oR)(),{message:x,dialog:H}=(0,i.M)(["message","dialog"]);function E(){M()}function T(){Y.query.key=null}const V=(0,l.Fl)((()=>Y.query.resource_type===k.XE.VIDEOS)),z=(0,l.Fl)((()=>Y.query.resource_type===k.XE.PHOTOS));function I(){Y.formData.category_id=A.value,Y.formData.resource_type=Y.query.resource_type,Y.isShow=!0}const K=(0,u.iH)(null),L=(0,u.iH)(null),Y=(0,u.qj)({loading:!1,isShow:!1,title:null,dataList:[],total:0,query:{page_num:1,page_size:10,category_id:null,key:null,order_by:k.qf.DEFAULT,resource_type:null},resource_id:null,formData:(0,u.iH)({category_id:null,resource_type:null,name:null,description:null,picture_url:null,video_url:null}),rules:{name:{required:!0,trigger:["blur","input"],message:"请输入名称"},video_url:{required:!0,trigger:["blur","change"],message:"请上传资源"}}});function F({file:e}){K.value=e,e.status="uploading",e.percentage=0;const a=setInterval((()=>{"finished"!==K.value.status?K.value.percentage+=30*Math.random():clearInterval(a)}),1e3);V.value&&(0,U.A)(e).then((({picture_url:e,video_url:a})=>{Y.formData.picture_url=e,Y.formData.video_url=a,K.value.percentage=100,setTimeout((()=>{K.value.status="finished"}),0)})),z.value&&(0,U.g)(e).then((({url:e})=>{Y.formData.picture_url=e,Y.formData.video_url="",K.value.percentage=100,setTimeout((()=>{K.value.status="finished"}),0)}))}function X(){L.value?.validate((async e=>{e||(Y.resource_id?await(0,h.id)(Y.resource_id,Y.formData):await(0,h.SN)(Y.formData),Y.isShow=!1,x.success("操作成功！"),M())})).catch()}async function M(){Y.loading=!0;const e=await(0,h.rT)(Y.query);Y.dataList=e.resources||[],Y.total=e.total,Y.loading=!1}function R(e){Y.query.page_num=e,M()}const A=(0,u.iH)(null),N=(0,u.iH)([]);(0,l.YP)(t.state,(e=>{const a=e.selectedCategory.dirType,t=a?e.selectedCategory.category_id:e.selectedCategory.id,l={[k.XE.VIDEOS]:"上传视频",[k.XE.PHOTOS]:"上传图片"};A.value=t,N.value=(0,k.vo)(e.allCategories,t),Y.title=l[a],Y.formData.category_id=t,Y.formData.resource_type=a,Y.query.category_id=t,Y.query.resource_type=a,void 0!==a?M():Y.dataList=[]}));const B=(0,u.qj)({isShow:!1,picture_url:"",name:"",created_time:"",updated_time:"",breadcrumbCategory:[]});function G(e){Y.resource_id=e.id,Y.formData.category_id=e.category_id,Y.formData.name=e.name,Y.formData.description=e.description,Y.formData.picture_url=e.picture_url,Y.formData.video_url=e.video_url,Y.formData.resource_type=e.resource_type,Y.isShow=!0}async function J(e){const a=await(0,h.DI)(e.id);B.picture_url=(0,k.Kn)(a.picture_url),B.name=a.name,B.created_time=(0,k.p6)(a.created_time),B.updated_time=(0,k.p6)(a.updated_time),B.breadcrumbCategory=(0,k.vo)(t.state.allCategories,t.state.selectedCategory),B.isShow=!0}function Q(e){H.warning({content:"确认删除资源？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await(0,h.fg)(e.id),x.success("操作成功！"),M()},onNegativeClick:()=>{}})}function $(e){a.push({path:"/resource/detail",query:{...Y.query,currentId:e.id}})}return(0,l.YP)((()=>Y.isShow),(e=>{if(!e)for(const a in Y.formData)Object.hasOwnProperty.call(Y.formData,a)&&(Y.formData[a]=null)})),(e,a)=>((0,l.wg)(),(0,l.iD)("div",b,[(0,l.Wm)((0,u.SU)(v.Z),{class:"categorie-tree-wrap"}),(0,l._)("div",W,[(0,l.Wm)((0,u.SU)(n.Z),{class:"filter"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"关键字"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(s.Z),{value:Y.query.key,"onUpdate:value":a[0]||(a[0]=e=>Y.query.key=e),clearable:""},null,8,["value"])])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),{type:"primary",onClick:E},{default:(0,l.w5)((()=>[(0,l.Uk)(" 查询 ")])),_:1})])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),{onClick:T},{default:(0,l.w5)((()=>[(0,l.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1}),(0,u.SU)(V)||(0,u.SU)(z)?((0,l.wg)(),(0,l.j4)((0,u.SU)(n.Z),{key:0,class:"action"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),{type:"primary",onClick:I},{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(Y.title),1)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l._)("div",q,[Y.dataList.length?((0,l.wg)(),(0,l.j4)((0,u.SU)(m.Z),{key:1,"x-gap":8,"y-gap":8,cols:8,style:{"margin-top":"10px"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(Y.dataList,((e,a)=>((0,l.wg)(),(0,l.j4)((0,u.SU)(p.ZP),{key:a},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(w.Z),{id:e.id,"is-like":e.is_like,"file-name":e.name,"like-num":e.like_num,authority:!0,poster:(0,u.SU)(k.Kn)(e.picture_url),onOnEdit:a=>G(e),onOnDetail:a=>J(e),onOnDelete:a=>Q(e),onClick:a=>$(e)},null,8,["id","is-like","file-name","like-num","poster","onOnEdit","onOnDetail","onOnDelete","onClick"])])),_:2},1024)))),128))])),_:1})):((0,l.wg)(),(0,l.j4)((0,u.SU)(d.Z),{key:0,description:"暂无数据",style:{"margin-top":"100px",flex:"1"}})),(0,l.Wm)((0,u.SU)(_.Z),{style:{"justify-content":"flex-end"},page:Y.query.page_num,"onUpdate:page":a[1]||(a[1]=e=>Y.query.page_num=e),"item-count":Y.total,"on-update:page":R},null,8,["page","item-count"])])]),(0,l.Wm)((0,u.SU)(S.Z),{modelValue:Y.isShow,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.isShow=e),title:Y.title,onOnConfirm:X},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(f.Z),{ref_key:"resourceRef",ref:L,model:Y.formData,rules:Y.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(o.ZP),{label:"所在分区"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(N.value,((e,a)=>((0,l.wg)(),(0,l.iD)("span",null,[(0,l.Uk)((0,r.zw)(e)+" ",1),a!==N.value.length-1?((0,l.wg)(),(0,l.iD)("span",P,"/")):(0,l.kq)("",!0)])))),256))])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{label:"名称",path:"name"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(s.Z),{value:Y.formData.name,"onUpdate:value":a[2]||(a[2]=e=>Y.formData.name=e)},null,8,["value"])])),_:1}),(0,u.SU)(V)?((0,l.wg)(),(0,l.j4)((0,u.SU)(o.ZP),{key:0,label:"视频",path:"video_url"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(n.Z),null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(g.Z),{"directory-dnd":"",onChange:F},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),null,{default:(0,l.w5)((()=>[(0,l.Uk)("上传视频")])),_:1})])),_:1}),Y.formData.picture_url?((0,l.wg)(),(0,l.j4)((0,u.SU)(y.Z),{key:0,src:(0,u.SU)(k.Kn)(Y.formData.picture_url),style:{height:"100px"}},null,8,["src"])):(0,l.kq)("",!0)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,u.SU)(z)?((0,l.wg)(),(0,l.j4)((0,u.SU)(o.ZP),{key:1,label:"图片",path:"picture_url"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(n.Z),null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(g.Z),{"directory-dnd":"",onChange:F},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),null,{default:(0,l.w5)((()=>[(0,l.Uk)("上传图片")])),_:1})])),_:1}),Y.formData.picture_url?((0,l.wg)(),(0,l.j4)((0,u.SU)(y.Z),{key:0,src:(0,u.SU)(k.Kn)(Y.formData.picture_url),style:{height:"100px"}},null,8,["src"])):(0,l.kq)("",!0)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l.Wm)((0,u.SU)(o.ZP),{label:"描述",path:"description"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(s.Z),{value:Y.formData.description,"onUpdate:value":a[3]||(a[3]=e=>Y.formData.description=e)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,l.Wm)((0,u.SU)(S.Z),{modelValue:B.isShow,"onUpdate:modelValue":a[5]||(a[5]=e=>B.isShow=e),title:"详细信息",isShowFooter:!1},{default:(0,l.w5)((()=>[(0,l._)("div",C,[(0,l._)("div",null,[(0,l._)("img",{style:{width:"250px","margin-right":"15px"},src:B.picture_url},null,8,O)]),(0,l._)("div",null,[(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"名称"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(B.name),1)])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"位置"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(N.value,((e,a)=>((0,l.wg)(),(0,l.iD)("span",null,[(0,l.Uk)((0,r.zw)(e)+" ",1),a!==N.value.length-1?((0,l.wg)(),(0,l.iD)("span",j,"/")):(0,l.kq)("",!0)])))),256))])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"上传时间"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(B.created_time),1)])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"最后修改"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(B.updated_time),1)])),_:1})])])])),_:1},8,["modelValue"])]))}},H=t(40089);const E=(0,H.Z)(x,[["__scopeId","data-v-18716cda"]]);var T=E}}]);
//# sourceMappingURL=722.32ce4047.js.map