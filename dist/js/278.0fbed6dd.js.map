{"version":3,"file":"js/278.0fbed6dd.js","mappings":"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","sources":["webpack://cloud_dist/./src/views/pc/ResourceDetail.vue","webpack://cloud_dist/./src/views/pc/ResourceDetail.vue?66e4"],"sourcesContent":["<template>\r\n  <div class=\"res-detail-container\">\r\n    <div class=\"header\">\r\n      <div class=\"title\">\r\n        <div class=\"name\">{{ state.resName }}</div>\r\n        <div>{{ state.resCurrentNum }}/{{ state.resTotalNums }}个文件</div>\r\n      </div>\r\n      <n-icon class=\"close-btn\" size=\"20\" @click=\"goToResourcePage\">\r\n        <close class=\"close-icon\" />\r\n      </n-icon>\r\n    </div>\r\n\r\n    <div class=\"content\">\r\n      <swiper\r\n        v-if=\"state.currentRes\"\r\n        :navigation=\"true\"\r\n        :modules=\"modules\"\r\n        class=\"res-swiper\"\r\n        @swiper=\"onSwiper\"\r\n        @slideChange=\"onSlideChange\"\r\n      >\r\n        <swiper-slide class=\"res-item\" v-for=\"item in state.dataList\">\r\n          <template v-if=\"item.resource_type === 'VIDEO'\">\r\n            <video\r\n              :id=\"'video' + item.id\"\r\n              class=\"res\"\r\n              muted\r\n              controls\r\n              controlsList=\"nodownload\"\r\n            >\r\n              <!-- <source\r\n                :src=\"parseUrlToPath(item.video_url)\"\r\n                type=\"application/x-mpegURL\"\r\n              /> -->\r\n            </video>\r\n          </template>\r\n          <template v-else>\r\n            <img\r\n              :id=\"'picture' + item.id\"\r\n              :src=\"parseUrlToPath(item.picture_url)\"\r\n              style=\"width;: 100%;max-height:100%\"\r\n            />\r\n            <!-- <n-image :src=\"parseUrlToPath(item.picture_url)\" lazy /> -->\r\n          </template>\r\n        </swiper-slide>\r\n      </swiper>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, watch, nextTick, onMounted } from 'vue';\r\nimport { Close } from '@vicons/ionicons5';\r\nimport { NIcon, NImage } from 'naive-ui';\r\n// Import Swiper Vue.js components\r\nimport { Swiper, SwiperSlide } from 'swiper/vue';\r\n// Import Swiper styles\r\nimport 'swiper/css';\r\nimport 'swiper/css/navigation';\r\n// import required modules\r\nimport { Navigation } from 'swiper';\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport { getResourceList } from '@/api/resource';\r\nimport {\r\n  RESOURCE_TYPE_VIDEO,\r\n  RESOURCE_TYPE_PICTURE,\r\n  favoriteTypeEnum,\r\n  parseUrlToPath,\r\n} from '@/common/global';\r\nimport Hls from 'hls.js';\r\nimport { getLikeList } from '@/api/like';\r\nimport { useStore } from 'vuex';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst store = useStore();\r\n\r\nconst state = reactive({\r\n  dataList: [],\r\n  resCurrentNum: 0,\r\n  resTotalNums: 0,\r\n  resName: '',\r\n  currentRes: ref(null),\r\n});\r\n\r\nconst page_num = ref(1);\r\n\r\nfunction init() {\r\n  const isFromFavorite = [\r\n    favoriteTypeEnum.FAVORITE,\r\n    favoriteTypeEnum.MY_FAVORITE,\r\n  ].includes(store.state.selectedCategory.id);\r\n  try {\r\n    if (isFromFavorite) {\r\n      renderFavorite();\r\n    } else {\r\n      renderResources();\r\n    }\r\n  } catch (e) {}\r\n}\r\n\r\nasync function renderResources() {\r\n  const res = await getResourceList({\r\n    ...route.query,\r\n    page_num: page_num.value,\r\n  });\r\n  const dataList = res.resources || [];\r\n  state.dataList.push(...dataList);\r\n\r\n  if (page_num.value < route.query.page_num) {\r\n    page_num.value++;\r\n    renderResources();\r\n    return;\r\n  }\r\n\r\n  state.resTotalNums = res.total;\r\n  state.dataList.find((item, index) => {\r\n    if (item.id == route.query.currentId) {\r\n      state.resCurrentNum = index + 1;\r\n      state.resName = item.name;\r\n      state.currentRes = item;\r\n    }\r\n  });\r\n}\r\n\r\nasync function renderFavorite() {\r\n  const res = await getLikeList({\r\n    page_num: page_num.value,\r\n    page_size: route.query.page_size,\r\n    resource_type: route.query.resource_type,\r\n    favorite_type: store.state.selectedCategory.id,\r\n  });\r\n  const dataList = (res.likes || []).map((item) => {\r\n    return {\r\n      ...item.resource,\r\n      has_permissions: item.has_permissions,\r\n    };\r\n  });\r\n  state.dataList.push(...dataList);\r\n\r\n  if (page_num.value < route.query.page_num) {\r\n    page_num.value++;\r\n    renderFavorite();\r\n    return;\r\n  }\r\n\r\n  state.resTotalNums = res.total;\r\n  state.dataList.find((item, index) => {\r\n    if (item.id == route.query.currentId) {\r\n      state.resCurrentNum = index + 1;\r\n      state.resName = item.name;\r\n      state.currentRes = item;\r\n    }\r\n  });\r\n}\r\n\r\nfunction play() {\r\n  if (Hls.isSupported()) {\r\n    const instance = new Hls();\r\n    const video = document.querySelector(`#${'video' + state.currentRes.id}`);\r\n    instance.loadSource(parseUrlToPath(state.currentRes.video_url));\r\n    instance.attachMedia(video);\r\n    video.play();\r\n  } else {\r\n    console.warn('当前浏览器不支持Hls.js');\r\n  }\r\n}\r\n\r\ntry {\r\n  init();\r\n} catch (e) {}\r\n\r\nwatch(\r\n  () => store.state.selectedCategory,\r\n  (val) => {\r\n    init();\r\n  }\r\n);\r\n\r\n// function setPictureStyle(item) {\r\n//   const el = document.querySelector('picture' + item.id);\r\n//   debugger;\r\n// }\r\n\r\nwatch(\r\n  () => state.currentRes,\r\n  (val) => {\r\n    if (val.resource_type === 'VIDEO') {\r\n      nextTick(() => {\r\n        play();\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\nconst modules = [Navigation];\r\nconst onSwiper = (swiper) => {\r\n  swiper.slideTo(state.resCurrentNum - 1);\r\n  console.log(swiper);\r\n};\r\nconst onSlideChange = (swiper) => {\r\n  console.log('slide change');\r\n  getNextData(swiper.realIndex).then(() => {\r\n    state.resCurrentNum = swiper.realIndex + 1;\r\n    state.currentRes = state.dataList[swiper.realIndex];\r\n    state.resName = state.dataList[swiper.realIndex].name;\r\n  });\r\n};\r\n\r\nasync function getNextData(index) {\r\n  const isFromFavorite = [\r\n    favoriteTypeEnum.FAVORITE,\r\n    favoriteTypeEnum.MY_FAVORITE,\r\n  ].includes(store.state.selectedCategory.id);\r\n  return new Promise((resolve) => {\r\n    if (\r\n      index === state.dataList.length - 1 &&\r\n      state.dataList.length < state.resTotalNums\r\n    ) {\r\n      page_num.value++;\r\n      if (isFromFavorite) {\r\n        renderFavorite().then(() => resolve());\r\n      } else {\r\n        renderResources().then(() => resolve());\r\n      }\r\n    } else {\r\n      resolve();\r\n    }\r\n  });\r\n}\r\n\r\nfunction goToResourcePage() {\r\n  router.push({\r\n    path: '/resource',\r\n  });\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n$headerHeight: 45px;\r\n.res-detail-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  .header {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    position: relative;\r\n    background: #999;\r\n    height: $headerHeight;\r\n    color: #fff;\r\n    .title {\r\n      text-align: center;\r\n      .name {\r\n        font-weight: bold;\r\n      }\r\n    }\r\n    .close-btn {\r\n      position: absolute;\r\n      right: 10px;\r\n      top: 50%;\r\n      transform: translateY(-50%);\r\n      .close-icon {\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  }\r\n  .content {\r\n    height: calc(100% - $headerHeight);\r\n    background: #000;\r\n    .res-swiper {\r\n      height: 100%;\r\n      .res-item {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        width: 100%;\r\n        .res {\r\n          height: 100%;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import script from \"./ResourceDetail.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ResourceDetail.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ResourceDetail.vue?vue&type=style&index=0&id=40876be1&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-40876be1\"]])\n\nexport default __exports__"],"names":["route","useRoute","router","useRouter","store","useStore","state","reactive","dataList","resCurrentNum","resTotalNums","resName","currentRes","ref","page_num","init","isFromFavorite","favoriteTypeEnum","includes","selectedCategory","id","renderFavorite","renderResources","e","async","res","getResourceList","query","value","resources","push","total","find","item","index","currentId","name","getLikeList","page_size","resource_type","favorite_type","likes","map","resource","has_permissions","play","Hls","instance","video","document","querySelector","loadSource","parseUrlToPath","video_url","attachMedia","console","warn","watch","val","nextTick","modules","Navigation","onSwiper","swiper","slideTo","log","onSlideChange","getNextData","realIndex","then","Promise","resolve","length","goToResourcePage","path","__exports__"],"sourceRoot":""}