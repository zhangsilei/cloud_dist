"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[873],{9684:function(e,t,a){a.d(t,{DI:function(){return r},SN:function(){return u},fg:function(){return o},id:function(){return i},rT:function(){return n}});var l=a(7245);function n(e){return(0,l.Z)({url:"/resources",method:"get",params:e})}function r(e){return(0,l.Z)({url:`/resources/${e}`,method:"get"})}function u(e){return(0,l.Z)({url:"/resources",method:"post",data:e})}function i(e,t){return(0,l.Z)({url:`/resources/${e}`,method:"put",data:t})}function o(e){return(0,l.Z)({url:`/resources/${e}`,method:"delete"})}},7932:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});a(7658),a(541);var l=a(3396),n=a(4870),r=a(7139),u=a(4120),i=a(5941),o=a(7646),s=a(3008),c=a(5393),d=a(6973),m=a(9518),p=a(5210),f=a(6429),_=a(3273),g=a(6616),w=a(9807),h=a(4786),v=a(212),y=a(6302);const S={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},U=(0,l._)("path",{d:"M350.54 148.68l-26.62-42.06C318.31 100.08 310.62 96 302 96h-92c-8.62 0-16.31 4.08-21.92 10.62l-26.62 42.06C155.85 155.23 148.62 160 140 160H80a32 32 0 0 0-32 32v192a32 32 0 0 0 32 32h352a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32h-59c-8.65 0-16.85-4.77-22.46-11.32z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),k=(0,l._)("circle",{cx:"256",cy:"272",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),D=(0,l._)("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M124 158v-22h-24v22"},null,-1),Z=[U,k,D];var b=(0,l.aZ)({name:"CameraOutline",render:function(e,t){return(0,l.wg)(),(0,l.iD)("svg",S,Z)}}),W=(a(4277),a(2852)),C=a(3612),P=a(5364),x=(a(9063),a(8543)),H=a(7245);function q(e){const t=new FormData;return t.append("video",e.file),(0,H.Z)({url:"/videos",method:"post",headers:{"Content-type":"multipart/form-data",token:(0,x.LP)()},data:t})}a(1835);var Y=a(9684),j=a(65),z=a(6797),M=a.n(z);const O={class:"resource-manage-container"},T={class:"resource-wrap"},V={class:"content"},E={key:0},I={style:{"margin-bottom":"12px"}},K={style:{display:"flex"}},N=["src"],R={key:0};var $={__name:"ResourceManage",setup(e){const t=(0,j.oR)(),{message:a,dialog:S}=(0,u.M)(["message","dialog"]),U=0,k=1,D=(0,n.qj)({query:""}),Z=(0,n.iH)(null),x=(0,n.qj)({isShow:!1,isEdit:!1,title:"上传视频",type:null,formData:(0,n.iH)({category_id:null,resourceType:null,name:null,description:null,picture_url:null,video_url:null}),rules:{name:{required:!0,trigger:["blur","input"],message:"请输入名称"},video_url:{required:!0,trigger:["blur","change"],message:"请上传资源"}}}),H=(0,n.iH)([]),z=(0,n.iH)(!0),$=(0,n.iH)(null),F=(0,n.iH)([]),B=(0,n.iH)(null);function L({file:e}){B.value=e,e.status="uploading",e.percentage=0;const t=setInterval((()=>{"finished"!==B.value.status?B.value.percentage+=30*Math.random():clearInterval(t)}),1e3);q(e).then((({picture_url:e,video_url:t})=>{x.formData.picture_url=e,x.formData.video_url=t,B.value.percentage=100,setTimeout((()=>{B.value.status="finished"}),0)}))}const A="localhost"===location.hostname;function G(){Z.value?.validate((async e=>{e||(x.isEdit?await(0,Y.id)(x.formData.category_id,x.formData):await(0,Y.SN)(x.formData),x.isShow=!1,a.success("操作成功！"),ae())})).catch()}function J(e){x.type=e,x.isShow=!0,x.formData.resourceType=e,x.isEdit=!1}const Q=(0,n.iH)(null),X=(0,n.qj)({page_num:1,page_size:10,category_id:null});function ee(){ae()}function te(){}async function ae(){X.category_id=$.value;const e=await(0,Y.rT)(X);H.value=e.resources||[],Q.value=e.total%X.page_size?e.total/X.page_size:e.total/X.page_size+1,z.value=!1}function le(e,t){const a=[...t];while(a.length){const t=a.shift();if(t.id===e)return t;a.push(...t.items||[])}}function ne(e,t,a=[]){const l=le(t,e);return l?(a.unshift(l.name),l.parent_category_id?ne(e,l.parent_category_id,a):a):a}(0,l.YP)(t.state,(e=>{$.value=e.selectedCategory,F.value=ne(e.allCategories,e.selectedCategory),x.formData.category_id=e.selectedCategory,ae()})),(0,l.YP)((()=>x.isShow),(e=>{if(!e)for(const t in x.formData)Object.hasOwnProperty.call(x.formData,t)&&(x.formData[t]=null)}));const re=(0,n.qj)({isShow:!1,picture_url:"",name:"",created_time:"",updated_time:"",breadcrumbCategory:[]});function ue(e){x.formData.category_id=e.id,x.formData.name=e.name,x.formData.picture_url=e.picture_url,x.formData.video_url=e.video_url,x.formData.resourceType=e.resource_type,x.type=e.resource_type,x.isShow=!0,x.isEdit=!0}async function ie(e){const a=await(0,Y.DI)(e.id);re.picture_url="localhost"===location.hostname?"http://116.63.139.2"+a.picture_url:a.picture_url,re.name=a.name,re.breadcrumbCategory=ne(t.state.allCategories,t.state.selectedCategory),re.created_time=M()(1e3*a.created_time).format("YYYY-MM-DD HH:mm:ss"),re.updated_time=M()(1e3*a.updated_time).format("YYYY-MM-DD HH:mm:ss"),re.isShow=!0}function oe(e){S.warning({content:"确认删除资源？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await(0,Y.fg)(e.id),a.success("操作成功！"),ae()},onNegativeClick:()=>{}})}return(e,t)=>((0,l.wg)(),(0,l.iD)("div",O,[(0,l.Wm)((0,n.SU)(P.Z),{class:"categorie-tree-wrap"}),(0,l._)("div",T,[(0,l.Wm)((0,n.SU)(i.Z),{class:"filter"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(o.ZP),{"label-placement":"left",label:"关键字"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(s.Z),{value:D.query,"onUpdate:value":t[0]||(t[0]=e=>D.query=e)},null,8,["value"])])),_:1}),(0,l.Wm)((0,n.SU)(o.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(c.ZP),{type:"primary",onClick:ee},{default:(0,l.w5)((()=>[(0,l.Uk)(" 查询 ")])),_:1})])),_:1}),(0,l.Wm)((0,n.SU)(o.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(c.ZP),{onClick:te},{default:(0,l.w5)((()=>[(0,l.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1}),(0,l.Wm)((0,n.SU)(i.Z),{class:"action"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(c.ZP),{type:"primary",onClick:t[1]||(t[1]=e=>J(U))},{default:(0,l.w5)((()=>[(0,l.Uk)(" 上传视频 ")])),_:1}),(0,l.Wm)((0,n.SU)(c.ZP),{type:"primary",onClick:t[2]||(t[2]=e=>J(k))},{default:(0,l.w5)((()=>[(0,l.Uk)(" 上传图片 ")])),_:1})])),_:1}),(0,l._)("div",V,[H.value.length?((0,l.wg)(),(0,l.j4)((0,n.SU)(m.Z),{key:1,"x-gap":8,"y-gap":8,cols:8,style:{"margin-top":"10px"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(H.value,((e,t)=>((0,l.wg)(),(0,l.j4)((0,n.SU)(p.ZP),{key:t},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(W.Z),{id:e.id,"file-name":e.name,"like-num":e.like_num,authority:!0,poster:A?"http://116.63.139.2"+e.picture_url:e.picture_url,onOnEdit:t=>ue(e),onOnDetail:t=>ie(e),onOnDelete:t=>oe(e)},null,8,["id","file-name","like-num","poster","onOnEdit","onOnDetail","onOnDelete"])])),_:2},1024)))),128))])),_:1})):((0,l.wg)(),(0,l.j4)((0,n.SU)(d.Z),{key:0,description:"暂无数据",style:{"margin-top":"100px",flex:"1"}})),(0,l.Wm)((0,n.SU)(f.Z),{style:{"justify-content":"flex-end"},page:X.page_num,"onUpdate:page":t[3]||(t[3]=e=>X.page_num=e),"page-count":Q.value},null,8,["page","page-count"])])]),(0,l.Wm)((0,n.SU)(C.Z),{modelValue:x.isShow,"onUpdate:modelValue":t[6]||(t[6]=e=>x.isShow=e),title:x.title,onOnConfirm:G},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(_.Z),{ref_key:"resourceRef",ref:Z,model:x.formData,rules:x.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(o.ZP),{label:"所在分区"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(F.value,((e,t)=>((0,l.wg)(),(0,l.iD)("span",null,[(0,l.Uk)((0,r.zw)(e)+" ",1),t!==F.value.length-1?((0,l.wg)(),(0,l.iD)("span",E,"/")):(0,l.kq)("",!0)])))),256))])),_:1}),(0,l.Wm)((0,n.SU)(o.ZP),{label:"名称",path:"name"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(s.Z),{value:x.formData.name,"onUpdate:value":t[4]||(t[4]=e=>x.formData.name=e)},null,8,["value"])])),_:1}),x.type===U?((0,l.wg)(),(0,l.j4)((0,n.SU)(o.ZP),{key:0,label:"视频",path:"video_url"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(g.Z),{"directory-dnd":"",onChange:L},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(w.Z),null,{default:(0,l.w5)((()=>[(0,l._)("div",I,[(0,l.Wm)((0,n.SU)(h.g),{size:"48",depth:3},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(b))])),_:1})]),(0,l.Wm)((0,n.SU)(v.Z),{style:{"font-size":"14px"}},{default:(0,l.w5)((()=>[(0,l.Uk)(" 添加视频 ")])),_:1}),(0,l.Wm)((0,n.SU)(y.Z),{depth:"3",style:{margin:"8px 0 0 0"}},{default:(0,l.w5)((()=>[(0,l.Uk)(" （图片大小不超过100M） ")])),_:1})])),_:1})])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l.Wm)((0,n.SU)(o.ZP),{label:"描述",path:"description"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(s.Z),{value:x.formData.description,"onUpdate:value":t[5]||(t[5]=e=>x.formData.description=e)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,l.Wm)((0,n.SU)(C.Z),{modelValue:re.isShow,"onUpdate:modelValue":t[7]||(t[7]=e=>re.isShow=e),title:"详细信息",isShowFooter:!1},{default:(0,l.w5)((()=>[(0,l._)("div",K,[(0,l._)("div",null,[(0,l._)("img",{style:{width:"250px","margin-right":"15px"},src:re.picture_url},null,8,N)]),(0,l._)("div",null,[(0,l.Wm)((0,n.SU)(o.ZP),{"label-placement":"left",label:"名称"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(re.name),1)])),_:1}),(0,l.Wm)((0,n.SU)(o.ZP),{"label-placement":"left",label:"位置"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(re.breadcrumbCategory,((e,t)=>((0,l.wg)(),(0,l.iD)("span",null,[(0,l.Uk)((0,r.zw)(e)+" ",1),t!==F.value.length-1?((0,l.wg)(),(0,l.iD)("span",R,"/")):(0,l.kq)("",!0)])))),256))])),_:1}),(0,l.Wm)((0,n.SU)(o.ZP),{"label-placement":"left",label:"上传时间"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(re.created_time),1)])),_:1}),(0,l.Wm)((0,n.SU)(o.ZP),{"label-placement":"left",label:"最后修改时间"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(re.updated_time),1)])),_:1})])])])),_:1},8,["modelValue"])]))}},F=a(89);const B=(0,F.Z)($,[["__scopeId","data-v-132fb2de"]]);var L=B}}]);
//# sourceMappingURL=873.f052e5c2.js.map