"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[235],{4399:function(e,t,l){l.r(t),l.d(t,{default:function(){return B}});l(7658),l(541);var a=l(3396),n=l(4870),i=l(7139),r=l(4120),o=l(5941),u=l(7646),s=l(3008),c=l(5393),d=l(6973),m=l(9518),p=l(5210),f=l(6429),_=l(3273),g=l(6616),w=l(9807),v=l(4786),y=l(212),h=l(6302);const U={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},k=(0,a._)("path",{d:"M350.54 148.68l-26.62-42.06C318.31 100.08 310.62 96 302 96h-92c-8.62 0-16.31 4.08-21.92 10.62l-26.62 42.06C155.85 155.23 148.62 160 140 160H80a32 32 0 0 0-32 32v192a32 32 0 0 0 32 32h352a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32h-59c-8.65 0-16.85-4.77-22.46-11.32z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),S=(0,a._)("circle",{cx:"256",cy:"272",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),D=(0,a._)("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M124 158v-22h-24v22"},null,-1),Z=[k,S,D];var b=(0,a.aZ)({name:"CameraOutline",render:function(e,t){return(0,a.wg)(),(0,a.iD)("svg",U,Z)}}),W=(l(8244),l(2852)),C=l(3612),P=l(3298),x=(l(9063),l(627)),H=(l(1835),l(9684)),Y=l(65),z=l(6797),j=l.n(z);const M={class:"resource-manage-container"},O={class:"resource-wrap"},q={class:"content"},T={key:0},V={style:{"margin-bottom":"12px"}},E={style:{display:"flex"}},I=["src"],K={key:0};var R={__name:"ResourceManage",setup(e){const t=(0,Y.oR)(),{message:l,dialog:U}=(0,r.M)(["message","dialog"]),k=1,S=2,D=(0,n.iH)(null),Z=(0,n.qj)({isShow:!1,isEdit:!1,title:"上传视频",type:null,formData:(0,n.iH)({category_id:null,resourceType:null,name:null,description:null,picture_url:null,video_url:null}),rules:{name:{required:!0,trigger:["blur","input"],message:"请输入名称"},video_url:{required:!0,trigger:["blur","change"],message:"请上传资源"}}}),z=(0,n.iH)([]),R=(0,n.iH)(!0),N=(0,n.iH)(null),A=(0,n.iH)([]),B=(0,n.iH)(null);function F({file:e}){B.value=e,e.status="uploading",e.percentage=0;const t=setInterval((()=>{"finished"!==B.value.status?B.value.percentage+=30*Math.random():clearInterval(t)}),1e3);(0,x.A)(e).then((({picture_url:e,video_url:t})=>{Z.formData.picture_url=e,Z.formData.video_url=t,B.value.percentage=100,setTimeout((()=>{B.value.status="finished"}),0)}))}const G="localhost"===location.hostname;function J(){D.value?.validate((async e=>{e||(Z.isEdit?await(0,H.id)(Z.formData.category_id,Z.formData):await(0,H.SN)(Z.formData),Z.isShow=!1,l.success("操作成功！"),te())})).catch()}function L(e){Z.type=e,Z.isShow=!0,Z.formData.resourceType=e,Z.isEdit=!1}const Q=(0,n.iH)(null),X=(0,n.qj)({page_num:1,page_size:10,category_id:null,key:null});function $(){te()}function ee(){}async function te(){X.category_id=N.value;const e=await(0,H.rT)(X);z.value=e.resources||[],Q.value=e.total%X.page_size?e.total/X.page_size:e.total/X.page_size+1,R.value=!1}function le(e,t){const l=[...t];while(l.length){const t=l.shift();if(t.id===e)return t;l.push(...t.items||[])}}function ae(e,t,l=[]){const a=le(t,e);return a?(l.unshift(a.name),a.parent_category_id?ae(e,a.parent_category_id,l):l):l}(0,a.YP)(t.state,(e=>{N.value=e.selectedCategory,A.value=ae(e.allCategories,e.selectedCategory),Z.formData.category_id=e.selectedCategory,X.category_id=e.selectedCategory,te()})),(0,a.YP)((()=>Z.isShow),(e=>{if(!e)for(const t in Z.formData)Object.hasOwnProperty.call(Z.formData,t)&&(Z.formData[t]=null)}));const ne=(0,n.qj)({isShow:!1,picture_url:"",name:"",created_time:"",updated_time:"",breadcrumbCategory:[]});function ie(e){Z.formData.category_id=e.id,Z.formData.name=e.name,Z.formData.picture_url=e.picture_url,Z.formData.video_url=e.video_url,Z.formData.resourceType=e.resource_type,Z.type=e.resource_type,Z.isShow=!0,Z.isEdit=!0}async function re(e){const l=await(0,H.DI)(e.id);ne.picture_url="localhost"===location.hostname?"http://116.63.139.2"+l.picture_url:l.picture_url,ne.name=l.name,ne.breadcrumbCategory=ae(t.state.allCategories,t.state.selectedCategory),ne.created_time=j()(1e3*l.created_time).format("YYYY-MM-DD HH:mm:ss"),ne.updated_time=j()(1e3*l.updated_time).format("YYYY-MM-DD HH:mm:ss"),ne.isShow=!0}function oe(e){U.warning({content:"确认删除资源？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await(0,H.fg)(e.id),l.success("操作成功！"),te()},onNegativeClick:()=>{}})}return(e,t)=>((0,a.wg)(),(0,a.iD)("div",M,[(0,a.Wm)((0,n.SU)(P.Z),{class:"categorie-tree-wrap"}),(0,a._)("div",O,[(0,a.Wm)((0,n.SU)(o.Z),{class:"filter"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(u.ZP),{"label-placement":"left",label:"关键字"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.Z),{value:X.key,"onUpdate:value":t[0]||(t[0]=e=>X.key=e),clearable:""},null,8,["value"])])),_:1}),(0,a.Wm)((0,n.SU)(u.ZP),{"label-placement":"left"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(c.ZP),{type:"primary",onClick:$},{default:(0,a.w5)((()=>[(0,a.Uk)(" 查询 ")])),_:1})])),_:1}),(0,a.Wm)((0,n.SU)(u.ZP),{"label-placement":"left"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(c.ZP),{onClick:ee},{default:(0,a.w5)((()=>[(0,a.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1}),(0,a.Wm)((0,n.SU)(o.Z),{class:"action"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(c.ZP),{type:"primary",onClick:t[1]||(t[1]=e=>L(k))},{default:(0,a.w5)((()=>[(0,a.Uk)(" 上传视频 ")])),_:1}),(0,a.Wm)((0,n.SU)(c.ZP),{type:"primary",onClick:t[2]||(t[2]=e=>L(S))},{default:(0,a.w5)((()=>[(0,a.Uk)(" 上传图片 ")])),_:1})])),_:1}),(0,a._)("div",q,[z.value.length?((0,a.wg)(),(0,a.j4)((0,n.SU)(m.Z),{key:1,"x-gap":8,"y-gap":8,cols:8,style:{"margin-top":"10px"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(z.value,((e,t)=>((0,a.wg)(),(0,a.j4)((0,n.SU)(p.ZP),{key:t},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(W.Z),{id:e.id,"file-name":e.name,"like-num":e.like_num,authority:!0,poster:G?"http://116.63.139.2"+e.picture_url:e.picture_url,onOnEdit:t=>ie(e),onOnDetail:t=>re(e),onOnDelete:t=>oe(e)},null,8,["id","file-name","like-num","poster","onOnEdit","onOnDetail","onOnDelete"])])),_:2},1024)))),128))])),_:1})):((0,a.wg)(),(0,a.j4)((0,n.SU)(d.Z),{key:0,description:"暂无数据",style:{"margin-top":"100px",flex:"1"}})),(0,a.Wm)((0,n.SU)(f.Z),{style:{"justify-content":"flex-end"},page:X.page_num,"onUpdate:page":t[3]||(t[3]=e=>X.page_num=e),"page-count":Q.value},null,8,["page","page-count"])])]),(0,a.Wm)((0,n.SU)(C.Z),{modelValue:Z.isShow,"onUpdate:modelValue":t[6]||(t[6]=e=>Z.isShow=e),title:Z.title,onOnConfirm:J},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(_.Z),{ref_key:"resourceRef",ref:D,model:Z.formData,rules:Z.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(u.ZP),{label:"所在分区"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(A.value,((e,t)=>((0,a.wg)(),(0,a.iD)("span",null,[(0,a.Uk)((0,i.zw)(e)+" ",1),t!==A.value.length-1?((0,a.wg)(),(0,a.iD)("span",T,"/")):(0,a.kq)("",!0)])))),256))])),_:1}),(0,a.Wm)((0,n.SU)(u.ZP),{label:"名称",path:"name"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.Z),{value:Z.formData.name,"onUpdate:value":t[4]||(t[4]=e=>Z.formData.name=e)},null,8,["value"])])),_:1}),Z.type===k?((0,a.wg)(),(0,a.j4)((0,n.SU)(u.ZP),{key:0,label:"视频",path:"video_url"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(g.Z),{"directory-dnd":"",onChange:F},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(w.Z),null,{default:(0,a.w5)((()=>[(0,a._)("div",V,[(0,a.Wm)((0,n.SU)(v.g),{size:"48",depth:3},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(b))])),_:1})]),(0,a.Wm)((0,n.SU)(y.Z),{style:{"font-size":"14px"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" 添加视频 ")])),_:1}),(0,a.Wm)((0,n.SU)(h.Z),{depth:"3",style:{margin:"8px 0 0 0"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" （图片大小不超过100M） ")])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0),(0,a.Wm)((0,n.SU)(u.ZP),{label:"描述",path:"description"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(s.Z),{value:Z.formData.description,"onUpdate:value":t[5]||(t[5]=e=>Z.formData.description=e)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,a.Wm)((0,n.SU)(C.Z),{modelValue:ne.isShow,"onUpdate:modelValue":t[7]||(t[7]=e=>ne.isShow=e),title:"详细信息",isShowFooter:!1},{default:(0,a.w5)((()=>[(0,a._)("div",E,[(0,a._)("div",null,[(0,a._)("img",{style:{width:"250px","margin-right":"15px"},src:ne.picture_url},null,8,I)]),(0,a._)("div",null,[(0,a.Wm)((0,n.SU)(u.ZP),{"label-placement":"left",label:"名称"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,i.zw)(ne.name),1)])),_:1}),(0,a.Wm)((0,n.SU)(u.ZP),{"label-placement":"left",label:"位置"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(ne.breadcrumbCategory,((e,t)=>((0,a.wg)(),(0,a.iD)("span",null,[(0,a.Uk)((0,i.zw)(e)+" ",1),t!==A.value.length-1?((0,a.wg)(),(0,a.iD)("span",K,"/")):(0,a.kq)("",!0)])))),256))])),_:1}),(0,a.Wm)((0,n.SU)(u.ZP),{"label-placement":"left",label:"上传时间"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,i.zw)(ne.created_time),1)])),_:1}),(0,a.Wm)((0,n.SU)(u.ZP),{"label-placement":"left",label:"最后修改时间"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,i.zw)(ne.updated_time),1)])),_:1})])])])),_:1},8,["modelValue"])]))}},N=l(89);const A=(0,N.Z)(R,[["__scopeId","data-v-64e5d641"]]);var B=A}}]);
//# sourceMappingURL=235.7d602871.js.map