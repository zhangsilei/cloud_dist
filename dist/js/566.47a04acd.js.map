{"version":3,"file":"js/566.47a04acd.js","mappings":"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","sources":["webpack://cloud_dist/./src/views/m/ResourceDetail.vue","webpack://cloud_dist/./src/views/m/ResourceDetail.vue?e8da"],"sourcesContent":["<template>\r\n  <div class=\"resource-detail-container\">\r\n    <n-page-header :title=\"title\" @back=\"handleBack\">\r\n      <template #extra>\r\n        <n-space v-if=\"currentResource\">\r\n          <n-icon\r\n            v-if=\"currentResource.is_like\"\r\n            color=\"red\"\r\n            size=\"20\"\r\n            @click=\"unlike\"\r\n          >\r\n            <Heart />\r\n          </n-icon>\r\n          <n-icon v-else size=\"20\" @click=\"like\">\r\n            <HeartOutline />\r\n          </n-icon>\r\n        </n-space>\r\n      </template>\r\n    </n-page-header>\r\n\r\n    <swiper\r\n      v-if=\"currentResource\"\r\n      :direction=\"'vertical'\"\r\n      class=\"mySwiper\"\r\n      @swiper=\"onSwiper\"\r\n      @slideChange=\"onSourceChange\"\r\n    >\r\n      <swiper-slide v-for=\"item in dataList\">\r\n        <template v-if=\"item.resource_type === 'VIDEO'\">\r\n          <video\r\n            :id=\"item.name\"\r\n            muted\r\n            controls\r\n            controlsList=\"nodownload\"\r\n            style=\"width: 100%\"\r\n          ></video>\r\n        </template>\r\n        <template v-else>\r\n          <img\r\n            :src=\"parseUrlToPath(item.picture_url)\"\r\n            style=\"width: auto; height: 100%\"\r\n          />\r\n          <!-- <n-image :src=\"parseUrlToPath(item.picture_url)\" lazy /> -->\r\n        </template>\r\n      </swiper-slide>\r\n    </swiper>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  NTag,\r\n  NInput,\r\n  NAvatar,\r\n  NIcon,\r\n  NImage,\r\n  NTabs,\r\n  NTabPane,\r\n  NPageHeader,\r\n  NGrid,\r\n  NGi,\r\n  NStatistic,\r\n  NSpace,\r\n} from 'naive-ui';\r\nimport { computed, ref, nextTick, watch, onMounted } from 'vue';\r\nimport { Heart, HeartOutline } from '@vicons/ionicons5';\r\nimport { postLike, deleteLike } from '@/api/like';\r\nimport { useRouter, useRoute } from 'vue-router';\r\nimport { parse } from 'qs';\r\n// Import Swiper Vue.js components\r\nimport { Swiper, SwiperSlide } from 'swiper/vue';\r\n// Import Swiper styles\r\nimport 'swiper/css';\r\nimport { getResourceList } from '@/api/resource';\r\nimport { getLikeList } from '@/api/like';\r\nimport { parseUrlToPath } from '@/common/global';\r\nimport Hls from 'hls.js';\r\n\r\nconst router = useRouter();\r\nconst route = useRoute();\r\n\r\nconst queryObj = parse(route.query);\r\n\r\nconst totalNum = ref(0);\r\nconst currentNum = ref(0);\r\nconst currentResource = ref(null);\r\nconst dataList = ref([]);\r\nconst page_num = ref(1);\r\n\r\nconst title = computed(() => {\r\n  return currentNum.value + '/' + totalNum.value;\r\n});\r\n\r\nwatch(currentResource, (val) => {\r\n  if (val.resource_type === 'VIDEO') {\r\n    nextTick(() => {\r\n      play();\r\n    });\r\n  }\r\n});\r\n\r\ninit();\r\n\r\nasync function getData() {\r\n  if (queryObj.isFromFavorite) {\r\n    await getLikes();\r\n  } else {\r\n    await getResources();\r\n  }\r\n}\r\n\r\nasync function init() {\r\n  await getData();\r\n  if (page_num.value < queryObj.page_num) {\r\n    page_num.value++;\r\n    await init();\r\n    return;\r\n  }\r\n  setCurrentData();\r\n}\r\n\r\nfunction setCurrentData() {\r\n  let currentPageNum = 0;\r\n  dataList.value.find((item, index) => {\r\n    if (item.id == queryObj.id) {\r\n      currentResource.value = item;\r\n      currentPageNum = index + 1;\r\n    }\r\n  });\r\n  totalNum.value = queryObj.total;\r\n  currentNum.value =\r\n    (queryObj.page_num - 1) * queryObj.page_size + currentPageNum;\r\n}\r\n\r\nasync function getResources() {\r\n  const res = await getResourceList({\r\n    page_num: page_num.value,\r\n    page_size: queryObj.page_size,\r\n    resource_type: queryObj.resource_type,\r\n    category_id: queryObj.category_id,\r\n    order_by: queryObj.order_by,\r\n    key: queryObj.key,\r\n  });\r\n  dataList.value.push(...(res.resources || []));\r\n}\r\n\r\nasync function getLikes() {\r\n  const res = await getLikeList({\r\n    page_num: page_num.value,\r\n    page_size: queryObj.page_size,\r\n    resource_type: queryObj.resource_type,\r\n    favorite_type: queryObj.favorite_type,\r\n  });\r\n  dataList.value.push(...(res.likes || []).map((item) => item.resource));\r\n}\r\n\r\nfunction play() {\r\n  if (Hls.isSupported()) {\r\n    const instance = new Hls();\r\n    const video = document.querySelector(`#${currentResource.value.name}`);\r\n    instance.loadSource(parseUrlToPath(currentResource.value.video_url));\r\n    instance.attachMedia(video);\r\n    video.play();\r\n  } else {\r\n    console.warn('当前浏览器不支持Hls.js');\r\n  }\r\n}\r\n\r\nfunction onSwiper(swiper) {\r\n  swiper.slideTo(currentNum.value - 1);\r\n}\r\n\r\nfunction onSourceChange(swiper) {\r\n  const isPrev = currentNum.value > swiper.activeIndex + 1;\r\n  currentNum.value = swiper.activeIndex + 1;\r\n  currentResource.value = dataList.value.find((item, index) => {\r\n    if (item.id == currentResource.value.id) {\r\n      return dataList.value[index + (isPrev ? -1 : 1)];\r\n    }\r\n  });\r\n  if (swiper.activeIndex + 1 === dataList.value.length) {\r\n    page_num.value++;\r\n    getData();\r\n  }\r\n}\r\n\r\nasync function like() {\r\n  if (!currentResource.value.is_like) {\r\n    try {\r\n      await postLike({\r\n        resource_id: currentResource.value.id,\r\n      });\r\n      currentResource.value.is_like = true;\r\n    } catch (e) {}\r\n  }\r\n}\r\n\r\nasync function unlike() {\r\n  if (currentResource.value.is_like) {\r\n    try {\r\n      await deleteLike({\r\n        resource_id: currentResource.value.id,\r\n      });\r\n      currentResource.value.is_like = false;\r\n    } catch (e) {}\r\n  }\r\n}\r\n\r\nfunction handleBack() {\r\n  router.go(-1);\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.resource-detail-container {\r\n  background: #fff;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 0 10px 10px;\r\n  background: #fff;\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  flex-direction: column;\r\n  // .large-img {\r\n  //   width: 98%;\r\n  //   margin: 0 auto;\r\n  // }\r\n  // .slide-img {\r\n  //   height: 100%;\r\n  // }\r\n  .swiper {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n\r\n  .swiper-slide {\r\n    text-align: center;\r\n    font-size: 18px;\r\n    background: #000;\r\n\r\n    /* Center slide text vertically */\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .swiper-slide img {\r\n    display: block;\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./ResourceDetail.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ResourceDetail.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ResourceDetail.vue?vue&type=style&index=0&id=71b04596&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-71b04596\"]])\n\nexport default __exports__"],"names":["router","useRouter","route","useRoute","queryObj","parse","query","totalNum","ref","currentNum","currentResource","dataList","page_num","title","computed","value","async","getData","isFromFavorite","getLikes","getResources","init","setCurrentData","currentPageNum","find","item","index","id","total","page_size","res","getResourceList","resource_type","category_id","order_by","key","push","resources","getLikeList","favorite_type","likes","map","resource","play","Hls","instance","video","document","querySelector","name","loadSource","parseUrlToPath","video_url","attachMedia","console","warn","onSwiper","swiper","slideTo","onSourceChange","isPrev","activeIndex","length","like","is_like","postLike","resource_id","e","unlike","deleteLike","handleBack","go","watch","val","nextTick","__exports__"],"sourceRoot":""}