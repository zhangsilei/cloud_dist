{"version":3,"file":"js/65.c4134775.js","mappings":"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","sources":["webpack://cloud_dist/./node_modules/@vicons/ionicons5/es/CameraOutline.js","webpack://cloud_dist/./src/views/pc/ResourceManage.vue","webpack://cloud_dist/./src/views/pc/ResourceManage.vue?4cef"],"sourcesContent":["import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M350.54 148.68l-26.62-42.06C318.31 100.08 310.62 96 302 96h-92c-8.62 0-16.31 4.08-21.92 10.62l-26.62 42.06C155.85 155.23 148.62 160 140 160H80a32 32 0 0 0-32 32v192a32 32 0 0 0 32 32h352a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32h-59c-8.65 0-16.85-4.77-22.46-11.32z',\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'circle',\n  {\n    cx: '256',\n    cy: '272',\n    r: '80',\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-miterlimit': '10',\n    'stroke-width': '32'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32',\n    d: 'M124 158v-22h-24v22'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_5 = [_hoisted_2, _hoisted_3, _hoisted_4]\nexport default defineComponent({\n  name: 'CameraOutline',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_5)\n  }\n})\n","<template>\r\n  <div class=\"resource-manage-container\">\r\n    <categorie-tree class=\"categorie-tree-wrap\" />\r\n\r\n    <div class=\"resource-wrap\">\r\n      <n-space class=\"filter\">\r\n        <n-form-item label-placement=\"left\" label=\"关键字\">\r\n          <n-input v-model:value=\"query.key\" clearable></n-input>\r\n        </n-form-item>\r\n        <n-form-item label-placement=\"left\">\r\n          <n-button type=\"primary\" @click=\"queryList\"> 查询 </n-button>\r\n        </n-form-item>\r\n        <n-form-item label-placement=\"left\">\r\n          <n-button @click=\"reset\"> 重置 </n-button>\r\n        </n-form-item>\r\n      </n-space>\r\n\r\n      <n-space v-if=\"isShowResource\" class=\"action\">\r\n        <n-button\r\n          v-if=\"dirType === VIDEOS_DIR_KEY\"\r\n          type=\"primary\"\r\n          @click=\"onClickUpload(TYPE_VIDEO)\"\r\n        >\r\n          上传视频\r\n        </n-button>\r\n        <n-button\r\n          v-if=\"dirType === PHOTOS_DIR_KEY\"\r\n          type=\"primary\"\r\n          @click=\"onClickUpload(TYPE_IMAGE)\"\r\n        >\r\n          上传图片\r\n        </n-button>\r\n      </n-space>\r\n\r\n      <div class=\"content\">\r\n        <n-empty\r\n          v-if=\"!dataList.length\"\r\n          description=\"暂无数据\"\r\n          style=\"margin-top: 100px; flex: 1\"\r\n        ></n-empty>\r\n        <n-grid v-else :x-gap=\"8\" :y-gap=\"8\" :cols=\"8\" style=\"margin-top: 10px\">\r\n          <n-grid-item v-for=\"(item, index) in dataList\" :key=\"index\">\r\n            <video-card\r\n              :id=\"item.id\"\r\n              :file-name=\"item.name\"\r\n              :like-num=\"item.like_num\"\r\n              :authority=\"true\"\r\n              :poster=\"\r\n                isLocal\r\n                  ? 'http://116.63.139.2' + item.picture_url\r\n                  : item.picture_url\r\n              \"\r\n              @on-edit=\"editRes(item)\"\r\n              @on-detail=\"detailResource(item)\"\r\n              @on-delete=\"deleteRes(item)\"\r\n            ></video-card>\r\n          </n-grid-item>\r\n        </n-grid>\r\n        <n-pagination\r\n          style=\"justify-content: flex-end\"\r\n          v-model:page=\"query.page_num\"\r\n          :page-count=\"pageCount\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <popup-window\r\n      v-model=\"resource.isShow\"\r\n      :title=\"resource.title\"\r\n      @on-confirm=\"onResourceConfirm\"\r\n    >\r\n      <n-form\r\n        ref=\"resourceRef\"\r\n        :model=\"resource.formData\"\r\n        :rules=\"resource.rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"所在分区\">\r\n          <span v-for=\"(item, index) in breadcrumbCategory\">\r\n            {{ item }}\r\n            <span v-if=\"index !== breadcrumbCategory.length - 1\">/</span>\r\n          </span>\r\n        </n-form-item>\r\n        <n-form-item label=\"名称\" path=\"name\">\r\n          <n-input v-model:value=\"resource.formData.name\" />\r\n        </n-form-item>\r\n        <n-form-item\r\n          v-if=\"resource.type === TYPE_VIDEO\"\r\n          label=\"视频\"\r\n          path=\"video_url\"\r\n        >\r\n          <n-upload directory-dnd @change=\"onUpload\">\r\n            <n-upload-dragger>\r\n              <div style=\"margin-bottom: 12px\">\r\n                <n-icon size=\"48\" :depth=\"3\">\r\n                  <CameraOutline />\r\n                </n-icon>\r\n              </div>\r\n              <n-text style=\"font-size: 14px\"> 添加视频 </n-text>\r\n              <n-p depth=\"3\" style=\"margin: 8px 0 0 0\">\r\n                （图片大小不超过100M）\r\n              </n-p>\r\n            </n-upload-dragger>\r\n          </n-upload>\r\n        </n-form-item>\r\n        <n-form-item\r\n          v-if=\"dirType === PHOTOS_DIR_KEY\"\r\n          label=\"图片\"\r\n          path=\"picture_url\"\r\n        >\r\n          <n-upload directory-dnd @change=\"onUpload\">\r\n            <n-upload-dragger>\r\n              <div style=\"margin-bottom: 12px\">\r\n                <n-icon size=\"48\" :depth=\"3\">\r\n                  <add />\r\n                </n-icon>\r\n              </div>\r\n              <n-text style=\"font-size: 16px\"> 上传图片 </n-text>\r\n              <n-p depth=\"3\" style=\"margin: 8px 0 0 0\">\r\n                (图片大小不超过1M）\r\n              </n-p>\r\n            </n-upload-dragger>\r\n          </n-upload>\r\n        </n-form-item>\r\n        <n-form-item label=\"描述\" path=\"description\">\r\n          <n-input v-model:value=\"resource.formData.description\" />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window>\r\n\r\n    <popup-window\r\n      v-model=\"detail.isShow\"\r\n      title=\"详细信息\"\r\n      :isShowFooter=\"false\"\r\n    >\r\n      <div style=\"display: flex\">\r\n        <div>\r\n          <img\r\n            style=\"width: 250px; margin-right: 15px\"\r\n            :src=\"detail.picture_url\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <n-form-item label-placement=\"left\" label=\"名称\">\r\n            <div>{{ detail.name }}</div>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"位置\">\r\n            <span v-for=\"(item, index) in breadcrumbCategory\">\r\n              {{ item }}\r\n              <span v-if=\"index !== breadcrumbCategory.length - 1\">/</span>\r\n            </span>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"上传时间\">\r\n            <div>{{ detail.created_time }}</div>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"最后修改时间\">\r\n            <div>{{ detail.updated_time }}</div>\r\n          </n-form-item>\r\n        </div>\r\n      </div>\r\n    </popup-window>\r\n\r\n    <!-- <n-spin :show=\"loading\">\r\n      <n-space v-if=\"dataList.length\" vertical size=\"large\">\r\n        <div class=\"filter\">\r\n          <n-input round placeholder=\"关键字\">\r\n            <template #prefix>\r\n              <n-icon :component=\"IosSearch\" />\r\n            </template>\r\n          </n-input>\r\n          <n-button\r\n            type=\"primary\"\r\n            attr-type=\"button\"\r\n            style=\"margin: 0 10px\"\r\n            @click=\"queryResource\"\r\n          >\r\n            查询\r\n          </n-button>\r\n          <n-button attr-type=\"button\" @click=\"reset\"> 重置 </n-button>\r\n        </div>\r\n\r\n        <div class=\"action\">\r\n          <n-button\r\n            type=\"primary\"\r\n            attr-type=\"button\"\r\n            @click=\"isShowUpload = true\"\r\n          >\r\n            上传视频\r\n          </n-button>\r\n        </div>\r\n\r\n        <div class=\"content\">\r\n          <n-grid :x-gap=\"8\" :y-gap=\"8\" :cols=\"8\">\r\n            <n-grid-item v-for=\"(item, index) in state.dataList\" :key=\"index\">\r\n              <video-card\r\n                :file-name=\"item.fileName\"\r\n                :like-num=\"item.likeNum\"\r\n                :authority=\"item.authority\"\r\n              ></video-card>\r\n            </n-grid-item>\r\n          </n-grid>\r\n        </div>\r\n      </n-space>\r\n      <n-empty v-else class=\"empty-data\" description=\"暂无分区数据\">\r\n        <template #extra>\r\n          <n-button size=\"small\" @click=\"addCategorie\">新建分区</n-button>\r\n        </template>\r\n      </n-empty>\r\n    </n-spin> -->\r\n\r\n    <!-- <popup-window\r\n      v-model=\"isShowCategorieAlert\"\r\n      title=\"创建分区\"\r\n      @on-confirm=\"addCategorie\"\r\n    >\r\n      <n-form\r\n        ref=\"categorieFormRef\"\r\n        :model=\"categorieFormData\"\r\n        :rules=\"rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"分区名称\" path=\"name\">\r\n          <n-input\r\n            v-model:value=\"categorieFormData.name\"\r\n            placeholder=\"请输入\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"分区描述\" path=\"description\">\r\n          <n-input\r\n            v-model:value=\"categorieFormData.description\"\r\n            placeholder=\"请输入\"\r\n          />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window> -->\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  createDiscreteApi,\r\n  NBreadcrumb,\r\n  NBreadcrumbItem,\r\n  NIcon,\r\n  NInput,\r\n  NTag,\r\n  NSpace,\r\n  NGrid,\r\n  NGridItem,\r\n  NButton,\r\n  NForm,\r\n  NFormItem,\r\n  NSpin,\r\n  NEmpty,\r\n  NUpload,\r\n  NUploadDragger,\r\n  NText,\r\n  NP,\r\n  NPagination,\r\n  NImage,\r\n  useDialog,\r\n} from 'naive-ui';\r\nimport { ref, reactive, onMounted, watch } from 'vue';\r\nimport { CameraOutline, Add } from '@vicons/ionicons5';\r\nimport { Photo } from '@vicons/tabler';\r\nimport DirCard from '@/components/pc/DirCard';\r\nimport VideoCard from '@/components/pc/VideoCard';\r\nimport PopupWindow from '@/components/pc/PopupWindow';\r\nimport CategorieTree from '@/components/pc/CategorieTree';\r\nimport { getCategorieList } from '@/api/categories';\r\nimport { postVideo, postPicture } from '@/api/file';\r\nimport {\r\n  onlyAllowNumber,\r\n  RESOURCE_TYPE_VIDEO,\r\n  RESOURCE_TYPE_PICTURE,\r\n  parseUrlToPath,\r\n} from '@/common/global';\r\nimport {\r\n  getResourceList,\r\n  createResource,\r\n  getResourceDetail,\r\n  deleteResource,\r\n  updateResource,\r\n} from '@/api/resource';\r\nimport { useStore } from 'vuex';\r\nimport moment from 'moment';\r\n\r\nconst store = useStore();\r\nconst { message, dialog } = createDiscreteApi(['message', 'dialog']);\r\n\r\nconst TYPE_VIDEO = 1;\r\nconst TYPE_IMAGE = 2;\r\nconst VIDEOS_DIR_KEY = 'Videos';\r\nconst PHOTOS_DIR_KEY = 'Photos';\r\n\r\nconst resourceRef = ref(null);\r\nconst resource = reactive({\r\n  isShow: false,\r\n  isEdit: false,\r\n  title: '上传视频',\r\n  type: null,\r\n  formData: ref({\r\n    category_id: null,\r\n    resource_type: null,\r\n    name: null,\r\n    description: null,\r\n    picture_url: null,\r\n    video_url: null,\r\n  }),\r\n  rules: {\r\n    name: {\r\n      required: true,\r\n      trigger: ['blur', 'input'],\r\n      message: '请输入名称',\r\n    },\r\n    video_url: {\r\n      required: true,\r\n      trigger: ['blur', 'change'],\r\n      message: '请上传资源',\r\n    },\r\n  },\r\n});\r\nconst dataList = ref([]);\r\nconst loading = ref(true);\r\nconst selectedCategory = ref(null);\r\nconst breadcrumbCategory = ref([]);\r\nconst uplodFile = ref(null);\r\n\r\nfunction onUpload({ file }) {\r\n  uplodFile.value = file;\r\n  file.status = 'uploading';\r\n  file.percentage = 0;\r\n  const timer = setInterval(() => {\r\n    if (uplodFile.value.status === 'finished') {\r\n      clearInterval(timer);\r\n      return;\r\n    }\r\n    uplodFile.value.percentage += Math.random() * 30;\r\n  }, 1000);\r\n  if (dirType.value === VIDEOS_DIR_KEY) {\r\n    postVideo(file).then(({ picture_url, video_url }) => {\r\n      resource.formData.picture_url = picture_url;\r\n      resource.formData.video_url = video_url;\r\n      uplodFile.value.percentage = 100;\r\n      setTimeout(() => {\r\n        uplodFile.value.status = 'finished';\r\n      }, 0);\r\n    });\r\n  } else if (dirType.value === PHOTOS_DIR_KEY) {\r\n    postPicture(file).then(({ url }) => {\r\n      resource.formData.picture_url = url;\r\n      resource.formData.video_url = '';\r\n      uplodFile.value.percentage = 100;\r\n      setTimeout(() => {\r\n        uplodFile.value.status = 'finished';\r\n      }, 0);\r\n    });\r\n  }\r\n}\r\n\r\nconst isLocal = location.hostname === 'localhost';\r\n\r\nfunction onResourceConfirm() {\r\n  resourceRef.value\r\n    ?.validate(async (errors) => {\r\n      if (!errors) {\r\n        if (!resource.isEdit) {\r\n          await createResource(resource.formData);\r\n        } else {\r\n          await updateResource(\r\n            resource.formData.category_id,\r\n            resource.formData\r\n          );\r\n        }\r\n        resource.isShow = false;\r\n        message.success('操作成功！');\r\n        renderResources();\r\n      }\r\n    })\r\n    .catch();\r\n}\r\n\r\nfunction onClickUpload(type) {\r\n  resource.type = type;\r\n  resource.isShow = true;\r\n  resource.formData.resource_type = type;\r\n  resource.isEdit = false;\r\n}\r\nconst SORT_TYPE_DEFAULT = '';\r\nconst SORT_TYPE_POPULAR = 'like_num';\r\nconst pageCount = ref(null);\r\nconst query = reactive({\r\n  page_num: 1,\r\n  page_size: 10,\r\n  category_id: null,\r\n  key: null,\r\n  order_by: SORT_TYPE_DEFAULT,\r\n  resource_type: null,\r\n  // order_type: '',\r\n});\r\n\r\nfunction queryList() {\r\n  renderResources();\r\n}\r\n\r\nfunction reset() {}\r\n\r\nasync function renderResources(type) {\r\n  query.category_id = selectedCategory.value.id;\r\n  if (type === 'Videos') {\r\n    query.resource_type = 1;\r\n  } else if (type === 'Photos') {\r\n    query.resource_type = 2;\r\n  }\r\n  const res = await getResourceList(query);\r\n  dataList.value = res.resources || [];\r\n  pageCount.value =\r\n    res.total % query.page_size\r\n      ? res.total / query.page_size\r\n      : res.total / query.page_size + 1;\r\n  loading.value = false;\r\n}\r\n\r\nfunction filterTableMater(id, arr) {\r\n  const queue = [...arr];\r\n  while (queue.length) {\r\n    const o = queue.shift();\r\n    if (o.id === id) return o;\r\n    queue.push(...(o.items || []));\r\n  }\r\n}\r\n\r\nfunction getBreadcrumbCategory(arr, id, result = []) {\r\n  const re = filterTableMater(id, arr);\r\n  if (!re) return result;\r\n  result.unshift(re.name);\r\n  if (re.parent_category_id) {\r\n    return getBreadcrumbCategory(arr, re.parent_category_id, result);\r\n  }\r\n  return result;\r\n}\r\n\r\nconst dirType = ref(null);\r\n\r\nwatch(store.state, (val) => {\r\n  let id = val.selectedCategory.dirType\r\n    ? val.selectedCategory.category_id\r\n    : val.selectedCategory.id;\r\n  selectedCategory.value = id;\r\n  breadcrumbCategory.value = getBreadcrumbCategory(val.allCategories, id);\r\n  resource.formData.category_id = id;\r\n  query.category_id = id;\r\n  isShowResource.value = val.selectedCategory.dirType;\r\n  dirType.value = val.selectedCategory.dirType;\r\n  if (val.selectedCategory.dirType) {\r\n    if (val.selectedCategory.dirType === VIDEOS_DIR_KEY) {\r\n      renderResources('Videos');\r\n    } else if (val.selectedCategory.dirType === PHOTOS_DIR_KEY) {\r\n      renderResources('Photos');\r\n    }\r\n  } else {\r\n    dataList.value = [];\r\n  }\r\n});\r\n\r\nwatch(\r\n  () => resource.isShow,\r\n  (val) => {\r\n    if (!val) {\r\n      for (const key in resource.formData) {\r\n        if (Object.hasOwnProperty.call(resource.formData, key)) {\r\n          resource.formData[key] = null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n);\r\n\r\nconst detail = reactive({\r\n  isShow: false,\r\n  picture_url: '',\r\n  name: '',\r\n  created_time: '',\r\n  updated_time: '',\r\n  breadcrumbCategory: [],\r\n});\r\n\r\nfunction editRes(item) {\r\n  resource.formData.category_id = item.id;\r\n  resource.formData.name = item.name;\r\n  resource.formData.picture_url = item.picture_url;\r\n  resource.formData.video_url = item.video_url;\r\n  resource.formData.resource_type = item.resource_type;\r\n  resource.type = item.resource_type;\r\n  resource.isShow = true;\r\n  resource.isEdit = true;\r\n}\r\nasync function detailResource(item) {\r\n  const res = await getResourceDetail(item.id);\r\n  detail.picture_url = parseUrlToPath(res.picture_url);\r\n  detail.name = res.name;\r\n  detail.breadcrumbCategory = getBreadcrumbCategory(\r\n    store.state.allCategories,\r\n    store.state.selectedCategory\r\n  );\r\n  detail.created_time = moment(res.created_time * 1000).format(\r\n    'YYYY-MM-DD HH:mm:ss'\r\n  );\r\n  detail.updated_time = moment(res.updated_time * 1000).format(\r\n    'YYYY-MM-DD HH:mm:ss'\r\n  );\r\n  detail.isShow = true;\r\n}\r\nfunction deleteRes(item) {\r\n  dialog.warning({\r\n    content: '确认删除资源？',\r\n    positiveText: '确定',\r\n    negativeText: '取消',\r\n    onPositiveClick: async () => {\r\n      await deleteResource(item.id);\r\n      message.success('操作成功！');\r\n      renderResources();\r\n    },\r\n    onNegativeClick: () => {},\r\n  });\r\n}\r\n\r\nconst isShowResource = ref(false);\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.resource-manage-container {\r\n  display: flex;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 10px;\r\n  background: #fff;\r\n  box-sizing: border-box;\r\n  .categorie-tree-wrap {\r\n    min-width: 200px;\r\n    border-right: 1px solid #eee;\r\n  }\r\n  .resource-wrap {\r\n    padding-left: 20px;\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n\r\n  .empty-data {\r\n    margin-top: 50%;\r\n    transform: translateY(-50%);\r\n  }\r\n  .filter {\r\n    // display: flex;\r\n    // justify-content: flex-start;\r\n    // align-items: center;\r\n  }\r\n\r\n  .action {\r\n  }\r\n  .content {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./ResourceManage.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ResourceManage.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ResourceManage.vue?vue&type=style&index=0&id=d236b3e8&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-d236b3e8\"]])\n\nexport default __exports__"],"names":["_hoisted_1","xmlns","viewBox","_hoisted_2","_createElementVNode","d","fill","stroke","_hoisted_3","cx","cy","r","_hoisted_4","_hoisted_5","defineComponent","name","render","_ctx","_cache","_openBlock","_createElementBlock","store","useStore","message","dialog","createDiscreteApi","TYPE_VIDEO","TYPE_IMAGE","VIDEOS_DIR_KEY","PHOTOS_DIR_KEY","resourceRef","ref","resource","reactive","isShow","isEdit","title","type","formData","category_id","resource_type","description","picture_url","video_url","rules","required","trigger","dataList","loading","selectedCategory","breadcrumbCategory","uplodFile","onUpload","file","value","status","percentage","timer","setInterval","Math","random","clearInterval","dirType","postVideo","then","setTimeout","postPicture","url","isLocal","location","hostname","onResourceConfirm","validate","async","errors","updateResource","createResource","success","renderResources","catch","onClickUpload","SORT_TYPE_DEFAULT","pageCount","query","page_num","page_size","key","order_by","queryList","reset","id","res","getResourceList","resources","total","filterTableMater","arr","queue","length","o","shift","push","items","getBreadcrumbCategory","result","re","unshift","parent_category_id","watch","state","val","allCategories","isShowResource","Object","hasOwnProperty","call","detail","created_time","updated_time","editRes","item","detailResource","getResourceDetail","parseUrlToPath","moment","format","deleteRes","warning","content","positiveText","negativeText","onPositiveClick","deleteResource","onNegativeClick","__exports__"],"sourceRoot":""}