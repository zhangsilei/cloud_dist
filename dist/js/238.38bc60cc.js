"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[238],{91238:function(e,a,t){t.r(a),t.d(a,{default:function(){return W}});var l=t(73396),i=t(44870),o=t(24120),n=t(55393),u=t(5941),c=t(92097),d=t(24165),r=t(33008),s=t(55452),v=t(26429),m=t(83273),_=t(43612),p=t(59063),f=t(34531),g=t(36797),y=t.n(g),b=t(18134),h=t.n(b);const U={class:"activation-code-manage-container"},w={style:{display:"flex","flex-direction":"column"}};var S={__name:"ActivationManage",setup(e){const a=(0,i.iH)(0);(0,l.bv)((()=>{const e=e=>document.querySelector(e);a.value=e(".activation-code-manage-container").offsetHeight-58-49-38-65}));const{message:t}=(0,o.M)(["message"]),g=!0,b=!1,S=[{label:"已使用",value:g},{label:"未使用",value:b}],k=[{label:"1个月",value:2592e3},{label:"2个月",value:5184e3},{label:"3个月",value:7776e3},{label:"6个月",value:15552e3},{label:"1年",value:31536e3},{label:"2年",value:63072e3},{label:"3年",value:94608e3},{label:"4年",value:126144e3}],Z=[{title:"编号",key:"activation_code.id",width:160},{title:"激活码",key:"activation_code.code",width:130,render(e){return(0,l.h)(n.ZP,{"data-clipboard-text":e.activation_code.code,id:e.activation_code.code,onClick(){H(e.activation_code.code),t.success("复制成功！")}},e.activation_code.code)}},{title:"激活分区",key:"category.name",width:160,ellipsis:{tooltip:!0}},{title:"有效期",key:"activation_code.valid_duration",render(e){return(0,l.h)("span",null,e.activation_code.valid_duration/86400+"天")}},{title:"状态",key:"status",render(e){return(0,l.h)("span",{style:{color:e.activation_code.user_id?"red":"green"}},e.activation_code.user_id?"已使用":"未使用")}},{title:"创建时间",key:"activation_code.created_time",width:160,render(e){return(0,l.h)("span",null,y()(1e3*e.activation_code.created_time).format("YYYY-MM-DD HH:mm:ss")||"--")}},{title:"用户ID",key:"activation_code.user_id",render(e){return(0,l.h)("span",null,e.activation_code.user_id||"--")}},{title:"使用时间",key:"activation_code.use_time",render(e){return(0,l.h)("span",null,e.activation_code.use_time?y()(1e3*e.activation_code.use_time).format("YYYY-MM-DD HH:mm:ss"):"--")}}];let W=null,D=(0,i.iH)(!0),P=(0,i.iH)(null);Y();const H=e=>{x(e),W.on("success",(e=>{console.log("copy succ"),e.clearSelection()})),W.on("error",(e=>{console.log("copy fail")}))},x=e=>{W&&W.destroy(),W=null,W=new(h())(`#${e}`)};async function Y(){const e=await(0,p.$R)();P.value=e.items||[],D.value=!1}const C=()=>{O.value.page_num=1,R()},q=()=>{O.value.category_id=null,O.value.activated=null,O.value.key=null},M=(0,i.iH)(null),z=(0,i.qj)({isShow:!1,title:"创建激活码",formData:(0,i.iH)({category_id:null,valid_duration:null,activation_code_count:null}),rules:{category_id:{required:!0,trigger:["blur","change"],message:"请选择分区",type:"number"},valid_duration:{required:!0,trigger:["blur","change"],message:"请选择有效期",type:"number"},activation_code_count:{required:!0,trigger:["blur","input"],message:"请输入数量"}}});function I(){M.value?.validate((async e=>{e||(await(0,f.bX)({...z.formData,activation_code_count:parseInt(z.formData.activation_code_count)}),z.isShow=!1,t.success("操作成功！"),R())})).catch()}(0,l.YP)((()=>z.isShow),(e=>{if(!e)for(const a in z.formData)Object.hasOwnProperty.call(z.formData,a)&&(z.formData[a]=null)}));const O=(0,i.iH)({page_num:1,page_size:10,category_id:null,activated:null,key:null}),V=(0,i.iH)(0),j=(0,i.iH)([]);async function R(){const e=await(0,f.uN)(O.value);j.value=e.activation_codes||[],V.value=e.total}function $(e){O.value.page_num=e,R()}return R(),(e,t)=>((0,l.wg)(),(0,l.iD)("div",U,[(0,l.Wm)((0,i.SU)(u.Z),{class:"filter"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(c.ZP),{"label-placement":"left",label:"激活分区"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(d.Z),{value:O.value.category_id,"onUpdate:value":t[0]||(t[0]=e=>O.value.category_id=e),"label-field":"name","value-field":"id",options:(0,i.SU)(P),style:{width:"150px"},clearable:""},null,8,["value","options"])])),_:1}),(0,l.Wm)((0,i.SU)(c.ZP),{"label-placement":"left",label:"状态"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(d.Z),{value:O.value.activated,"onUpdate:value":t[1]||(t[1]=e=>O.value.activated=e),options:S,style:{width:"150px"},clearable:""},null,8,["value"])])),_:1}),(0,l.Wm)((0,i.SU)(c.ZP),{"label-placement":"left",label:"关键字"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(r.Z),{value:O.value.key,"onUpdate:value":t[2]||(t[2]=e=>O.value.key=e),placeholder:"激活码",clearable:""},null,8,["value"])])),_:1}),(0,l.Wm)((0,i.SU)(c.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(n.ZP),{type:"primary",onClick:C},{default:(0,l.w5)((()=>[(0,l.Uk)(" 查询 ")])),_:1})])),_:1}),(0,l.Wm)((0,i.SU)(c.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(n.ZP),{onClick:q},{default:(0,l.w5)((()=>[(0,l.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1}),(0,l.Wm)((0,i.SU)(u.Z),{class:"action"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(n.ZP),{type:"primary",onClick:t[3]||(t[3]=e=>z.isShow=!0)},{default:(0,l.w5)((()=>[(0,l.Uk)(" 新增激活码 ")])),_:1})])),_:1}),(0,l._)("div",w,[(0,l.Wm)((0,i.SU)(s.Z),{"max-height":a.value,loading:(0,i.SU)(D),columns:Z,data:j.value,bordered:!1,"on-update:page":e=>O.value.page_num=e,"on-update:page-size":e=>O.value.page_size=e},null,8,["max-height","loading","data","on-update:page","on-update:page-size"]),(0,l.Wm)((0,i.SU)(v.Z),{page:O.value.page_num,"onUpdate:page":t[4]||(t[4]=e=>O.value.page_num=e),"item-count":V.value,"on-update:page":$,style:{"align-self":"flex-end","margin-top":"10px"}},null,8,["page","item-count"])]),(0,l.Wm)((0,i.SU)(_.Z),{modelValue:z.isShow,"onUpdate:modelValue":t[8]||(t[8]=e=>z.isShow=e),title:z.title,onOnConfirm:I},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(m.Z),{ref_key:"activationRef",ref:M,model:z.formData,rules:z.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(c.ZP),{label:"激活分区",path:"category_id"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(d.Z),{value:z.formData.category_id,"onUpdate:value":t[5]||(t[5]=e=>z.formData.category_id=e),"label-field":"name","value-field":"id",options:(0,i.SU)(P)},null,8,["value","options"])])),_:1}),(0,l.Wm)((0,i.SU)(c.ZP),{label:"有效期",path:"valid_duration"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(d.Z),{value:z.formData.valid_duration,"onUpdate:value":t[6]||(t[6]=e=>z.formData.valid_duration=e),options:k},null,8,["value"])])),_:1}),(0,l.Wm)((0,i.SU)(c.ZP),{label:"数量",path:"activation_code_count"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(r.Z),{value:z.formData.activation_code_count,"onUpdate:value":t[7]||(t[7]=e=>z.formData.activation_code_count=e)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])]))}},k=t(40089);const Z=(0,k.Z)(S,[["__scopeId","data-v-c99ff890"]]);var W=Z}}]);
//# sourceMappingURL=238.38bc60cc.js.map