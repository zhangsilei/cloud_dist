{"version":3,"file":"js/873.f052e5c2.js","mappings":"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","sources":["webpack://cloud_dist/./src/api/resource.js","webpack://cloud_dist/./node_modules/@vicons/ionicons5/es/CameraOutline.js","webpack://cloud_dist/./src/api/file.js","webpack://cloud_dist/./src/views/pc/ResourceManage.vue","webpack://cloud_dist/./src/views/pc/ResourceManage.vue?4cef"],"sourcesContent":["import request from '@/common/request';\r\n\r\nexport function getResourceList(params) {\r\n  return request({\r\n    url: '/resources',\r\n    method: 'get',\r\n    params,\r\n  });\r\n}\r\n\r\nexport function getResourceDetail(id) {\r\n  return request({\r\n    url: `/resources/${id}`,\r\n    method: 'get',\r\n  });\r\n}\r\n\r\nexport function createResource(data) {\r\n  return request({\r\n    url: '/resources',\r\n    method: 'post',\r\n    data,\r\n  });\r\n}\r\n\r\nexport function updateResource(id, data) {\r\n  return request({\r\n    url: `/resources/${id}`,\r\n    method: 'put',\r\n    data,\r\n  });\r\n}\r\n\r\nexport function deleteResource(id) {\r\n  return request({\r\n    url: `/resources/${id}`,\r\n    method: 'delete',\r\n  });\r\n}\r\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M350.54 148.68l-26.62-42.06C318.31 100.08 310.62 96 302 96h-92c-8.62 0-16.31 4.08-21.92 10.62l-26.62 42.06C155.85 155.23 148.62 160 140 160H80a32 32 0 0 0-32 32v192a32 32 0 0 0 32 32h352a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32h-59c-8.65 0-16.85-4.77-22.46-11.32z',\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'circle',\n  {\n    cx: '256',\n    cy: '272',\n    r: '80',\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-miterlimit': '10',\n    'stroke-width': '32'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32',\n    d: 'M124 158v-22h-24v22'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_5 = [_hoisted_2, _hoisted_3, _hoisted_4]\nexport default defineComponent({\n  name: 'CameraOutline',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_5)\n  }\n})\n","import { getToken } from '@/common/cookie';\r\nimport request from '@/common/request';\r\n\r\nexport function postVideo(file) {\r\n  const formData = new FormData();\r\n  formData.append('video', file.file);\r\n\r\n  return request({\r\n    url: `/videos`,\r\n    method: 'post',\r\n    headers: {\r\n      'Content-type': 'multipart/form-data',\r\n      token: getToken(),\r\n    },\r\n    data: formData,\r\n  });\r\n}\r\n\r\nexport function postPicture(file) {\r\n  const formData = new FormData();\r\n  formData.append('picture', file.file);\r\n\r\n  return request({\r\n    url: `/videos`,\r\n    method: 'post',\r\n    headers: {\r\n      'Content-type': 'multipart/form-data',\r\n      token: getToken(),\r\n    },\r\n    data: formData,\r\n  });\r\n}\r\n","<template>\r\n  <div class=\"resource-manage-container\">\r\n    <categorie-tree class=\"categorie-tree-wrap\" />\r\n\r\n    <div class=\"resource-wrap\">\r\n      <n-space class=\"filter\">\r\n        <n-form-item label-placement=\"left\" label=\"关键字\">\r\n          <n-input v-model:value=\"filter.query\"></n-input>\r\n        </n-form-item>\r\n        <n-form-item label-placement=\"left\">\r\n          <n-button type=\"primary\" @click=\"queryList\"> 查询 </n-button>\r\n        </n-form-item>\r\n        <n-form-item label-placement=\"left\">\r\n          <n-button @click=\"reset\"> 重置 </n-button>\r\n        </n-form-item>\r\n      </n-space>\r\n\r\n      <n-space class=\"action\">\r\n        <n-button type=\"primary\" @click=\"onClickUpload(TYPE_VIDEO)\">\r\n          上传视频\r\n        </n-button>\r\n        <n-button type=\"primary\" @click=\"onClickUpload(TYPE_IMAGE)\">\r\n          上传图片\r\n        </n-button>\r\n      </n-space>\r\n\r\n      <div class=\"content\">\r\n        <n-empty\r\n          v-if=\"!dataList.length\"\r\n          description=\"暂无数据\"\r\n          style=\"margin-top: 100px; flex: 1\"\r\n        ></n-empty>\r\n        <n-grid v-else :x-gap=\"8\" :y-gap=\"8\" :cols=\"8\" style=\"margin-top: 10px\">\r\n          <n-grid-item v-for=\"(item, index) in dataList\" :key=\"index\">\r\n            <video-card\r\n              :id=\"item.id\"\r\n              :file-name=\"item.name\"\r\n              :like-num=\"item.like_num\"\r\n              :authority=\"true\"\r\n              :poster=\"\r\n                isLocal\r\n                  ? 'http://116.63.139.2' + item.picture_url\r\n                  : item.picture_url\r\n              \"\r\n              @on-edit=\"editRes(item)\"\r\n              @on-detail=\"detailResource(item)\"\r\n              @on-delete=\"deleteRes(item)\"\r\n            ></video-card>\r\n          </n-grid-item>\r\n        </n-grid>\r\n        <n-pagination\r\n          style=\"justify-content: flex-end\"\r\n          v-model:page=\"query.page_num\"\r\n          :page-count=\"pageCount\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <popup-window\r\n      v-model=\"resource.isShow\"\r\n      :title=\"resource.title\"\r\n      @on-confirm=\"onResourceConfirm\"\r\n    >\r\n      <n-form\r\n        ref=\"resourceRef\"\r\n        :model=\"resource.formData\"\r\n        :rules=\"resource.rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"所在分区\">\r\n          <span v-for=\"(item, index) in breadcrumbCategory\">\r\n            {{ item }}\r\n            <span v-if=\"index !== breadcrumbCategory.length - 1\">/</span>\r\n          </span>\r\n        </n-form-item>\r\n        <n-form-item label=\"名称\" path=\"name\">\r\n          <n-input v-model:value=\"resource.formData.name\" />\r\n        </n-form-item>\r\n        <n-form-item\r\n          v-if=\"resource.type === TYPE_VIDEO\"\r\n          label=\"视频\"\r\n          path=\"video_url\"\r\n        >\r\n          <n-upload directory-dnd @change=\"onUpload\">\r\n            <n-upload-dragger>\r\n              <div style=\"margin-bottom: 12px\">\r\n                <n-icon size=\"48\" :depth=\"3\">\r\n                  <CameraOutline />\r\n                </n-icon>\r\n              </div>\r\n              <n-text style=\"font-size: 14px\"> 添加视频 </n-text>\r\n              <n-p depth=\"3\" style=\"margin: 8px 0 0 0\">\r\n                （图片大小不超过100M）\r\n              </n-p>\r\n            </n-upload-dragger>\r\n          </n-upload>\r\n        </n-form-item>\r\n        <n-form-item label=\"描述\" path=\"description\">\r\n          <n-input v-model:value=\"resource.formData.description\" />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window>\r\n\r\n    <popup-window\r\n      v-model=\"detail.isShow\"\r\n      title=\"详细信息\"\r\n      :isShowFooter=\"false\"\r\n    >\r\n      <div style=\"display: flex\">\r\n        <div>\r\n          <img\r\n            style=\"width: 250px; margin-right: 15px\"\r\n            :src=\"detail.picture_url\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <n-form-item label-placement=\"left\" label=\"名称\">\r\n            <div>{{ detail.name }}</div>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"位置\">\r\n            <span v-for=\"(item, index) in detail.breadcrumbCategory\">\r\n              {{ item }}\r\n              <span v-if=\"index !== breadcrumbCategory.length - 1\">/</span>\r\n            </span>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"上传时间\">\r\n            <div>{{ detail.created_time }}</div>\r\n          </n-form-item>\r\n          <n-form-item label-placement=\"left\" label=\"最后修改时间\">\r\n            <div>{{ detail.updated_time }}</div>\r\n          </n-form-item>\r\n        </div>\r\n      </div>\r\n    </popup-window>\r\n\r\n    <!-- <n-spin :show=\"loading\">\r\n      <n-space v-if=\"dataList.length\" vertical size=\"large\">\r\n        <div class=\"filter\">\r\n          <n-input round placeholder=\"关键字\">\r\n            <template #prefix>\r\n              <n-icon :component=\"IosSearch\" />\r\n            </template>\r\n          </n-input>\r\n          <n-button\r\n            type=\"primary\"\r\n            attr-type=\"button\"\r\n            style=\"margin: 0 10px\"\r\n            @click=\"queryResource\"\r\n          >\r\n            查询\r\n          </n-button>\r\n          <n-button attr-type=\"button\" @click=\"reset\"> 重置 </n-button>\r\n        </div>\r\n\r\n        <div class=\"action\">\r\n          <n-button\r\n            type=\"primary\"\r\n            attr-type=\"button\"\r\n            @click=\"isShowUpload = true\"\r\n          >\r\n            上传视频\r\n          </n-button>\r\n        </div>\r\n\r\n        <div class=\"content\">\r\n          <n-grid :x-gap=\"8\" :y-gap=\"8\" :cols=\"8\">\r\n            <n-grid-item v-for=\"(item, index) in state.dataList\" :key=\"index\">\r\n              <video-card\r\n                :file-name=\"item.fileName\"\r\n                :like-num=\"item.likeNum\"\r\n                :authority=\"item.authority\"\r\n              ></video-card>\r\n            </n-grid-item>\r\n          </n-grid>\r\n        </div>\r\n      </n-space>\r\n      <n-empty v-else class=\"empty-data\" description=\"暂无分区数据\">\r\n        <template #extra>\r\n          <n-button size=\"small\" @click=\"addCategorie\">新建分区</n-button>\r\n        </template>\r\n      </n-empty>\r\n    </n-spin> -->\r\n\r\n    <!-- <popup-window\r\n      v-model=\"isShowCategorieAlert\"\r\n      title=\"创建分区\"\r\n      @on-confirm=\"addCategorie\"\r\n    >\r\n      <n-form\r\n        ref=\"categorieFormRef\"\r\n        :model=\"categorieFormData\"\r\n        :rules=\"rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"分区名称\" path=\"name\">\r\n          <n-input\r\n            v-model:value=\"categorieFormData.name\"\r\n            placeholder=\"请输入\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"分区描述\" path=\"description\">\r\n          <n-input\r\n            v-model:value=\"categorieFormData.description\"\r\n            placeholder=\"请输入\"\r\n          />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window> -->\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  createDiscreteApi,\r\n  NBreadcrumb,\r\n  NBreadcrumbItem,\r\n  NIcon,\r\n  NInput,\r\n  NTag,\r\n  NSpace,\r\n  NGrid,\r\n  NGridItem,\r\n  NButton,\r\n  NForm,\r\n  NFormItem,\r\n  NSpin,\r\n  NEmpty,\r\n  NUpload,\r\n  NUploadDragger,\r\n  NText,\r\n  NP,\r\n  NPagination,\r\n  NImage,\r\n  useDialog,\r\n} from 'naive-ui';\r\nimport { ref, reactive, onMounted, watch } from 'vue';\r\nimport { CameraOutline } from '@vicons/ionicons5';\r\nimport { Photo } from '@vicons/tabler';\r\nimport DirCard from '@/components/pc/DirCard';\r\nimport VideoCard from '@/components/pc/VideoCard';\r\nimport PopupWindow from '@/components/pc/PopupWindow';\r\nimport CategorieTree from '@/components/pc/CategorieTree';\r\nimport { getCategorieList } from '@/api/categories';\r\nimport { postVideo } from '@/api/file';\r\nimport { onlyAllowNumber } from '@/common/global';\r\nimport {\r\n  getResourceList,\r\n  createResource,\r\n  getResourceDetail,\r\n  deleteResource,\r\n  updateResource,\r\n} from '@/api/resource';\r\nimport { useStore } from 'vuex';\r\nimport moment from 'moment';\r\n\r\nconst store = useStore();\r\nconst { message, dialog } = createDiscreteApi(['message', 'dialog']);\r\n\r\nconst TYPE_VIDEO = 0;\r\nconst TYPE_IMAGE = 1;\r\n\r\nconst filter = reactive({ query: '' });\r\nconst resourceRef = ref(null);\r\nconst resource = reactive({\r\n  isShow: false,\r\n  isEdit: false,\r\n  title: '上传视频',\r\n  type: null,\r\n  formData: ref({\r\n    category_id: null,\r\n    resourceType: null,\r\n    name: null,\r\n    description: null,\r\n    picture_url: null,\r\n    video_url: null,\r\n  }),\r\n  rules: {\r\n    name: {\r\n      required: true,\r\n      trigger: ['blur', 'input'],\r\n      message: '请输入名称',\r\n    },\r\n    video_url: {\r\n      required: true,\r\n      trigger: ['blur', 'change'],\r\n      message: '请上传资源',\r\n    },\r\n  },\r\n});\r\nconst dataList = ref([]);\r\nconst loading = ref(true);\r\nconst selectedCategory = ref(null);\r\nconst breadcrumbCategory = ref([]);\r\nconst uplodFile = ref(null);\r\n\r\nfunction onUpload({ file }) {\r\n  uplodFile.value = file;\r\n  file.status = 'uploading';\r\n  file.percentage = 0;\r\n  const timer = setInterval(() => {\r\n    if (uplodFile.value.status === 'finished') {\r\n      clearInterval(timer);\r\n      return;\r\n    }\r\n    uplodFile.value.percentage += Math.random() * 30;\r\n  }, 1000);\r\n  postVideo(file).then(({ picture_url, video_url }) => {\r\n    resource.formData.picture_url = picture_url;\r\n    resource.formData.video_url = video_url;\r\n    uplodFile.value.percentage = 100;\r\n    setTimeout(() => {\r\n      uplodFile.value.status = 'finished';\r\n    }, 0);\r\n  });\r\n}\r\n\r\nconst isLocal = location.hostname === 'localhost';\r\n\r\nfunction onResourceConfirm() {\r\n  resourceRef.value\r\n    ?.validate(async (errors) => {\r\n      if (!errors) {\r\n        if (!resource.isEdit) {\r\n          await createResource(resource.formData);\r\n        } else {\r\n          await updateResource(\r\n            resource.formData.category_id,\r\n            resource.formData\r\n          );\r\n        }\r\n        resource.isShow = false;\r\n        message.success('操作成功！');\r\n        renderResources();\r\n      }\r\n    })\r\n    .catch();\r\n}\r\n\r\nfunction onClickUpload(type) {\r\n  resource.type = type;\r\n  resource.isShow = true;\r\n  resource.formData.resourceType = type;\r\n  resource.isEdit = false;\r\n}\r\n\r\nconst pageCount = ref(null);\r\nconst query = reactive({\r\n  page_num: 1,\r\n  page_size: 10,\r\n  category_id: null,\r\n  // order_by: '',\r\n  // order_type: '',\r\n});\r\n\r\nfunction queryList() {\r\n  renderResources();\r\n}\r\n\r\nfunction reset() {}\r\n\r\nasync function renderResources() {\r\n  query.category_id = selectedCategory.value;\r\n  const res = await getResourceList(query);\r\n  dataList.value = res.resources || [];\r\n  pageCount.value =\r\n    res.total % query.page_size\r\n      ? res.total / query.page_size\r\n      : res.total / query.page_size + 1;\r\n  loading.value = false;\r\n}\r\n\r\nfunction filterTableMater(id, arr) {\r\n  const queue = [...arr];\r\n  while (queue.length) {\r\n    const o = queue.shift();\r\n    if (o.id === id) return o;\r\n    queue.push(...(o.items || []));\r\n  }\r\n}\r\n\r\nfunction getBreadcrumbCategory(arr, id, result = []) {\r\n  const re = filterTableMater(id, arr);\r\n  if (!re) return result;\r\n  result.unshift(re.name);\r\n  if (re.parent_category_id) {\r\n    return getBreadcrumbCategory(arr, re.parent_category_id, result);\r\n  }\r\n  return result;\r\n}\r\n\r\nwatch(store.state, (val) => {\r\n  selectedCategory.value = val.selectedCategory;\r\n  breadcrumbCategory.value = getBreadcrumbCategory(\r\n    val.allCategories,\r\n    val.selectedCategory\r\n  );\r\n  resource.formData.category_id = val.selectedCategory;\r\n  // query.category_id = val.selectedCategory;\r\n  renderResources();\r\n});\r\n\r\nwatch(\r\n  () => resource.isShow,\r\n  (val) => {\r\n    if (!val) {\r\n      for (const key in resource.formData) {\r\n        if (Object.hasOwnProperty.call(resource.formData, key)) {\r\n          resource.formData[key] = null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n);\r\n\r\nconst detail = reactive({\r\n  isShow: false,\r\n  picture_url: '',\r\n  name: '',\r\n  created_time: '',\r\n  updated_time: '',\r\n  breadcrumbCategory: [],\r\n});\r\n\r\nfunction editRes(item) {\r\n  resource.formData.category_id = item.id;\r\n  resource.formData.name = item.name;\r\n  resource.formData.picture_url = item.picture_url;\r\n  resource.formData.video_url = item.video_url;\r\n  resource.formData.resourceType = item.resource_type;\r\n  resource.type = item.resource_type;\r\n  resource.isShow = true;\r\n  resource.isEdit = true;\r\n}\r\nasync function detailResource(item) {\r\n  const res = await getResourceDetail(item.id);\r\n  detail.picture_url =\r\n    location.hostname === 'localhost'\r\n      ? 'http://116.63.139.2' + res.picture_url\r\n      : res.picture_url;\r\n  detail.name = res.name;\r\n  detail.breadcrumbCategory = getBreadcrumbCategory(\r\n    store.state.allCategories,\r\n    store.state.selectedCategory\r\n  );\r\n  detail.created_time = moment(res.created_time * 1000).format(\r\n    'YYYY-MM-DD HH:mm:ss'\r\n  );\r\n  detail.updated_time = moment(res.updated_time * 1000).format(\r\n    'YYYY-MM-DD HH:mm:ss'\r\n  );\r\n  detail.isShow = true;\r\n}\r\nfunction deleteRes(item) {\r\n  dialog.warning({\r\n    content: '确认删除资源？',\r\n    positiveText: '确定',\r\n    negativeText: '取消',\r\n    onPositiveClick: async () => {\r\n      await deleteResource(item.id);\r\n      message.success('操作成功！');\r\n      renderResources();\r\n    },\r\n    onNegativeClick: () => {},\r\n  });\r\n}\r\n// let isShowUpload = ref(false);\r\n// const state = reactive({\r\n//   dataList: [\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: false },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//     { likeNum: 10, fileName: 'xxxx.mp4', authority: true },\r\n//   ],\r\n// });\r\n\r\n// function query() {}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.resource-manage-container {\r\n  display: flex;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 10px;\r\n  background: #fff;\r\n  box-sizing: border-box;\r\n  .categorie-tree-wrap {\r\n    min-width: 200px;\r\n    border-right: 1px solid #eee;\r\n  }\r\n  .resource-wrap {\r\n    padding-left: 20px;\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n\r\n  .empty-data {\r\n    margin-top: 50%;\r\n    transform: translateY(-50%);\r\n  }\r\n  .filter {\r\n    // display: flex;\r\n    // justify-content: flex-start;\r\n    // align-items: center;\r\n  }\r\n\r\n  .action {\r\n  }\r\n  .content {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n}\r\n</style>\r\n\r\n<style lang=\"scss\">\r\n.n-breadcrumb {\r\n  padding: 0;\r\n  margin-right: 50px;\r\n}\r\n.n-input {\r\n  max-width: 300px;\r\n}\r\n.n-tag {\r\n  cursor: pointer;\r\n}\r\n</style>\r\n","import script from \"./ResourceManage.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ResourceManage.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ResourceManage.vue?vue&type=style&index=0&id=132fb2de&lang=scss&scoped=true\"\nimport \"./ResourceManage.vue?vue&type=style&index=1&id=132fb2de&lang=scss\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-132fb2de\"]])\n\nexport default __exports__"],"names":["getResourceList","params","request","url","method","getResourceDetail","id","createResource","data","updateResource","deleteResource","_hoisted_1","xmlns","viewBox","_hoisted_2","_createElementVNode","d","fill","stroke","_hoisted_3","cx","cy","r","_hoisted_4","_hoisted_5","defineComponent","name","render","_ctx","_cache","_openBlock","_createElementBlock","postVideo","file","formData","FormData","append","headers","token","getToken","store","useStore","message","dialog","createDiscreteApi","TYPE_VIDEO","TYPE_IMAGE","filter","reactive","query","resourceRef","ref","resource","isShow","isEdit","title","type","category_id","resourceType","description","picture_url","video_url","rules","required","trigger","dataList","loading","selectedCategory","breadcrumbCategory","uplodFile","onUpload","value","status","percentage","timer","setInterval","Math","random","clearInterval","then","setTimeout","isLocal","location","hostname","onResourceConfirm","validate","async","errors","success","renderResources","catch","onClickUpload","pageCount","page_num","page_size","queryList","reset","res","resources","total","filterTableMater","arr","queue","length","o","shift","push","items","getBreadcrumbCategory","result","re","unshift","parent_category_id","watch","state","val","allCategories","key","Object","hasOwnProperty","call","detail","created_time","updated_time","editRes","item","resource_type","detailResource","moment","format","deleteRes","warning","content","positiveText","negativeText","onPositiveClick","onNegativeClick","__exports__"],"sourceRoot":""}