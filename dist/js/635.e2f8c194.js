"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[635],{25349:function(e,a,t){t.r(a),t.d(a,{default:function(){return E}});var l=t(73396),u=t(44870),r=t(87139),i=t(24120),n=t(5941),o=t(92097),s=t(33008),c=t(55393),d=t(86973),m=t(9518),_=t(85210),p=t(26429),f=t(83273),g=t(96616),y=t(50631),w=(t(18244),t(26405)),S=t(43612),U=t(44831),v=(t(59063),t(30627)),k=t(10796),D=t(59684),h=t(20065);t(36797);const Z={class:"resource-manage-container"},b={class:"resource-wrap"},W={class:"content"},q={key:0},P={style:{display:"flex"}},C=["src"],O={key:0};var j={__name:"ResourceManage",setup(e){const a=(0,h.oR)(),{message:t,dialog:j}=(0,i.M)(["message","dialog"]);function x(){F()}function H(){I.query.key=null}const E=(0,l.Fl)((()=>I.query.resource_type===k.XE.VIDEOS)),T=(0,l.Fl)((()=>I.query.resource_type===k.XE.PHOTOS));function V(){I.formData.category_id=M.value,I.formData.resource_type=I.query.resource_type,I.isShow=!0}const z=(0,u.iH)(null),K=(0,u.iH)(null),I=(0,u.qj)({loading:!1,isShow:!1,title:null,dataList:[],total:0,query:{page_num:1,page_size:10,category_id:null,key:null,order_by:k.qf.DEFAULT,resource_type:null},resource_id:null,formData:(0,u.iH)({category_id:null,resource_type:null,name:null,description:null,picture_url:null,video_url:null}),rules:{name:{required:!0,trigger:["blur","input"],message:"请输入名称"},video_url:{required:!0,trigger:["blur","change"],message:"请上传资源"}}});function L({file:e}){z.value=e,e.status="uploading",e.percentage=0;const a=setInterval((()=>{"finished"!==z.value.status?z.value.percentage+=30*Math.random():clearInterval(a)}),1e3);E.value&&(0,v.A)(e).then((({picture_url:e,video_url:a})=>{I.formData.picture_url=e,I.formData.video_url=a,z.value.percentage=100,setTimeout((()=>{z.value.status="finished"}),0)})),T.value&&(0,v.g)(e).then((({url:e})=>{I.formData.picture_url=e,I.formData.video_url="",z.value.percentage=100,setTimeout((()=>{z.value.status="finished"}),0)}))}function Y(){K.value?.validate((async e=>{e||(I.resource_id?await(0,D.id)(I.resource_id,I.formData):await(0,D.SN)(I.formData),I.isShow=!1,t.success("操作成功！"),F())})).catch()}async function F(){I.loading=!0;const e=await(0,D.rT)(I.query);I.dataList=e.resources||[],I.total=e.total,I.loading=!1}function X(e){I.query.page_num=e,F()}const M=(0,u.iH)(null),R=(0,u.iH)([]);(0,l.YP)(a.state,(e=>{const a=e.selectedCategory.dirType,t=a?e.selectedCategory.category_id:e.selectedCategory.id,l={[k.XE.VIDEOS]:"上传视频",[k.XE.PHOTOS]:"上传图片"};M.value=t,R.value=(0,k.vo)(e.allCategories,t),I.title=l[a],I.formData.category_id=t,I.formData.resource_type=a,I.query.category_id=t,I.query.resource_type=a,void 0!==a?F():I.dataList=[]}));const A=(0,u.qj)({isShow:!1,picture_url:"",name:"",created_time:"",updated_time:"",breadcrumbCategory:[]});function N(e){I.resource_id=e.id,I.formData.category_id=e.category_id,I.formData.name=e.name,I.formData.description=e.description,I.formData.picture_url=e.picture_url,I.formData.video_url=e.video_url,I.formData.resource_type=e.resource_type,I.isShow=!0}async function B(e){const t=await(0,D.DI)(e.id);A.picture_url=(0,k.Kn)(t.picture_url),A.name=t.name,A.created_time=(0,k.p6)(t.created_time),A.updated_time=(0,k.p6)(t.updated_time),A.breadcrumbCategory=(0,k.vo)(a.state.allCategories,a.state.selectedCategory),A.isShow=!0}function G(e){j.warning({content:"确认删除资源？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await(0,D.fg)(e.id),t.success("操作成功！"),F()},onNegativeClick:()=>{}})}return(0,l.YP)((()=>I.isShow),(e=>{if(!e)for(const a in I.formData)Object.hasOwnProperty.call(I.formData,a)&&(I.formData[a]=null)})),(e,a)=>((0,l.wg)(),(0,l.iD)("div",Z,[(0,l.Wm)((0,u.SU)(U.Z),{class:"categorie-tree-wrap"}),(0,l._)("div",b,[(0,l.Wm)((0,u.SU)(n.Z),{class:"filter"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"关键字"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(s.Z),{value:I.query.key,"onUpdate:value":a[0]||(a[0]=e=>I.query.key=e),clearable:""},null,8,["value"])])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),{type:"primary",onClick:x},{default:(0,l.w5)((()=>[(0,l.Uk)(" 查询 ")])),_:1})])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),{onClick:H},{default:(0,l.w5)((()=>[(0,l.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1}),(0,u.SU)(E)||(0,u.SU)(T)?((0,l.wg)(),(0,l.j4)((0,u.SU)(n.Z),{key:0,class:"action"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),{type:"primary",onClick:V},{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(I.title),1)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l._)("div",W,[I.dataList.length?((0,l.wg)(),(0,l.j4)((0,u.SU)(m.Z),{key:1,"x-gap":8,"y-gap":8,cols:8,style:{"margin-top":"10px"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(I.dataList,((e,a)=>((0,l.wg)(),(0,l.j4)((0,u.SU)(_.ZP),{key:a},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(w.Z),{id:e.id,"is-like":e.is_like,"file-name":e.name,"like-num":e.like_num,authority:!0,poster:(0,u.SU)(k.Kn)(e.picture_url),onOnEdit:a=>N(e),onOnDetail:a=>B(e),onOnDelete:a=>G(e)},null,8,["id","is-like","file-name","like-num","poster","onOnEdit","onOnDetail","onOnDelete"])])),_:2},1024)))),128))])),_:1})):((0,l.wg)(),(0,l.j4)((0,u.SU)(d.Z),{key:0,description:"暂无数据",style:{"margin-top":"100px",flex:"1"}})),(0,l.Wm)((0,u.SU)(p.Z),{style:{"justify-content":"flex-end"},page:I.query.page_num,"onUpdate:page":a[1]||(a[1]=e=>I.query.page_num=e),"item-count":I.total,"on-update:page":X},null,8,["page","item-count"])])]),(0,l.Wm)((0,u.SU)(S.Z),{modelValue:I.isShow,"onUpdate:modelValue":a[4]||(a[4]=e=>I.isShow=e),title:I.title,onOnConfirm:Y},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(f.Z),{ref_key:"resourceRef",ref:K,model:I.formData,rules:I.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(o.ZP),{label:"所在分区"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(R.value,((e,a)=>((0,l.wg)(),(0,l.iD)("span",null,[(0,l.Uk)((0,r.zw)(e)+" ",1),a!==R.value.length-1?((0,l.wg)(),(0,l.iD)("span",q,"/")):(0,l.kq)("",!0)])))),256))])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{label:"名称",path:"name"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(s.Z),{value:I.formData.name,"onUpdate:value":a[2]||(a[2]=e=>I.formData.name=e)},null,8,["value"])])),_:1}),(0,u.SU)(E)?((0,l.wg)(),(0,l.j4)((0,u.SU)(o.ZP),{key:0,label:"视频",path:"video_url"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(n.Z),null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(g.Z),{"directory-dnd":"",onChange:L},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),null,{default:(0,l.w5)((()=>[(0,l.Uk)("上传视频")])),_:1})])),_:1}),I.formData.picture_url?((0,l.wg)(),(0,l.j4)((0,u.SU)(y.Z),{key:0,src:(0,u.SU)(k.Kn)(I.formData.picture_url),style:{height:"100px"}},null,8,["src"])):(0,l.kq)("",!0)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,u.SU)(T)?((0,l.wg)(),(0,l.j4)((0,u.SU)(o.ZP),{key:1,label:"图片",path:"picture_url"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(n.Z),null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(g.Z),{"directory-dnd":"",onChange:L},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(c.ZP),null,{default:(0,l.w5)((()=>[(0,l.Uk)("上传图片")])),_:1})])),_:1}),I.formData.picture_url?((0,l.wg)(),(0,l.j4)((0,u.SU)(y.Z),{key:0,src:(0,u.SU)(k.Kn)(I.formData.picture_url),style:{height:"100px"}},null,8,["src"])):(0,l.kq)("",!0)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l.Wm)((0,u.SU)(o.ZP),{label:"描述",path:"description"},{default:(0,l.w5)((()=>[(0,l.Wm)((0,u.SU)(s.Z),{value:I.formData.description,"onUpdate:value":a[3]||(a[3]=e=>I.formData.description=e)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,l.Wm)((0,u.SU)(S.Z),{modelValue:A.isShow,"onUpdate:modelValue":a[5]||(a[5]=e=>A.isShow=e),title:"详细信息",isShowFooter:!1},{default:(0,l.w5)((()=>[(0,l._)("div",P,[(0,l._)("div",null,[(0,l._)("img",{style:{width:"250px","margin-right":"15px"},src:A.picture_url},null,8,C)]),(0,l._)("div",null,[(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"名称"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(A.name),1)])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"位置"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(R.value,((e,a)=>((0,l.wg)(),(0,l.iD)("span",null,[(0,l.Uk)((0,r.zw)(e)+" ",1),a!==R.value.length-1?((0,l.wg)(),(0,l.iD)("span",O,"/")):(0,l.kq)("",!0)])))),256))])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"上传时间"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(A.created_time),1)])),_:1}),(0,l.Wm)((0,u.SU)(o.ZP),{"label-placement":"left",label:"最后修改"},{default:(0,l.w5)((()=>[(0,l._)("div",null,(0,r.zw)(A.updated_time),1)])),_:1})])])])),_:1},8,["modelValue"])]))}},x=t(40089);const H=(0,x.Z)(j,[["__scopeId","data-v-e8b6eefe"]]);var E=H}}]);
//# sourceMappingURL=635.e2f8c194.js.map