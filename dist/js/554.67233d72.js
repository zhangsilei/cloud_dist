"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[554],{87613:function(e,t,l){l.r(t),l.d(t,{default:function(){return J}});l(57658),l(30541);var a=l(73396),i=l(44870),n=l(87139),r=l(24120),u=l(5941),o=l(92097),s=l(33008),d=l(55393),c=l(86973),m=l(9518),p=l(85210),_=l(26429),f=l(83273),g=l(96616),w=l(89807),y=l(74786),v=l(60212),h=l(56302);const U={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},k=(0,a._)("path",{d:"M350.54 148.68l-26.62-42.06C318.31 100.08 310.62 96 302 96h-92c-8.62 0-16.31 4.08-21.92 10.62l-26.62 42.06C155.85 155.23 148.62 160 140 160H80a32 32 0 0 0-32 32v192a32 32 0 0 0 32 32h352a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32h-59c-8.65 0-16.85-4.77-22.46-11.32z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),S=(0,a._)("circle",{cx:"256",cy:"272",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),D=(0,a._)("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M124 158v-22h-24v22"},null,-1),Z=[k,S,D];var W=(0,a.aZ)({name:"CameraOutline",render:function(e,t){return(0,a.wg)(),(0,a.iD)("svg",U,Z)}}),b=l(17033),C=(l(18244),l(55447)),P=l(43612),x=l(14197),H=(l(59063),l(30627)),j=l(11835),z=l(59684),q=l(20065),Y=l(36797),M=l.n(Y);const T={class:"resource-manage-container"},O={class:"resource-wrap"},V={class:"content"},E={key:0},K={style:{"margin-bottom":"12px"}},I={style:{"margin-bottom":"12px"}},R={style:{display:"flex"}},N=["src"],A={key:0};var B={__name:"ResourceManage",setup(e){const t=(0,q.oR)(),{message:l,dialog:U}=(0,r.M)(["message","dialog"]),k=1,S=2,D="Videos",Z="Photos",Y=(0,i.iH)(null),B=(0,i.qj)({isShow:!1,isEdit:!1,title:"上传视频",type:null,formData:(0,i.iH)({category_id:null,resource_type:null,name:null,description:null,picture_url:null,video_url:null}),rules:{name:{required:!0,trigger:["blur","input"],message:"请输入名称"},video_url:{required:!0,trigger:["blur","change"],message:"请上传资源"}}}),F=(0,i.iH)([]),G=(0,i.iH)(!0),J=(0,i.iH)(null),L=(0,i.iH)([]),Q=(0,i.iH)(null);function X({file:e}){Q.value=e,e.status="uploading",e.percentage=0;const t=setInterval((()=>{"finished"!==Q.value.status?Q.value.percentage+=30*Math.random():clearInterval(t)}),1e3);se.value===D?(0,H.A)(e).then((({picture_url:e,video_url:t})=>{B.formData.picture_url=e,B.formData.video_url=t,Q.value.percentage=100,setTimeout((()=>{Q.value.status="finished"}),0)})):se.value===Z&&(0,H.g)(e).then((({url:e})=>{B.formData.picture_url=e,B.formData.video_url="",Q.value.percentage=100,setTimeout((()=>{Q.value.status="finished"}),0)}))}location.hostname;function $(){Y.value?.validate((async e=>{e||(B.isEdit?await(0,z.id)(B.formData.category_id,B.formData):await(0,z.SN)(B.formData),B.isShow=!1,l.success("操作成功！"),re())})).catch()}function ee(e){B.type=e,B.isShow=!0,B.formData.resource_type=e,B.isEdit=!1}const te="",le=(0,i.iH)(null),ae=(0,i.qj)({page_num:1,page_size:10,category_id:null,key:null,order_by:te,resource_type:null});function ie(){re()}function ne(){}async function re(e){ae.category_id=J.value.id,"Videos"===e?ae.resource_type=1:"Photos"===e&&(ae.resource_type=2);const t=await(0,z.rT)(ae);F.value=t.resources||[],le.value=t.total%ae.page_size?t.total/ae.page_size:t.total/ae.page_size+1,G.value=!1}function ue(e,t){const l=[...t];while(l.length){const t=l.shift();if(t.id===e)return t;l.push(...t.items||[])}}function oe(e,t,l=[]){const a=ue(t,e);return a?(l.unshift(a.name),a.parent_category_id?oe(e,a.parent_category_id,l):l):l}const se=(0,i.iH)(null);(0,a.YP)(t.state,(e=>{let t=e.selectedCategory.dirType?e.selectedCategory.category_id:e.selectedCategory.id;J.value=t,L.value=oe(e.allCategories,t),B.formData.category_id=t,ae.category_id=t,_e.value=e.selectedCategory.dirType,se.value=e.selectedCategory.dirType,e.selectedCategory.dirType?e.selectedCategory.dirType===D?re("Videos"):e.selectedCategory.dirType===Z&&re("Photos"):F.value=[]})),(0,a.YP)((()=>B.isShow),(e=>{if(!e)for(const t in B.formData)Object.hasOwnProperty.call(B.formData,t)&&(B.formData[t]=null)}));const de=(0,i.qj)({isShow:!1,picture_url:"",name:"",created_time:"",updated_time:"",breadcrumbCategory:[]});function ce(e){B.formData.category_id=e.id,B.formData.name=e.name,B.formData.picture_url=e.picture_url,B.formData.video_url=e.video_url,B.formData.resource_type=e.resource_type,B.type=e.resource_type,B.isShow=!0,B.isEdit=!0}async function me(e){const l=await(0,z.DI)(e.id);de.picture_url=(0,j.Kn)(l.picture_url),de.name=l.name,de.breadcrumbCategory=oe(t.state.allCategories,t.state.selectedCategory),de.created_time=M()(1e3*l.created_time).format("YYYY-MM-DD HH:mm:ss"),de.updated_time=M()(1e3*l.updated_time).format("YYYY-MM-DD HH:mm:ss"),de.isShow=!0}function pe(e){U.warning({content:"确认删除资源？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await(0,z.fg)(e.id),l.success("操作成功！"),re()},onNegativeClick:()=>{}})}const _e=(0,i.iH)(!1);return(e,t)=>((0,a.wg)(),(0,a.iD)("div",T,[(0,a.Wm)((0,i.SU)(x.Z),{class:"categorie-tree-wrap"}),(0,a._)("div",O,[(0,a.Wm)((0,i.SU)(u.Z),{class:"filter"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(o.ZP),{"label-placement":"left",label:"关键字"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(s.Z),{value:ae.key,"onUpdate:value":t[0]||(t[0]=e=>ae.key=e),clearable:""},null,8,["value"])])),_:1}),(0,a.Wm)((0,i.SU)(o.ZP),{"label-placement":"left"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.ZP),{type:"primary",onClick:ie},{default:(0,a.w5)((()=>[(0,a.Uk)(" 查询 ")])),_:1})])),_:1}),(0,a.Wm)((0,i.SU)(o.ZP),{"label-placement":"left"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.ZP),{onClick:ne},{default:(0,a.w5)((()=>[(0,a.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1}),_e.value?((0,a.wg)(),(0,a.j4)((0,i.SU)(u.Z),{key:0,class:"action"},{default:(0,a.w5)((()=>[se.value===D?((0,a.wg)(),(0,a.j4)((0,i.SU)(d.ZP),{key:0,type:"primary",onClick:t[1]||(t[1]=e=>ee(k))},{default:(0,a.w5)((()=>[(0,a.Uk)(" 上传视频 ")])),_:1})):(0,a.kq)("",!0),se.value===Z?((0,a.wg)(),(0,a.j4)((0,i.SU)(d.ZP),{key:1,type:"primary",onClick:t[2]||(t[2]=e=>ee(S))},{default:(0,a.w5)((()=>[(0,a.Uk)(" 上传图片 ")])),_:1})):(0,a.kq)("",!0)])),_:1})):(0,a.kq)("",!0),(0,a._)("div",V,[F.value.length?((0,a.wg)(),(0,a.j4)((0,i.SU)(m.Z),{key:1,"x-gap":8,"y-gap":8,cols:8,style:{"margin-top":"10px"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(F.value,((e,t)=>((0,a.wg)(),(0,a.j4)((0,i.SU)(p.ZP),{key:t},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(C.Z),{id:e.id,"file-name":e.name,"like-num":e.like_num,authority:!0,poster:(0,i.SU)(j.Kn)(e.picture_url),onOnEdit:t=>ce(e),onOnDetail:t=>me(e),onOnDelete:t=>pe(e)},null,8,["id","file-name","like-num","poster","onOnEdit","onOnDetail","onOnDelete"])])),_:2},1024)))),128))])),_:1})):((0,a.wg)(),(0,a.j4)((0,i.SU)(c.Z),{key:0,description:"暂无数据",style:{"margin-top":"100px",flex:"1"}})),(0,a.Wm)((0,i.SU)(_.Z),{style:{"justify-content":"flex-end"},page:ae.page_num,"onUpdate:page":t[3]||(t[3]=e=>ae.page_num=e),"page-count":le.value},null,8,["page","page-count"])])]),(0,a.Wm)((0,i.SU)(P.Z),{modelValue:B.isShow,"onUpdate:modelValue":t[6]||(t[6]=e=>B.isShow=e),title:B.title,onOnConfirm:$},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(f.Z),{ref_key:"resourceRef",ref:Y,model:B.formData,rules:B.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(o.ZP),{label:"所在分区"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(L.value,((e,t)=>((0,a.wg)(),(0,a.iD)("span",null,[(0,a.Uk)((0,n.zw)(e)+" ",1),t!==L.value.length-1?((0,a.wg)(),(0,a.iD)("span",E,"/")):(0,a.kq)("",!0)])))),256))])),_:1}),(0,a.Wm)((0,i.SU)(o.ZP),{label:"名称",path:"name"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(s.Z),{value:B.formData.name,"onUpdate:value":t[4]||(t[4]=e=>B.formData.name=e)},null,8,["value"])])),_:1}),B.type===k?((0,a.wg)(),(0,a.j4)((0,i.SU)(o.ZP),{key:0,label:"视频",path:"video_url"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(g.Z),{"directory-dnd":"",onChange:X},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(w.Z),null,{default:(0,a.w5)((()=>[(0,a._)("div",K,[(0,a.Wm)((0,i.SU)(y.g),{size:"48",depth:3},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(W))])),_:1})]),(0,a.Wm)((0,i.SU)(v.Z),{style:{"font-size":"14px"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" 添加视频 ")])),_:1}),(0,a.Wm)((0,i.SU)(h.Z),{depth:"3",style:{margin:"8px 0 0 0"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" （图片大小不超过100M） ")])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0),se.value===Z?((0,a.wg)(),(0,a.j4)((0,i.SU)(o.ZP),{key:1,label:"图片",path:"picture_url"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(g.Z),{"directory-dnd":"",onChange:X},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(w.Z),null,{default:(0,a.w5)((()=>[(0,a._)("div",I,[(0,a.Wm)((0,i.SU)(y.g),{size:"48",depth:3},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(b.Z))])),_:1})]),(0,a.Wm)((0,i.SU)(v.Z),{style:{"font-size":"16px"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" 上传图片 ")])),_:1}),(0,a.Wm)((0,i.SU)(h.Z),{depth:"3",style:{margin:"8px 0 0 0"}},{default:(0,a.w5)((()=>[(0,a.Uk)(" (图片大小不超过1M） ")])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0),(0,a.Wm)((0,i.SU)(o.ZP),{label:"描述",path:"description"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(s.Z),{value:B.formData.description,"onUpdate:value":t[5]||(t[5]=e=>B.formData.description=e)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,a.Wm)((0,i.SU)(P.Z),{modelValue:de.isShow,"onUpdate:modelValue":t[7]||(t[7]=e=>de.isShow=e),title:"详细信息",isShowFooter:!1},{default:(0,a.w5)((()=>[(0,a._)("div",R,[(0,a._)("div",null,[(0,a._)("img",{style:{width:"250px","margin-right":"15px"},src:de.picture_url},null,8,N)]),(0,a._)("div",null,[(0,a.Wm)((0,i.SU)(o.ZP),{"label-placement":"left",label:"名称"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,n.zw)(de.name),1)])),_:1}),(0,a.Wm)((0,i.SU)(o.ZP),{"label-placement":"left",label:"位置"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(L.value,((e,t)=>((0,a.wg)(),(0,a.iD)("span",null,[(0,a.Uk)((0,n.zw)(e)+" ",1),t!==L.value.length-1?((0,a.wg)(),(0,a.iD)("span",A,"/")):(0,a.kq)("",!0)])))),256))])),_:1}),(0,a.Wm)((0,i.SU)(o.ZP),{"label-placement":"left",label:"上传时间"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,n.zw)(de.created_time),1)])),_:1}),(0,a.Wm)((0,i.SU)(o.ZP),{"label-placement":"left",label:"最后修改时间"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,n.zw)(de.updated_time),1)])),_:1})])])])),_:1},8,["modelValue"])]))}},F=l(40089);const G=(0,F.Z)(B,[["__scopeId","data-v-31fbe545"]]);var J=G}}]);
//# sourceMappingURL=554.67233d72.js.map