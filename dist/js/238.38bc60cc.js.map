{"version":3,"file":"js/238.38bc60cc.js","mappings":"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","sources":["webpack://cloud_dist/./src/views/pc/ActivationManage.vue","webpack://cloud_dist/./src/views/pc/ActivationManage.vue?6632"],"sourcesContent":["<template>\r\n  <div class=\"activation-code-manage-container\">\r\n    <n-space class=\"filter\">\r\n      <n-form-item label-placement=\"left\" label=\"激活分区\">\r\n        <n-select\r\n          v-model:value=\"activationParams.category_id\"\r\n          label-field=\"name\"\r\n          value-field=\"id\"\r\n          :options=\"categoryListWithOneLevel\"\r\n          style=\"width: 150px\"\r\n          clearable\r\n        />\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\" label=\"状态\">\r\n        <n-select\r\n          v-model:value=\"activationParams.activated\"\r\n          :options=\"statusOptions\"\r\n          style=\"width: 150px\"\r\n          clearable\r\n        />\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\" label=\"关键字\">\r\n        <n-input\r\n          v-model:value=\"activationParams.key\"\r\n          placeholder=\"激活码\"\r\n          clearable\r\n        ></n-input>\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\">\r\n        <n-button type=\"primary\" @click=\"query\"> 查询 </n-button>\r\n      </n-form-item>\r\n      <n-form-item label-placement=\"left\">\r\n        <n-button @click=\"reset\"> 重置 </n-button>\r\n      </n-form-item>\r\n    </n-space>\r\n\r\n    <n-space class=\"action\">\r\n      <n-button type=\"primary\" @click=\"activation.isShow = true\">\r\n        新增激活码\r\n      </n-button>\r\n    </n-space>\r\n\r\n    <div style=\"display: flex; flex-direction: column\">\r\n      <n-data-table\r\n        :max-height=\"maxHeight\"\r\n        :loading=\"loading\"\r\n        :columns=\"columns\"\r\n        :data=\"dataList\"\r\n        :bordered=\"false\"\r\n        :on-update:page=\"(page) => (activationParams.page_num = page)\"\r\n        :on-update:page-size=\"(size) => (activationParams.page_size = size)\"\r\n      />\r\n      <n-pagination\r\n        v-model:page=\"activationParams.page_num\"\r\n        :item-count=\"total\"\r\n        :on-update:page=\"changePage\"\r\n        style=\"align-self: flex-end; margin-top: 10px\"\r\n      />\r\n    </div>\r\n\r\n    <popup-window\r\n      v-model=\"activation.isShow\"\r\n      :title=\"activation.title\"\r\n      @on-confirm=\"onActivationConfirm\"\r\n    >\r\n      <n-form\r\n        ref=\"activationRef\"\r\n        :model=\"activation.formData\"\r\n        :rules=\"activation.rules\"\r\n        label-placement=\"left\"\r\n        label-width=\"auto\"\r\n        require-mark-placement=\"right-hanging\"\r\n      >\r\n        <n-form-item label=\"激活分区\" path=\"category_id\">\r\n          <n-select\r\n            v-model:value=\"activation.formData.category_id\"\r\n            label-field=\"name\"\r\n            value-field=\"id\"\r\n            :options=\"categoryListWithOneLevel\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"有效期\" path=\"valid_duration\">\r\n          <n-select\r\n            v-model:value=\"activation.formData.valid_duration\"\r\n            :options=\"validDurationOptions\"\r\n          />\r\n        </n-form-item>\r\n        <n-form-item label=\"数量\" path=\"activation_code_count\">\r\n          <n-input v-model:value=\"activation.formData.activation_code_count\" />\r\n        </n-form-item>\r\n      </n-form>\r\n    </popup-window>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  createDiscreteApi,\r\n  NSelect,\r\n  NFormItem,\r\n  NBreadcrumbItem,\r\n  NIcon,\r\n  NInput,\r\n  NForm,\r\n  NTag,\r\n  NSpace,\r\n  NGrid,\r\n  NGridItem,\r\n  NButton,\r\n  NInputNumber,\r\n  NDataTable,\r\n  NPagination,\r\n} from 'naive-ui';\r\nimport { ref, h, reactive, watch, onMounted } from 'vue';\r\nimport PopupWindow from '@/components/pc/PopupWindow';\r\nimport { getCategorieList } from '@/api/categories';\r\nimport { createActivationCode, getActivationCodeList } from '@/api/activation';\r\nimport moment from 'moment';\r\nimport Clipboard from 'clipboard';\r\n\r\nconst maxHeight = ref(0);\r\n\r\nonMounted(() => {\r\n  const $ = (selector) => document.querySelector(selector);\r\n  maxHeight.value =\r\n    $('.activation-code-manage-container').offsetHeight - 58 - 49 - 38 - 65;\r\n});\r\n\r\nconst { message } = createDiscreteApi(['message']);\r\n\r\nconst TYPE_USED = true;\r\nconst TYPE_UNUSED = false;\r\nconst statusOptions = [\r\n  {\r\n    label: '已使用',\r\n    value: TYPE_USED,\r\n  },\r\n  {\r\n    label: '未使用',\r\n    value: TYPE_UNUSED,\r\n  },\r\n];\r\nconst validDurationOptions = [\r\n  {\r\n    label: '1个月',\r\n    value: 3600 * 24 * 30,\r\n  },\r\n  {\r\n    label: '2个月',\r\n    value: 3600 * 24 * 30 * 2,\r\n  },\r\n  {\r\n    label: '3个月',\r\n    value: 3600 * 24 * 30 * 3,\r\n  },\r\n  {\r\n    label: '6个月',\r\n    value: 3600 * 24 * 30 * 6,\r\n  },\r\n  {\r\n    label: '1年',\r\n    value: 3600 * 24 * 365,\r\n  },\r\n  {\r\n    label: '2年',\r\n    value: 3600 * 24 * 365 * 2,\r\n  },\r\n  {\r\n    label: '3年',\r\n    value: 3600 * 24 * 365 * 3,\r\n  },\r\n  {\r\n    label: '4年',\r\n    value: 3600 * 24 * 365 * 4,\r\n  },\r\n];\r\nconst columns = [\r\n  {\r\n    title: '编号',\r\n    key: 'activation_code.id',\r\n    width: 160,\r\n  },\r\n  {\r\n    title: '激活码',\r\n    key: 'activation_code.code',\r\n    width: 130,\r\n    render(row) {\r\n      return h(\r\n        NButton,\r\n        {\r\n          'data-clipboard-text': row.activation_code.code,\r\n          id: row.activation_code.code,\r\n          onClick() {\r\n            copyContact(row.activation_code.code);\r\n            message.success('复制成功！');\r\n          },\r\n        },\r\n        row.activation_code.code\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '激活分区',\r\n    key: 'category.name',\r\n    width: 160,\r\n    ellipsis: {\r\n      tooltip: true,\r\n    },\r\n  },\r\n  {\r\n    title: '有效期',\r\n    key: 'activation_code.valid_duration',\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        null,\r\n        row.activation_code.valid_duration / (3600 * 24) + '天'\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '状态',\r\n    key: 'status',\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        {\r\n          style: {\r\n            color: row.activation_code.user_id ? 'red' : 'green',\r\n          },\r\n        },\r\n        row.activation_code.user_id ? '已使用' : '未使用'\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '创建时间',\r\n    key: 'activation_code.created_time',\r\n    width: 160,\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        null,\r\n        moment(row.activation_code.created_time * 1000).format(\r\n          'YYYY-MM-DD HH:mm:ss'\r\n        ) || '--'\r\n      );\r\n    },\r\n  },\r\n  {\r\n    title: '用户ID',\r\n    key: 'activation_code.user_id',\r\n    render(row) {\r\n      return h('span', null, row.activation_code.user_id || '--');\r\n    },\r\n  },\r\n  {\r\n    title: '使用时间',\r\n    key: 'activation_code.use_time',\r\n    render(row) {\r\n      return h(\r\n        'span',\r\n        null,\r\n        row.activation_code.use_time\r\n          ? moment(row.activation_code.use_time * 1000).format(\r\n              'YYYY-MM-DD HH:mm:ss'\r\n            )\r\n          : '--'\r\n      );\r\n    },\r\n  },\r\n];\r\n\r\nlet clipboard = null;\r\nlet loading = ref(true);\r\nlet categoryListWithOneLevel = ref(null);\r\n\r\ngetCategoryListWithOneLevel();\r\n\r\nconst copyContact = (id) => {\r\n  initClipboard(id);\r\n  clipboard.on('success', (e) => {\r\n    console.log('copy succ');\r\n    e.clearSelection();\r\n  });\r\n  clipboard.on('error', (e) => {\r\n    console.log('copy fail');\r\n  });\r\n};\r\n\r\nconst initClipboard = (id) => {\r\n  clipboard && clipboard.destroy();\r\n  clipboard = null;\r\n  clipboard = new Clipboard(`#${id}`);\r\n};\r\n\r\nasync function getCategoryListWithOneLevel() {\r\n  const res = await getCategorieList();\r\n  categoryListWithOneLevel.value = res.items || [];\r\n  loading.value = false;\r\n}\r\n\r\nconst query = () => {\r\n  activationParams.value.page_num = 1;\r\n  renderActivationList();\r\n};\r\nconst reset = () => {\r\n  activationParams.value.category_id = null;\r\n  activationParams.value.activated = null;\r\n  activationParams.value.key = null;\r\n};\r\n\r\nconst activationRef = ref(null);\r\nconst activation = reactive({\r\n  isShow: false,\r\n  title: '创建激活码',\r\n  formData: ref({\r\n    category_id: null,\r\n    valid_duration: null,\r\n    activation_code_count: null,\r\n  }),\r\n  rules: {\r\n    category_id: {\r\n      required: true,\r\n      trigger: ['blur', 'change'],\r\n      message: '请选择分区',\r\n      type: 'number',\r\n    },\r\n    valid_duration: {\r\n      required: true,\r\n      trigger: ['blur', 'change'],\r\n      message: '请选择有效期',\r\n      type: 'number',\r\n    },\r\n    activation_code_count: {\r\n      required: true,\r\n      trigger: ['blur', 'input'],\r\n      message: '请输入数量',\r\n    },\r\n  },\r\n});\r\n\r\nfunction onActivationConfirm() {\r\n  activationRef.value\r\n    ?.validate(async (errors) => {\r\n      if (!errors) {\r\n        await createActivationCode({\r\n          ...activation.formData,\r\n          activation_code_count: parseInt(\r\n            activation.formData.activation_code_count\r\n          ),\r\n        });\r\n        activation.isShow = false;\r\n        message.success('操作成功！');\r\n        renderActivationList();\r\n      }\r\n    })\r\n    .catch();\r\n}\r\n\r\nwatch(\r\n  () => activation.isShow,\r\n  (val) => {\r\n    if (!val) {\r\n      for (const key in activation.formData) {\r\n        if (Object.hasOwnProperty.call(activation.formData, key)) {\r\n          activation.formData[key] = null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n);\r\n\r\nconst activationParams = ref({\r\n  page_num: 1,\r\n  page_size: 10,\r\n  category_id: null,\r\n  activated: null,\r\n  key: null,\r\n});\r\nconst total = ref(0);\r\n\r\nconst dataList = ref([]);\r\n\r\nasync function renderActivationList() {\r\n  const res = await getActivationCodeList(activationParams.value);\r\n  dataList.value = res.activation_codes || [];\r\n  total.value = res.total;\r\n}\r\n\r\nfunction changePage(page) {\r\n  activationParams.value.page_num = page;\r\n  renderActivationList();\r\n}\r\n\r\nrenderActivationList();\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.activation-code-manage-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 10px;\r\n  background: #fff;\r\n  box-sizing: border-box;\r\n  .action {\r\n    margin-bottom: 15px;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./ActivationManage.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActivationManage.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ActivationManage.vue?vue&type=style&index=0&id=c99ff890&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-c99ff890\"]])\n\nexport default __exports__"],"names":["maxHeight","ref","onMounted","$","selector","document","querySelector","value","offsetHeight","message","createDiscreteApi","TYPE_USED","TYPE_UNUSED","statusOptions","label","validDurationOptions","columns","title","key","width","render","row","h","NButton","activation_code","code","id","onClick","copyContact","success","ellipsis","tooltip","valid_duration","style","color","user_id","moment","created_time","format","use_time","clipboard","loading","categoryListWithOneLevel","getCategoryListWithOneLevel","initClipboard","on","e","console","log","clearSelection","destroy","Clipboard","async","res","getCategorieList","items","query","activationParams","page_num","renderActivationList","reset","category_id","activated","activationRef","activation","reactive","isShow","formData","activation_code_count","rules","required","trigger","type","onActivationConfirm","validate","errors","createActivationCode","parseInt","catch","watch","val","Object","hasOwnProperty","call","page_size","total","dataList","getActivationCodeList","activation_codes","changePage","page","__exports__"],"sourceRoot":""}