{"version":3,"file":"js/924.5db99663.js","mappings":"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","sources":["webpack://cloud_dist/./src/views/m/ResourceDetail.vue","webpack://cloud_dist/./src/views/m/ResourceDetail.vue?e8da"],"sourcesContent":["<template>\r\n  <div class=\"resource-detail-container\">\r\n    <n-page-header :title=\"title\" @back=\"handleBack\">\r\n      <template #extra>\r\n        <n-space v-if=\"currentResource\">\r\n          <n-icon\r\n            v-if=\"currentResource.is_like\"\r\n            color=\"red\"\r\n            size=\"20\"\r\n            @click=\"unlike\"\r\n          >\r\n            <Heart />\r\n          </n-icon>\r\n          <n-icon v-else size=\"20\" @click=\"like\">\r\n            <HeartOutline />\r\n          </n-icon>\r\n        </n-space>\r\n      </template>\r\n    </n-page-header>\r\n\r\n    <swiper\r\n      v-if=\"currentResource\"\r\n      :direction=\"'vertical'\"\r\n      class=\"mySwiper\"\r\n      @swiper=\"onSwiper\"\r\n      @slideChange=\"onSourceChange\"\r\n    >\r\n      <swiper-slide v-for=\"item in dataList\">\r\n        <template v-if=\"item.resource_type === 'VIDEO'\">\r\n          <video\r\n            :id=\"'video' + item.id\"\r\n            muted\r\n            controls\r\n            controlsList=\"nodownload\"\r\n            style=\"width: 100%\"\r\n          ></video>\r\n        </template>\r\n        <template v-else>\r\n          <img\r\n            :src=\"parseUrlToPath(item.picture_url)\"\r\n            style=\"width: auto; height: 100%\"\r\n          />\r\n          <!-- <n-image :src=\"parseUrlToPath(item.picture_url)\" lazy /> -->\r\n        </template>\r\n      </swiper-slide>\r\n    </swiper>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  NTag,\r\n  NInput,\r\n  NAvatar,\r\n  NIcon,\r\n  NImage,\r\n  NTabs,\r\n  NTabPane,\r\n  NPageHeader,\r\n  NGrid,\r\n  NGi,\r\n  NStatistic,\r\n  NSpace,\r\n} from 'naive-ui';\r\nimport { computed, ref, nextTick, watch, onMounted } from 'vue';\r\nimport { Heart, HeartOutline } from '@vicons/ionicons5';\r\nimport { postLike, deleteLike } from '@/api/like';\r\nimport { useRouter, useRoute } from 'vue-router';\r\nimport { parse } from 'qs';\r\n// Import Swiper Vue.js components\r\nimport { Swiper, SwiperSlide } from 'swiper/vue';\r\n// Import Swiper styles\r\nimport 'swiper/css';\r\nimport { getResourceList } from '@/api/resource';\r\nimport { getLikeList } from '@/api/like';\r\nimport { parseUrlToPath } from '@/common/global';\r\nimport Hls from 'hls.js';\r\n\r\nconst router = useRouter();\r\nconst route = useRoute();\r\n\r\nconst queryObj = parse(route.query);\r\n\r\nconst totalNum = ref(0);\r\nconst currentNum = ref(0);\r\nconst currentResource = ref(null);\r\nconst dataList = ref([]);\r\nconst page_num = ref(1);\r\n\r\nconst title = computed(() => {\r\n  return currentNum.value + '/' + totalNum.value;\r\n});\r\n\r\nwatch(currentResource, (val) => {\r\n  if (val.resource_type === 'VIDEO') {\r\n    nextTick(() => {\r\n      play();\r\n    });\r\n  }\r\n});\r\n\r\ninit();\r\n\r\nasync function init() {\r\n  if (route.query.isFromFavorite) {\r\n    getLikes();\r\n  } else {\r\n    getResources();\r\n  }\r\n}\r\n\r\nasync function getResources() {\r\n  const res = await getResourceList({\r\n    page_num: page_num.value,\r\n    page_size: queryObj.page_size,\r\n    resource_type: queryObj.resource_type,\r\n    category_id: queryObj.category_id,\r\n    order_by: queryObj.order_by,\r\n    key: queryObj.key,\r\n  });\r\n  const data = res.resources || [];\r\n  dataList.value.push(...data);\r\n\r\n  if (page_num.value < route.query.page_num) {\r\n    page_num.value++;\r\n    getResources();\r\n    return;\r\n  }\r\n\r\n  totalNum.value = res.total;\r\n  dataList.value.find((item, index) => {\r\n    if (item.id == route.query.id) {\r\n      currentNum.value = index + 1;\r\n      currentResource.value = item;\r\n    }\r\n  });\r\n}\r\n\r\nasync function getLikes() {\r\n  const res = await getLikeList({\r\n    page_num: page_num.value,\r\n    page_size: queryObj.page_size,\r\n    resource_type: queryObj.resource_type,\r\n    favorite_type: queryObj.favorite_type,\r\n  });\r\n  const data = (res.likes || []).map((item) => {\r\n    return {\r\n      ...item.resource,\r\n      is_like: item.is_like,\r\n      has_permissions: item.has_permissions,\r\n    };\r\n  });\r\n  dataList.value.push(...data);\r\n\r\n  if (page_num.value < route.query.page_num) {\r\n    page_num.value++;\r\n    getLikes();\r\n    return;\r\n  }\r\n\r\n  totalNum.value = res.total;\r\n  dataList.value.find((item, index) => {\r\n    if (item.id == route.query.id) {\r\n      currentNum.value = index + 1;\r\n      currentResource.value = item;\r\n    }\r\n  });\r\n}\r\n\r\nfunction play() {\r\n  if (Hls.isSupported()) {\r\n    const instance = new Hls();\r\n    const video = document.querySelector(`#video${currentResource.value.id}`);\r\n    instance.loadSource(parseUrlToPath(currentResource.value.video_url));\r\n    instance.attachMedia(video);\r\n    video.play();\r\n  } else {\r\n    console.warn('当前浏览器不支持Hls.js');\r\n  }\r\n}\r\n\r\nfunction onSwiper(swiper) {\r\n  swiper.slideTo(currentNum.value - 1);\r\n}\r\n\r\nfunction onSourceChange(swiper) {\r\n  getNextData(swiper.realIndex).then(() => {\r\n    currentNum.value = swiper.realIndex + 1;\r\n    currentResource.value = dataList.value[swiper.realIndex];\r\n  });\r\n}\r\n\r\nfunction getNextData(index) {\r\n  const isFromFavorite = route.query.isFromFavorite;\r\n  return new Promise((resolve) => {\r\n    if (\r\n      index === dataList.value.length - 1 &&\r\n      dataList.value.length < totalNum.value\r\n    ) {\r\n      page_num.value++;\r\n      if (isFromFavorite) {\r\n        getLikes().then(() => resolve());\r\n      } else {\r\n        getResources().then(() => resolve());\r\n      }\r\n    } else {\r\n      resolve();\r\n    }\r\n  });\r\n}\r\n\r\nasync function like() {\r\n  if (!currentResource.value.is_like) {\r\n    try {\r\n      await postLike({\r\n        resource_id: currentResource.value.id,\r\n      });\r\n      currentResource.value.is_like = true;\r\n    } catch (e) {}\r\n  }\r\n}\r\n\r\nasync function unlike() {\r\n  if (currentResource.value.is_like) {\r\n    try {\r\n      await deleteLike({\r\n        resource_id: currentResource.value.id,\r\n      });\r\n      currentResource.value.is_like = false;\r\n    } catch (e) {}\r\n  }\r\n}\r\n\r\nfunction handleBack() {\r\n  router.go(-1);\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.resource-detail-container {\r\n  background: #fff;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 0 10px 10px;\r\n  background: #fff;\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  flex-direction: column;\r\n  // .large-img {\r\n  //   width: 98%;\r\n  //   margin: 0 auto;\r\n  // }\r\n  // .slide-img {\r\n  //   height: 100%;\r\n  // }\r\n  .swiper {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n\r\n  .swiper-slide {\r\n    text-align: center;\r\n    font-size: 18px;\r\n    background: #000;\r\n\r\n    /* Center slide text vertically */\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .swiper-slide img {\r\n    display: block;\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./ResourceDetail.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ResourceDetail.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ResourceDetail.vue?vue&type=style&index=0&id=6a9ebc3b&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\my\\\\cloud_dist\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6a9ebc3b\"]])\n\nexport default __exports__"],"names":["router","useRouter","route","useRoute","queryObj","parse","query","totalNum","ref","currentNum","currentResource","dataList","page_num","title","computed","value","async","init","isFromFavorite","getLikes","getResources","res","getResourceList","page_size","resource_type","category_id","order_by","key","data","resources","push","total","find","item","index","id","getLikeList","favorite_type","likes","map","resource","is_like","has_permissions","play","Hls","instance","video","document","querySelector","loadSource","parseUrlToPath","video_url","attachMedia","console","warn","onSwiper","swiper","slideTo","onSourceChange","getNextData","realIndex","then","Promise","resolve","length","like","postLike","resource_id","e","unlike","deleteLike","handleBack","go","watch","val","nextTick","__exports__"],"sourceRoot":""}