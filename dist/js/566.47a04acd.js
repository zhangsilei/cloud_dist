"use strict";(self["webpackChunkcloud_dist"]=self["webpackChunkcloud_dist"]||[]).push([[566],{78566:function(e,a,i){i.r(a),i.d(a,{default:function(){return j}});i(57658);var t=i(73396),u=i(44870),l=i(43752),n=i(5941),o=i(74786),c=i(44881),r=i(59320),s=i(45140),d=i(22483),v=i(95410),_=i(28040),y=i(59684),p=i(10796),w=i(137),f=i.n(w);const g={class:"resource-detail-container"},k=["id"],m=["src"];var S={__name:"ResourceDetail",setup(e){const a=(0,d.tv)(),i=(0,d.yj)(),w=(0,v.parse)(i.query),S=(0,u.iH)(0),h=(0,u.iH)(0),U=(0,u.iH)(null),j=(0,u.iH)([]),z=(0,u.iH)(1),D=(0,t.Fl)((()=>h.value+"/"+S.value));async function H(){w.isFromFavorite?await C():await q()}async function I(){if(await H(),z.value<w.page_num)return z.value++,void await I();b()}function b(){let e=0;j.value.find(((a,i)=>{a.id==w.id&&(U.value=a,e=i+1)})),S.value=w.total,h.value=(w.page_num-1)*w.page_size+e}async function q(){const e=await(0,y.rT)({page_num:z.value,page_size:w.page_size,resource_type:w.resource_type,category_id:w.category_id,order_by:w.order_by,key:w.key});j.value.push(...e.resources||[])}async function C(){const e=await(0,s.P$)({page_num:z.value,page_size:w.page_size,resource_type:w.resource_type,favorite_type:w.favorite_type});j.value.push(...(e.likes||[]).map((e=>e.resource)))}function Z(){if(f().isSupported()){const e=new(f()),a=document.querySelector(`#${U.value.name}`);e.loadSource((0,p.Kn)(U.value.video_url)),e.attachMedia(a),a.play()}else console.warn("当前浏览器不支持Hls.js")}function x(e){e.slideTo(h.value-1)}function F(e){const a=h.value>e.activeIndex+1;h.value=e.activeIndex+1,U.value=j.value.find(((e,i)=>{if(e.id==U.value.id)return j.value[i+(a?-1:1)]})),e.activeIndex+1===j.value.length&&(z.value++,H())}async function K(){if(!U.value.is_like)try{await(0,s.mT)({resource_id:U.value.id}),U.value.is_like=!0}catch(e){}}async function T(){if(U.value.is_like)try{await(0,s.Nk)({resource_id:U.value.id}),U.value.is_like=!1}catch(e){}}function W(){a.go(-1)}return(0,t.YP)(U,(e=>{"VIDEO"===e.resource_type&&(0,t.Y3)((()=>{Z()}))})),I(),(e,a)=>((0,t.wg)(),(0,t.iD)("div",g,[(0,t.Wm)((0,u.SU)(l.Z),{title:(0,u.SU)(D),onBack:W},{extra:(0,t.w5)((()=>[U.value?((0,t.wg)(),(0,t.j4)((0,u.SU)(n.Z),{key:0},{default:(0,t.w5)((()=>[U.value.is_like?((0,t.wg)(),(0,t.j4)((0,u.SU)(o.g),{key:0,color:"red",size:"20",onClick:T},{default:(0,t.w5)((()=>[(0,t.Wm)((0,u.SU)(c.Z))])),_:1})):((0,t.wg)(),(0,t.j4)((0,u.SU)(o.g),{key:1,size:"20",onClick:K},{default:(0,t.w5)((()=>[(0,t.Wm)((0,u.SU)(r.Z))])),_:1}))])),_:1})):(0,t.kq)("",!0)])),_:1},8,["title"]),U.value?((0,t.wg)(),(0,t.j4)((0,u.SU)(_.tq),{key:0,direction:"vertical",class:"mySwiper",onSwiper:x,onSlideChange:F},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(j.value,(e=>((0,t.wg)(),(0,t.j4)((0,u.SU)(_.o5),null,{default:(0,t.w5)((()=>["VIDEO"===e.resource_type?((0,t.wg)(),(0,t.iD)("video",{key:0,id:e.name,muted:"",controls:"",controlsList:"nodownload",style:{width:"100%"}},null,8,k)):((0,t.wg)(),(0,t.iD)("img",{key:1,src:(0,u.SU)(p.Kn)(e.picture_url),style:{width:"auto",height:"100%"}},null,8,m))])),_:2},1024)))),256))])),_:1})):(0,t.kq)("",!0)]))}},h=i(40089);const U=(0,h.Z)(S,[["__scopeId","data-v-71b04596"]]);var j=U}}]);
//# sourceMappingURL=566.47a04acd.js.map